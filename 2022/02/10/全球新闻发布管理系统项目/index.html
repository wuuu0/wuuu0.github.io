<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="概览项目简介本项目实现了一个新闻展示+后台管理网站 Github：https:&#x2F;&#x2F;github.com&#x2F;wuuu0&#x2F;NewsHub项目演示：https:&#x2F;&#x2F;qcigwi.app.cloudendpoint.cn 技术选型前端：React (hooks) + React Router + Redux + Axios + Antd后端：Json Server（辅助前端开发）、Express + 字节跳">
<meta property="og:type" content="article">
<meta property="og:title" content="新闻发布管理系统实战——React全家桶前端+轻服务后端">
<meta property="og:url" content="http://example.com/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="Wu&#39;s Blog">
<meta property="og:description" content="概览项目简介本项目实现了一个新闻展示+后台管理网站 Github：https:&#x2F;&#x2F;github.com&#x2F;wuuu0&#x2F;NewsHub项目演示：https:&#x2F;&#x2F;qcigwi.app.cloudendpoint.cn 技术选型前端：React (hooks) + React Router + Redux + Axios + Antd后端：Json Server（辅助前端开发）、Express + 字节跳">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/02/19/IB35YnE1RiWUjMw.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/11/DR3PBFC48jlXKcm.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/12/uwWLgpDzxUyjs17.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/14/q2Bw9AKTzf5hbZl.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/16/6rqfuFGjBEzJHL5.jpg">
<meta property="og:image" content="https://s2.loli.net/2022/02/15/IPOWxvJeVd8bzNp.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/15/CDLHMld96zOt8VZ.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/15/WvzcJCUHKBhnQaY.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/16/nx5jC3M6ZRqPhLI.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/16/6yjGT4FLPNRhHpu.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/17/srl8SGRbipWNyPv.png">
<meta property="article:published_time" content="2022-02-10T07:03:34.000Z">
<meta property="article:modified_time" content="2022-02-19T15:41:37.000Z">
<meta property="article:author" content="Wu Chaojie">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/02/19/IB35YnE1RiWUjMw.png">


<link rel="canonical" href="http://example.com/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/","path":"2022/02/10/全球新闻发布管理系统项目/","title":"新闻发布管理系统实战——React全家桶前端+轻服务后端"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>新闻发布管理系统实战——React全家桶前端+轻服务后端 | Wu's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Wu's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CS Tech</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%A7%88"><span class="nav-number">1.</span> <span class="nav-text">概览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">项目简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="nav-number">1.2.</span> <span class="nav-text">技术选型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82-%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">功能需求+组织架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8"><span class="nav-number">2.</span> <span class="nav-text">项目启动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="nav-number">2.1.</span> <span class="nav-text">项目创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.1.</span> <span class="nav-text">基本配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-CSS-Module"><span class="nav-number">2.1.2.</span> <span class="nav-text">使用 CSS Module</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SASS"><span class="nav-number">2.1.3.</span> <span class="nav-text">使用 SASS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">2.1.4.</span> <span class="nav-text">设置反向代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E6%9E%B6%E6%9E%84"><span class="nav-number">2.1.5.</span> <span class="nav-text">路由架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5-Ant-Design"><span class="nav-number">2.1.6.</span> <span class="nav-text">引入 Ant Design</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Json-Server-%E6%A8%A1%E6%8B%9F%E5%90%8E%E7%AB%AF"><span class="nav-number">2.1.7.</span> <span class="nav-text">使用 Json Server 模拟后端</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">项目实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2-lt-NewsSandBox-gt"><span class="nav-number">3.1.</span> <span class="nav-text">后端管理页面 &lt;&#x2F;NewsSandBox&#x2F;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-Layout"><span class="nav-number">3.1.1.</span> <span class="nav-text">页面布局 Layout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B6%E9%83%A8%E6%A0%8F-lt-TopHeader-gt"><span class="nav-number">3.1.2.</span> <span class="nav-text">顶部栏 &lt;&#x2F;TopHeader&#x2F;&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%A7%E8%BE%B9%E6%A0%8F-lt-SideMenu-gt"><span class="nav-number">3.1.3.</span> <span class="nav-text">侧边栏 &lt;&#x2F;SideMenu&#x2F;&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8C%BA%E5%9F%9F-lt-Content-gt"><span class="nav-number">3.1.4.</span> <span class="nav-text">内容区域 &lt;&#x2F;Content&#x2F;&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%AB%99%E8%B7%AF%E7%94%B1%E5%85%B3%E7%B3%BB%E5%B0%8F%E7%BB%93"><span class="nav-number">3.1.5.</span> <span class="nav-text">网站路由关系小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-number">3.2.</span> <span class="nav-text">权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8-lt-RoleList-gt"><span class="nav-number">3.2.1.</span> <span class="nav-text">角色列表 &lt;&#x2F;RoleList&#x2F;&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8-lt-UserList-gt"><span class="nav-number">3.2.2.</span> <span class="nav-text">用户列表 &lt;&#x2F;UserList&#x2F;&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2-lt-Login-gt"><span class="nav-number">3.2.3.</span> <span class="nav-text">登录界面 &lt;&#x2F;Login&#x2F;&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E9%97%BB%E4%B8%9A%E5%8A%A1"><span class="nav-number">3.3.</span> <span class="nav-text">新闻业务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%92%B0%E5%86%99%E6%96%B0%E9%97%BB-lt-NewsAdd-gt"><span class="nav-number">3.3.1.</span> <span class="nav-text">撰写新闻 &lt;&#x2F;NewsAdd&#x2F;&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="nav-number">3.4.</span> <span class="nav-text">状态管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%90%8E%E7%AB%AF%E5%B9%B6%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF"><span class="nav-number">4.</span> <span class="nav-text">添加后端并部署上线</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E8%BD%BB%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="nav-number">4.1.</span> <span class="nav-text">字节跳动轻服务简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%91%E5%B7%A5%E7%A8%8B"><span class="nav-number">4.1.1.</span> <span class="nav-text">云工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.1.2.</span> <span class="nav-text">数据库</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wu Chaojie"
      src="/images/miao.gif">
  <p class="site-author-name" itemprop="name">Wu Chaojie</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wuuu0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wuuu0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          新闻发布管理系统实战——React全家桶前端+轻服务后端
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-10 15:03:34" itemprop="dateCreated datePublished" datetime="2022-02-10T15:03:34+08:00">2022-02-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-19 23:41:37" itemprop="dateModified" datetime="2022-02-19T23:41:37+08:00">2022-02-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h3><p>本项目实现了一个新闻展示+后台管理网站</p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/wuuu0/NewsHub">https://github.com/wuuu0/NewsHub</a><br>项目演示：<a target="_blank" rel="noopener" href="https://qcigwi.app.cloudendpoint.cn/">https://qcigwi.app.cloudendpoint.cn</a></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p>前端：React (hooks) + React Router + Redux + Axios + Antd<br>后端：Json Server（辅助前端开发）、Express + 字节跳动轻服务</p>
<h3 id="功能需求-组织架构"><a href="#功能需求-组织架构" class="headerlink" title="功能需求+组织架构"></a>功能需求+组织架构</h3><ul>
<li>前端：</li>
</ul>
<div align="center">
<img src="https://s2.loli.net/2022/02/19/IB35YnE1RiWUjMw.png" width=90%>
</div>

<ul>
<li>后端：</li>
</ul>
<ol>
<li>数据库设计：</li>
</ol>
<ul>
<li>rights</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>权限Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>权限名/侧边栏导航项标题</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>路由地址当作key</td>
</tr>
<tr>
<td>pagepermisson</td>
<td>Number</td>
<td>开关状态，用于判断权限是否可用</td>
</tr>
<tr>
<td>grade</td>
<td>Number</td>
<td>权限层级（默认1）</td>
</tr>
</tbody></table>
<ul>
<li>children</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>权限Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>权限名/导航项标题/功能名称</td>
</tr>
<tr>
<td>rightId</td>
<td>Number</td>
<td>对应一级权限的Id</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>路由地址当作key</td>
</tr>
<tr>
<td>pagepermisson</td>
<td>Number</td>
<td>开关状态，用于判断权限是否可用；<br>非路由权限没有此字段</td>
</tr>
<tr>
<td>grade</td>
<td>Number</td>
<td>权限层级（默认2）</td>
</tr>
</tbody></table>
<ul>
<li>users</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>用户Id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>密码</td>
</tr>
<tr>
<td>roleState</td>
<td>Bool</td>
<td>开关状态，用于判断用户是否可用</td>
</tr>
<tr>
<td>default</td>
<td>Bool</td>
<td>用于判断用户是否可编辑</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>用户地区</td>
</tr>
<tr>
<td>roleId</td>
<td>Number</td>
<td>用户角色的Id</td>
</tr>
</tbody></table>
<ul>
<li>roles</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>角色Id</td>
</tr>
<tr>
<td>roleName</td>
<td>String</td>
<td>角色名称</td>
</tr>
<tr>
<td>roleType</td>
<td>Number</td>
<td>角色类型</td>
</tr>
<tr>
<td>rights</td>
<td>Array-String</td>
<td>角色权限列表，<br>权限用路由地址表示</td>
</tr>
</tbody></table>
<ul>
<li>categories</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>文章类别Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>文章类别标题</td>
</tr>
<tr>
<td>value</td>
<td>String</td>
<td>文章类别值（备用）</td>
</tr>
</tbody></table>
<ul>
<li>regions</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>地区Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>地区标题</td>
</tr>
<tr>
<td>value</td>
<td>String</td>
<td>地区值（备用）</td>
</tr>
</tbody></table>
<ul>
<li>news</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>文章Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>文章标题</td>
</tr>
<tr>
<td>categoryId</td>
<td>Number</td>
<td>文章类别Id</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td>文章内容-html格式</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>文章作者所在区域</td>
</tr>
<tr>
<td>author</td>
<td>String</td>
<td>作者用户名</td>
</tr>
<tr>
<td>roleId</td>
<td>Number</td>
<td>作者角色Id</td>
</tr>
<tr>
<td>auditState</td>
<td>Number</td>
<td>审核状态</td>
</tr>
<tr>
<td>publishState</td>
<td>Number</td>
<td>发布状态</td>
</tr>
<tr>
<td>createTime</td>
<td>Number</td>
<td>创建时间</td>
</tr>
<tr>
<td>star</td>
<td>Number</td>
<td>获赞数</td>
</tr>
<tr>
<td>view</td>
<td>Number</td>
<td>浏览数</td>
</tr>
<tr>
<td>publishTime</td>
<td>Number</td>
<td>发表时间</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口 API</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">users</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - username</span><br><span class="line">            | - password</span><br><span class="line">            | - roleState</span><br><span class="line">            | - _expand=role</span><br><span class="line">| - post</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">roles</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">children</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">rights</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - _embed = children</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">categories</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">regions</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line"></span><br><span class="line">news</span><br><span class="line">| - get</span><br><span class="line">    | - /:id</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - _expand=category</span><br><span class="line">            | - _expand=role</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString</span><br><span class="line">            | - publishState</span><br><span class="line">            | - author=$&#123;username&#125;</span><br><span class="line">            | - auditState=1</span><br><span class="line">            | - _expand=category</span><br><span class="line">            | - _sort=view</span><br><span class="line">            | - _order=desc</span><br><span class="line">            | - _limit=6</span><br><span class="line">| - post</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br></pre></td></tr></table></figure>

<h2 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h2><h3 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h3><p>借助 React 官方脚手架创建项目和进行工程化开发</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/getting-started/">create-react-app 官方文档</a></p>
<h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><p>包版本管理使用 npm</p>
<p>安装 React</p>
<p>使用 React 提供的脚手架 create-react-app 创建项目 newssystem</p>
<p>将 App.js 中的传统的组件类的写法，更换成 React Hooks 写法</p>
<h4 id="使用-CSS-Module"><a href="#使用-CSS-Module" class="headerlink" title="使用 CSS Module"></a>使用 CSS Module</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/adding-a-css-modules-stylesheet/">Create React App 中文文档：添加 CSS Modules 样式表</a>、<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html">CSS Modules 用法教程 阮一峰</a></p>
<p>简而言之：使用 CSS Module 可以让 CSS 声明局部作用于个别的组件上，而不是影响全局的组件/html元素。</p>
<p>原理：CSS Module 只对类或者id选择器起作用。通过构建工具，CSS Module 中的类或者id选择器名会被编码，然后再挂载到html中。将 CSS Module 中的样式 import 到一个对象中（下例为style对象），然后我们通过这个对象来获取编码后的类名或id名，再添加给组件/元素。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;./Child.module.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(style)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;style.item&#125;</span>&gt;</span>child-11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;style.item&#125;</span>&gt;</span>child-11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Child.module.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-SASS"><a href="#使用-SASS" class="headerlink" title="使用 SASS"></a>使用 SASS</h4><p>参考：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/adding-a-sass-stylesheet/">Create React App 中文文档：添加 Sass 样式表</a></p>
<p>安装好 sass 后，React 脚手架可以自动识别并处理<code>.sass</code>文件，使得 Sass 语法生效。可以结合 CSS Module 来使用（即同样延续了上小结的 CSS 局部作用域）。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Child.module.sass */</span></span><br><span class="line"></span><br><span class="line">$<span class="attribute">width</span>:<span class="number">300px</span>;</span><br><span class="line"><span class="selector-tag">ul</span>&#123;</span><br><span class="line">    <span class="selector-class">.item</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: $width;</span><br><span class="line">        <span class="attribute">background-color</span>: red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="设置反向代理"><a href="#设置反向代理" class="headerlink" title="设置反向代理"></a>设置反向代理</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/proxying-api-requests-in-development/#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86">手动配置代理</a></p>
<p>前端可能需要向后端请求一些数据，而后端可能与我们的页面不同源，也就是存在跨域。因此，我们要设置反向代理来方便我们对后端进行跨域请求。</p>
<p>此处我们先安装并<code>import axios</code>来进行后端请求测试。（本项目的请求也都使用 axios）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//这是一个跨域请求，在未设置代理的情况下会报错。</span></span><br><span class="line">    axios.get(<span class="string">&quot;https://m.maoyan.com/ajax/movieOnInfoList?token=&amp;optimus_uuid=74B5F0A032A711EB82DD6B9282E93C676D27D7B9731D4E608D7612C3E708C120&amp;optimus_risk_level=71&amp;optimus_code=10&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    app</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>22222<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Child</span>/&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们设置代理。首先安装<code>http-proxy-middleware</code>。接下来，将上方代码中请求的URL的主机域名<code>https://m.maoyan.com</code>删掉，然后创建<code>src/setupProxy.js</code>并将以下内容放入该文件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(</span><br><span class="line">    <span class="string">&#x27;/ajax&#x27;</span>,</span><br><span class="line">    createProxyMiddleware(&#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&#x27;https://m.maoyan.com&#x27;</span>,</span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>PS：此处的跨域请求只是示例，具体情况具体分析。比如我们后面可能要向后端服务器请求数据，然后我们本地开发的时候是用 <code>https://localhost:xxxx</code> 来模拟后端服务器，那么<code>setupProxy.js</code>中的<code>target</code>就要修改成<code>https://localhost:xxxx</code>。</p>
<p>此外，我们请求成功后获取json格式的数据，如下所示（详见HTTP知识）。</p>
<figure class="highlight plaintext"><figcaption><span>tidy</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;chiefBonus&quot;:&#123;&quot;1433696&quot;:[&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p0.meituan.net/movie/3c38fac891a015c4d7762267a25e40d684709.jpg&quot;,&quot;chiefName&quot;:&quot;马丽&quot;&#125;,&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p0.meituan.net/movie/f9d2ab86553fbdbb615e55dfff74f0b678394.jpg&quot;,&quot;chiefName&quot;:&quot;周大勇&quot;&#125;,&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p1.meituan.net/movie/39069df1dd096df841d20abaf80264e970266.jpg&quot;,&quot;chiefName&quot;:&quot;陈明昊&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>前后端的接口就围绕着这种json数据格式，前端向后端请求获得json数据来进行组件的渲染、权限开关等功能，而后端则需要写好数据库增删查改、整合形成前端需要的json数据等逻辑。</p>
<p>这涉及到：产品需求分析、产品业务逻辑、前后端分工：</p>
<ul>
<li>前端：确定要实现什么产品功能，用户交互时要返回什么数据来实现这个功能</li>
<li>后端：如何组织存储数据，接到前端请求如何返回前端需要的数据</li>
</ul>
<h4 id="路由架构"><a href="#路由架构" class="headerlink" title="路由架构"></a>路由架构</h4><p>参考内容：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903923963133959">掘金 前端路由和后端路由简单总结</a></p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/11/DR3PBFC48jlXKcm.png" width=60%>
</div>

<p>安装<code>react-router-dom</code>。</p>
<p>更具路由结构，确定工程目录结构：</p>
<p>views 目录下针对每个路由都创建一个文件夹，用来存放相应的组件和css等。每一个（前端）路由都对应一个组件，而这些组件中由包括对应的后端路由，向后端请求相应的数据。三个一级路由<code>/login</code> <code>/</code> <code>/news</code>分别对应三个大的页面：<strong>登录页面</strong>、<strong>后端管理系统页面</strong>、<strong>新闻展示页面</strong>。</p>
<p>component 目录则存放 views 目录中组件可能用到的子组件。</p>
<h4 id="引入-Ant-Design"><a href="#引入-Ant-Design" class="headerlink" title="引入 Ant Design"></a>引入 Ant Design</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/docs/react/use-with-create-react-app-cn">Ant Design: 在 create-react-app 中使用</a></p>
<p>安装 ant design</p>
<p>修改 src/App.js，引入 src/App.css；<br>修改 src/App.css，在文件顶部引入 antd/dist/antd.css</p>
<blockquote>
<p>这样就做到了 antd 的样式全局生效，即任何地方引入的antd组件都有用。但有些组件还需手动引入文档给出的样式，比如后面用到的 layout</p>
</blockquote>
<p>然后就可以在各处引入 antd 组件来使用了。</p>
<h4 id="使用-Json-Server-模拟后端"><a href="#使用-Json-Server-模拟后端" class="headerlink" title="使用 Json Server 模拟后端"></a>使用 Json Server 模拟后端</h4><p>数据库数据格式设计：</p>
<p>Json Server 基本使用：</p>
<h2 id="项目实现"><a href="#项目实现" class="headerlink" title="项目实现"></a>项目实现</h2><h3 id="后端管理页面-lt-NewsSandBox-gt"><a href="#后端管理页面-lt-NewsSandBox-gt" class="headerlink" title="后端管理页面 &lt;/NewsSandBox/&gt;"></a>后端管理页面 &lt;/NewsSandBox/&gt;</h3><p>对应 src/views/sandbox 文件夹</p>
<h4 id="页面布局-Layout"><a href="#页面布局-Layout" class="headerlink" title="页面布局 Layout"></a>页面布局 Layout</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/components/layout-cn/#components-layout-demo-side">Ant Design：Layout 布局</a></p>
<p>页面的实现（样式布局，交互效果）主要依赖 antd 的 layout 组件，但是要自己拆解拆解组合。</p>
<p>Antd Layout 效果图</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/12/uwWLgpDzxUyjs17.png" width=90%>
</div>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Ant Design：Layout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文档给出的是类写法，我们要改成 Hooks 写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文档点击按钮侧边栏缩放，是通过 layout 的父组件的 state：collapsed 进行子组件间的通信。后面我们要统一用 Redux 进行状态管理。</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span> <span class="attr">collapsible</span> <span class="attr">collapsed</span>=<span class="string">&#123;this.state.collapsed&#125;</span>&gt;</span> ---------------&gt; ours <span class="tag">&lt;<span class="name">SideMenu</span>/&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span> <span class="attr">defaultSelectedKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">1</span>&#x27;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 1</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">VideoCameraOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 2</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UploadOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 3</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;site-layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> <span class="attr">0</span> &#125;&#125;&gt;</span> ---------------&gt; ours <span class="tag">&lt;<span class="name">TopHeader</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;React.createElement(this.state.collapsed ? MenuUnfoldOutlined : MenuFoldOutlined, &#123;</span></span><br><span class="line"><span class="xml">              className: &#x27;trigger&#x27;,</span></span><br><span class="line"><span class="xml">              onClick: this.toggle,</span></span><br><span class="line"><span class="xml">            &#125;)&#125; -----------------------------------------------&gt; 改改，写回纯组件形式，记得补上类和事件处理函数</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">margin:</span> &#x27;<span class="attr">24px</span> <span class="attr">16px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">padding:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">minHeight:</span> <span class="attr">280</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">          &gt;</span></span></span><br><span class="line"><span class="xml">            Content ---------------------------------------------------&gt; ours 路由组件</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>改造后</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsSandBox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面进度条</span></span><br><span class="line">    NProgress.start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 渲染完成，进度条结束</span></span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        NProgress.done()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">SideMenu</span>&gt;</span><span class="tag">&lt;/<span class="name">SideMenu</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;site-layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">TopHeader</span>&gt;</span><span class="tag">&lt;/<span class="name">TopHeader</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">margin:</span> &#x27;<span class="attr">24px</span> <span class="attr">16px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">padding:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">minHeight:</span> <span class="attr">280</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">overflow:</span>&quot;<span class="attr">auto</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">NewsRouter</span>&gt;</span><span class="tag">&lt;/<span class="name">NewsRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="顶部栏-lt-TopHeader-gt"><a href="#顶部栏-lt-TopHeader-gt" class="headerlink" title="顶部栏 &lt;/TopHeader/&gt;"></a>顶部栏 &lt;/TopHeader/&gt;</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/components/dropdown-cn/">Ant Design：Dropdown下拉菜单</a></p>
<p>左方的按钮设置一下；顶部栏右上角添加一个下拉菜单，用来控制用户登录退出——目前还没有实现用户登录功能，所以这个下拉菜单栏先设计出来占个位。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TopHeader</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [collapsed, setCollapsed] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> changeCollapsed = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setCollapsed(!collapsed)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> menu = (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                超级管理员</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">danger</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> &#x27;<span class="attr">0</span> <span class="attr">16px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                collapsed ? <span class="tag">&lt;<span class="name">MenuUnfoldOutlined</span> <span class="attr">onClick</span>=<span class="string">&#123;changeCollapsed&#125;</span> /&gt;</span> : <span class="tag">&lt;<span class="name">MenuFoldOutlined</span> <span class="attr">onClick</span>=<span class="string">&#123;changeCollapsed&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">float:</span> &quot;<span class="attr">right</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎admin回来<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Dropdown</span> <span class="attr">overlay</span>=<span class="string">&#123;menu&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Dropdown</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="侧边栏-lt-SideMenu-gt"><a href="#侧边栏-lt-SideMenu-gt" class="headerlink" title="侧边栏 &lt;/SideMenu/&gt;"></a>侧边栏 &lt;/SideMenu/&gt;</h4><p>侧边栏左上角添加“全球新闻发布系统”标题</p>
<p>查看 antd layout 文档，为侧边栏添加二级下拉菜单：<a target="_blank" rel="noopener" href="https://ant.design/components/menu-cn/#components-menu-demo-inline">Ant Design：SubMenu 内嵌菜单</a></p>
<p>大致摸清了前端实现界面的方法（组件），就开始考虑从后端接受类似是数组的数据，前端根据后端的数据，动态的确定我们页面的情况。大致思路：</p>
<ul>
<li><code>&lt;SideMenu/&gt;</code>组件写一个副作用<code>useEffect</code>，在它挂载/渲染时就向后端请求数据（类似数组结构数据），然后根据后端的数组数据来渲染我们的侧边栏。渲染侧边栏的时候，还需要检查校验用户权限+权限管理开关状态。</li>
<li><code>Menu</code>的每项<code>item</code>都有一个<code>key</code>属性，可以将该<code>key</code>设置为我们的前端路由名。可以给每个菜单项设置一个对应的 OnCLick 属性，点到对应的<code>item</code>，就取出<code>key</code>值，并路由到相应的路由组件——<code>content</code>就渲染出对应的组件。</li>
<li>请求的后端<code>/rights?_embed=children</code>数据，读取到前端后的格式如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">menu = [</span><br><span class="line">  &#123;--------------------------------------------&gt; 一项就是一个菜单栏项</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&quot;/home&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;首页&quot;</span>,</span><br><span class="line">    <span class="attr">pagepermision</span>:<span class="number">1</span>, --------------------------&gt; 用于判断是否是渲染：是否为路由级权限 and 该权限是否开放</span><br><span class="line">    <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    children:[]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&quot;/user-manage&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">    <span class="attr">pagepermision</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    children:[ --------------------------------&gt; 二级菜单</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>:<span class="string">&quot;/user-manage/list&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&quot;用户列表&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>SideMenu 组件的实现。具体逻辑看注释。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SideMenu</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [menu, setMeun] = useState([])</span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取完整的权限列表</span></span><br><span class="line">    axios.get(<span class="string">&quot;/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取到数据后根据数据构造 meun 数据</span></span><br><span class="line">      setMeun(res.data)                                  </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据当前登录的用户信息，来获取用户可以使用的权限的列表</span></span><br><span class="line">  <span class="comment">// 用于后续渲染侧边栏时，同后端的完整权限列表作比较，看哪些该渲染出来</span></span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">role</span>:&#123;rights&#125;&#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据获取的用户权限和权限列表的papgepermission属性，进行路由权限管理</span></span><br><span class="line">  <span class="keyword">const</span> checkPagePermission = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.pagepermisson &amp;&amp; rights.includes(item.key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据 menu 数据，返回相应的侧边栏组件。</span></span><br><span class="line">  <span class="comment">// 递归方式：数据中有 children 则渲染出一级菜单再进一步渲染子菜单；</span></span><br><span class="line">  <span class="comment">// 若没有children——也就是到底了，则渲染本身的item。</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> renderMenu = <span class="function">(<span class="params">menuList</span>)=&gt;</span>&#123;                        </span><br><span class="line">    <span class="keyword">return</span> menuList.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(item.children?.length&gt;<span class="number">0</span> &amp;&amp; checkPagePermission(item))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SubMenu</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;iconList[item.key]&#125;</span> <span class="attr">title</span>=<span class="string">&#123;item.title&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">           &#123; renderMenu(item.children) &#125;   </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// js 语法，会先判断第一个的值，若为真则直接返回第二个值</span></span><br><span class="line">      <span class="keyword">return</span> checkPagePermission(item) &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;iconList[item.key]&#125;</span>  <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        // SideMenu 并不直接外接 Router，想使用路由参数需要借助 withRouter</span></span><br><span class="line"><span class="xml">        // SideMenu ---&gt; NewsSandBox ---&gt; SideMenu</span></span><br><span class="line"><span class="xml">        // console.log(props)</span></span><br><span class="line"><span class="xml">        // 这里实现导航功能：</span></span><br><span class="line"><span class="xml">        // 点击侧边栏的最底层项，会设置当前的地址栏为指定路由，进而导致对应路由组件的渲染</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        props.history.push(item.key)</span></span><br><span class="line"><span class="xml">      &#125;&#125;&gt;&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// selectKeys 存放当前的路由路径，用于页面刷新后，菜单栏对应的项保持高亮</span></span><br><span class="line">  <span class="comment">// console.log(props.location.pathname)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selectKeys = [props.location.pathname]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// openKeys 存放当前的路由路径下，侧边栏应该打开的项，需要截取当前路径的一级路径</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> openKeys = [<span class="string">&quot;/&quot;</span>+props.location.pathname.split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 组件初次挂载、副作用向后端请求数据到手后获取设置 state 会触组件更新。毫无疑问</span></span><br><span class="line">  <span class="comment">// Menu 项被点击后也会改变组件的表现，也即更新，这应该是封装在了 antd 中 </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span> <span class="attr">collapsible</span> <span class="attr">collapsed</span>=<span class="string">&#123;props.isCollapsed&#125;</span> &gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;display:</span>&quot;<span class="attr">flex</span>&quot;,<span class="attr">height:</span>&quot;<span class="attr">100</span>%&quot;,&quot;<span class="attr">flexDirection</span>&quot;<span class="attr">:</span>&quot;<span class="attr">column</span>&quot;&#125;&#125;&gt;</span>  // 添加侧边栏部分的滚动条</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> &gt;</span>全球新闻发布管理系统<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;flex:1,</span>&quot;<span class="attr">overflow</span>&quot;<span class="attr">:</span>&quot;<span class="attr">auto</span>&quot;&#125;&#125;&gt;</span>                             // 添加侧边栏部分的滚动条</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">          // selectedKeys 和 defaultSelectedKeys 的区别</span></span><br><span class="line"><span class="xml">          // 前者的值变动时 Menu 组件会更新重新渲染，后者的值只在 Menu 挂载时生效</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span> <span class="attr">selectedKeys</span>=<span class="string">&#123;selectKeys&#125;</span> <span class="attr">className</span>=<span class="string">&quot;aaaaaaa&quot;</span> <span class="attr">defaultOpenKeys</span>=<span class="string">&#123;openKeys&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">              &#123;renderMenu(meun)&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line">  ) </span><br><span class="line"></span><br><span class="line">  <span class="comment">// withRouter 高阶函数，返回一个能够获取路由参数的 SideMenu</span></span><br><span class="line">  <span class="comment">// 后续还要使用 redux，因此还要将状态传输出去</span></span><br></pre></td></tr></table></figure>

<h4 id="内容区域-lt-Content-gt"><a href="#内容区域-lt-Content-gt" class="headerlink" title="内容区域 &lt;/Content/&gt;"></a>内容区域 &lt;/Content/&gt;</h4><p>根据路由选择显示什么组件，目前这些组件尚未实现。在添加路由组件前，还需要检查用户权限和权限管理开关，看是否可以添加。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Content</span><br><span class="line">    className=<span class="string">&quot;site-layout-background&quot;</span></span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">        <span class="attr">margin</span>: <span class="string">&#x27;24px 16px&#x27;</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="attr">minHeight</span>: <span class="number">280</span>,</span><br><span class="line">        <span class="attr">overflow</span>:<span class="string">&quot;auto&quot;</span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">NewsRouter</span>&gt;</span><span class="tag">&lt;/<span class="name">NewsRouter</span>&gt;</span></span></span><br><span class="line">&lt;/Content&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> LocalRouterMap = &#123;</span><br><span class="line">    <span class="string">&quot;/home&quot;</span>: Home,</span><br><span class="line">    <span class="string">&quot;/user-manage/list&quot;</span>: UserList,</span><br><span class="line">    <span class="string">&quot;/right-manage/role/list&quot;</span>: RoleList,</span><br><span class="line">    <span class="string">&quot;/right-manage/right/list&quot;</span>: RightList,</span><br><span class="line">    <span class="string">&quot;/news-manage/add&quot;</span>: NewsAdd,</span><br><span class="line">    <span class="string">&quot;/news-manage/draft&quot;</span>: NewsDraft,</span><br><span class="line">    <span class="string">&quot;/news-manage/category&quot;</span>: NewsCategory,</span><br><span class="line">    <span class="string">&quot;/news-manage/preview/:id&quot;</span>: NewsPreview,</span><br><span class="line">    <span class="string">&quot;/news-manage/update/:id&quot;</span>: NewsUpdate,</span><br><span class="line">    <span class="string">&quot;/audit-manage/audit&quot;</span>: Audit,</span><br><span class="line">    <span class="string">&quot;/audit-manage/list&quot;</span>: AuditList,</span><br><span class="line">    <span class="string">&quot;/publish-manage/unpublished&quot;</span>: Unpublished,</span><br><span class="line">    <span class="string">&quot;/publish-manage/published&quot;</span>: Published,</span><br><span class="line">    <span class="string">&quot;/publish-manage/sunset&quot;</span>: Sunset</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewsRouter</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [BackRouteList, setBackRouteList] = useState([])</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all([</span><br><span class="line">            axios.get(<span class="string">&quot;/rights&quot;</span>),</span><br><span class="line">            axios.get(<span class="string">&quot;/children&quot;</span>),</span><br><span class="line">        ]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// BackRouteList 对应的是完整的权限列表</span></span><br><span class="line">            <span class="comment">// console.log(res)</span></span><br><span class="line">            setBackRouteList([...res[<span class="number">0</span>].data, ...res[<span class="number">1</span>].data])</span><br><span class="line">            <span class="comment">// console.log(BackRouteList)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据用户登录信息，取出用户权限</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">role</span>: &#123; rights &#125; &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查权限是否对应路由组件；检查是否开启，对应我们此前的权限管理中的 switch 开关的功能</span></span><br><span class="line">    <span class="keyword">const</span> checkRoute = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalRouterMap[item.key] &amp;&amp; (item.pagepermisson || item.routepermisson)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查用户是否拥有路由权限</span></span><br><span class="line">    <span class="keyword">const</span> checkUserPermission = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rights.includes(item.key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Spin</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">spinning</span>=<span class="string">&#123;props.isLoading&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    BackRouteList.map(item =&gt; &#123;</span></span><br><span class="line"><span class="xml">                        if (checkRoute(item) &amp;&amp; checkUserPermission(item)) &#123;</span></span><br><span class="line"><span class="xml">                            return <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">component</span>=<span class="string">&#123;LocalRouterMap[item.key]&#125;</span> <span class="attr">exact</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;</span></span><br><span class="line"><span class="xml">                        return null</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                    )</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;/&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">exact</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    BackRouteList.length &gt; 0 &amp;&amp; <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Nopermission&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Spin</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123;LoadingReducer:&#123;isLoading&#125;&#125;</span>)=&gt;</span>(&#123;</span><br><span class="line">    isLoading</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(NewsRouter)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="网站路由关系小结"><a href="#网站路由关系小结" class="headerlink" title="网站路由关系小结"></a>网站路由关系小结</h4><p>输入我们的应用网址：</p>
<ul>
<li><p>未登录会重定向到<code>/login</code></p>
</li>
<li><p>登陆后默认路由至<code>/</code>。<code>/</code>路由对应路由组件<code>&lt;NewSandBox /&gt;</code></p>
<ul>
<li><p>子组件<code>&lt;SideMenu/&gt;</code>有个副作用，会向后端请求<code>rights</code>数据，获取数据后 setState 更新状态并渲染<code>&lt;SideMenu/&gt;</code>；侧边栏有导航作用，即点击侧边栏最底层项，会设置当前路由地址</p>
</li>
<li><p>子组件<code>&lt;Content/&gt;</code>会根据当前路由地址，选择渲染对应的路由组件来显示内容。其中，特别的是，若路由为<code>/</code>则重定向至<code>/home</code>（不会撤销<code>/</code>的路由下已渲染的组件）</p>
</li>
<li><p><code>&lt;SideMenu/&gt;</code> 渲染侧边栏导航项、<code>&lt;Content/&gt;</code> 构建路由组件，都会限制于当前用户的登录权限。详情见 <a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">IndexRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/news&quot;</span> <span class="attr">component</span>=<span class="string">&#123;News&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/detail/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Detail&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;NewsSandBox&#125;/</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml">                // 以下这种路由写法，NewsSandBox 的 props 无法自动拿到 history 等路由参数</span></span><br><span class="line"><span class="xml">                // 并且不直接匹配路由的组件，比如 NewsSandBox 的子组件，也无法自动获取路由参数</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">render</span>=<span class="string">&#123;()</span>=&gt;</span></span></span><br><span class="line"><span class="xml">                    localStorage.getItem(&quot;token&quot;)?</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">NewsSandBox</span> &gt;</span><span class="tag">&lt;/<span class="name">NewsSandBox</span>&gt;</span>:</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;/&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，整个网站的大框架已经基本搭建完成。后端管理页面的导航和路由框架也实现，后续继续添加系统功能，以及实现各分级路由下的<code>&lt;Content/&gt;</code>组件。</p>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>权限管理的业务逻辑：</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/14/q2Bw9AKTzf5hbZl.png" width=70%>
</div>

<div align="center">
  <img src="https://s2.loli.net/2022/02/16/6rqfuFGjBEzJHL5.jpg" width=60%>
</div>

<ul>
<li><p>权限列表<code>rights</code>是最根本的列表，它保存了网址的所有权限。侧边栏根据它来渲染导航项，内容区根据它来添加路由组件。可以直接在这个层级上进行统一的权限开关。</p>
</li>
<li><p>用户系统和角色系统编辑维护<code>users</code>和<code>roles</code>两个列表。届时，要先获取用户信息和其角色信息——包含一个存放角色权限信息的数组。路由在侧边栏<code>SideMenu</code>渲染的时候，以角色权限数组和后端权限列表作比较，来确定是否渲染对应的侧边栏项。关闭侧边栏导航远远不够，为了防止用户直接在地址栏输入相应路由，还需要在编写内容去区<code>Content</code>时，检查用户的角色权限数组，来决定是否添加相应的路由组件。</p>
</li>
<li><p>所谓权限管理：都是通过编辑后端相应的列表数据来实现的。而真正的让权限管理生效，则是通过在前端业务逻辑中，对比用户登录数据和后端数据，来决定是否渲染相应内容来实现——是否渲染侧边栏对应路由权限，是否渲染具体页面中的小组件或下拉栏选项对应非路由权限。</p>
<ul>
<li><p>路由权限：① 针对第一点修改<code>rights</code>表，可以控制<code>SideMenu</code> <code>Content</code>从后端获取的数据进而在前端隐藏相应导航项或路由组件；② 针对第二点修改<code>roles</code> <code>users</code>表，可以控制用户角色，以及特定角色从后端获取到的<code>roles</code>表，在渲染<code>SideMenu</code>和构建<code>Content</code>的时候通过逻辑给绕过某些导航项或路由组件。</p>
</li>
<li><p>非路由权限：① 后台管理页面-用户列表页面：“添加用户”“修改用户”功能，会根据当前用户角色权限来做一定的限制。<code>UserList</code> 根据登录用户角色权限，渲染了有限的用户<code>Table</code>项；<code>UserForm</code>根据登录用户角色权限，让 添加/修改用户 的表单中，只能创建有限种类的区域和角色的用户。② 后台管理页面-新闻、审核、发布管理页面：都需要核验用户登录信息，检查其权限，来确定哪些<code>Table</code>项应该被渲染。</p>
</li>
</ul>
</li>
</ul>
<p>接下来，我们先实现这三个列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在后续编写代码时，我们要时刻清楚：前端基于什么数据渲染？前端交互效果是如何？对应了什么后端数据库操作？</span><br><span class="line"></span><br><span class="line">此外，我们约定，前端只能对后端 ```rights``` ```roles``` 表进行删除项不能添加项，也不能修改 ID、名称等信息。</span><br><span class="line"></span><br><span class="line">#### 权限列表 &lt;/RightList/&gt;</span><br><span class="line"></span><br><span class="line">参考资料：[Ant design：Table表格](https://ant.design/components/table-cn/#components-table-demo-basic)</span><br><span class="line"></span><br><span class="line">&lt;div align=&quot;center&quot;&gt;</span><br><span class="line">  &lt;img src=&quot;https://s2.loli.net/2022/02/14/QhVJPz4ElvjIfZK.png&quot; width=70%&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">权限列表组件的实现比较简单。</span><br><span class="line"></span><br><span class="line">- 首先向后端获取```/rights?_embed=children```数据</span><br><span class="line"></span><br><span class="line">- 使用 antd ```&lt;Table/&gt;``` 组件，展示后端数据。还用到 ```Button``` ```Modal``` ```Popover``` 等组件。参考文档，根据我们的需求进行自定义设置。</span><br><span class="line"></span><br><span class="line">- 删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新（前端，立即有效果），同时调用后端接口修改数据库表（需要刷新页面，才有效果——SideMenu组件重新挂载，向后端申请数据，才有效）。就是删除```rights```表中的某一项权限。</span><br><span class="line"></span><br><span class="line">- 开关权限：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。就是修改```rigths```表中某一项权限的```pagepermission```值。</span><br><span class="line"></span><br><span class="line">PS：前端显示的内容都来自于后端，直觉上可能会觉得：我们操作更新后端，前端的数据不也就更新了吗？何必还要多写一次更新前端？但我们实现的时候，只是在组件挂载的时候（```useEffect```第二个参数填```[]```，不然的话在副作用中更新状态，会导致无限循环）请求后端数据，因此需要刷新页面重新向后端请求数据，前端才会更新。因此，最好在我们操作的时候实现就手动更新前端，这样用户体验会好很多。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```jsx</span><br><span class="line">export default function RightList() &#123;</span><br><span class="line">    const [dataSource, setdataSource] = useState([])</span><br><span class="line"></span><br><span class="line">    useEffect(() =&gt; &#123;</span><br><span class="line">        axios.get(&quot;/rights?_embed=children&quot;).then(res =&gt; &#123;</span><br><span class="line">            const list = res.data</span><br><span class="line"></span><br><span class="line">            list.forEach(item =&gt; &#123;</span><br><span class="line">                if (item.children.length === 0) &#123;</span><br><span class="line">                    item.children = &quot;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            setdataSource(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    const columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            title: &#x27;ID&#x27;,</span><br><span class="line">            dataIndex: &#x27;id&#x27;,</span><br><span class="line">            render: (id) =&gt; &#123;</span><br><span class="line">                return &lt;b&gt;&#123;id&#125;&lt;/b&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            title: &#x27;权限名称&#x27;,</span><br><span class="line">            dataIndex: &#x27;title&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            title: &quot;权限路径&quot;,</span><br><span class="line">            dataIndex: &#x27;key&#x27;,</span><br><span class="line">            render: (key) =&gt; &#123;</span><br><span class="line">                return &lt;Tag color=&quot;orange&quot;&gt;&#123;key&#125;&lt;/Tag&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            title: &quot;操作&quot;,</span><br><span class="line"></span><br><span class="line">            // 设置 dataIndex，则会将源数组中的一个完整对象传给 render 的形参  </span><br><span class="line">            render: (item) =&gt; &#123;</span><br><span class="line">                return &lt;div&gt;</span><br><span class="line">                    &lt;Button danger shape=&quot;circle&quot; icon=&#123;&lt;DeleteOutlined /&gt;&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; /&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;Popover content=&#123;&lt;div style=&#123;&#123;textAlign:&quot;center&quot;&#125;&#125;&gt;</span><br><span class="line">                        &lt;Switch checked=&#123;item.pagepermisson&#125; onChange=&#123;()=&gt;switchMethod(item)&#125;&gt;&lt;/Switch&gt;</span><br><span class="line">                    &lt;/div&gt;&#125; title=&quot;页面配置项&quot; trigger=&#123;item.pagepermisson===undefined?&#x27;&#x27;:&#x27;click&#x27;&#125;&gt;</span><br><span class="line">                        &lt;Button type=&quot;primary&quot; shape=&quot;circle&quot; icon=&#123;&lt;EditOutlined /&gt;&#125; disabled=&#123;item.pagepermisson===undefined&#125;/&gt;</span><br><span class="line">                    &lt;/Popover&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    const  switchMethod = (item)=&gt;&#123;</span><br><span class="line">        item.pagepermisson = item.pagepermisson===1?0:1</span><br><span class="line">        // console.log(item)</span><br><span class="line">        setdataSource([...dataSource])</span><br><span class="line"></span><br><span class="line">        if(item.grade===1)&#123;</span><br><span class="line">            axios.patch(`/rights/$&#123;item.id&#125;`,&#123;</span><br><span class="line">                pagepermisson:item.pagepermisson</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            axios.patch(`/children/$&#123;item.id&#125;`,&#123;</span><br><span class="line">                pagepermisson:item.pagepermisson</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const confirmMethod = (item) =&gt; &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            title: &#x27;你确定要删除?&#x27;,</span><br><span class="line">            icon: &lt;ExclamationCircleOutlined /&gt;,</span><br><span class="line">            // content: &#x27;Some descriptions&#x27;,</span><br><span class="line">            onOk() &#123;</span><br><span class="line">                //   console.log(&#x27;OK&#x27;);</span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            onCancel() &#123;</span><br><span class="line">                //   console.log(&#x27;Cancel&#x27;);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    //删除</span><br><span class="line">    const deleteMethod = (item) =&gt; &#123;</span><br><span class="line">        // console.log(item)</span><br><span class="line">        // 当前页面同步状态 + 后端同步</span><br><span class="line">        if (item.grade === 1) &#123;</span><br><span class="line">            setdataSource(dataSource.filter(data =&gt; data.id !== item.id))</span><br><span class="line">            axios.delete(`/rights/$&#123;item.id&#125;`)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line"></span><br><span class="line">            // antd-Table 支持树形数据的展示。数据中有 children 字段的时候会自动展示位树形结构。</span><br><span class="line">            // 且默认情况下 children 数组在表格中的渲染，同样遵循 columns 中的设置</span><br><span class="line">            // 所以这里 item 对应的是 children 数组中的单个对象；datasource 仍是完整的链接过的表</span><br><span class="line">            let list = dataSource.filter(data=&gt;data.id===item.rightId)</span><br><span class="line">            list[0].children = list[0].children.filter(data=&gt;data.id!==item.id)</span><br><span class="line">            </span><br><span class="line">            // 注意，要返回一个新的数组，以确保能识别到 dataSource 有所改变</span><br><span class="line">            setdataSource([...dataSource])</span><br><span class="line">            axios.delete(`/children/$&#123;item.id&#125;`)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Table dataSource=&#123;dataSource&#125; columns=&#123;columns&#125;</span><br><span class="line">                pagination=&#123;&#123;</span><br><span class="line">                    pageSize: 5</span><br><span class="line">                &#125;&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="角色列表-lt-RoleList-gt"><a href="#角色列表-lt-RoleList-gt" class="headerlink" title="角色列表 &lt;/RoleList/&gt;"></a>角色列表 &lt;/RoleList/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/15/IPOWxvJeVd8bzNp.png" width=70%>
</div>

<p>思路和 <strong>权限列表</strong> 类似。</p>
<ul>
<li><p>挂载时向后端请求数据<code>/roles</code>和<code>/rights?_embed=children</code></p>
</li>
<li><p>用到的 antd 组件主要是<code>Table</code> <code>Modal</code> <code>Tree</code>。<code>Table</code>展示<code>roles</code>列表信息。</p>
</li>
<li><p>删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即删除<code>roles</code>列表中的某一个角色。</p>
</li>
<li><p>编辑角色权限：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即点到相应角色，弹出框显示<code>rights?_embed=children</code>所有权限，并默认勾选上该角色有的权限即<code>role.rights</code>数组。然后在前端勾选或取消某些权限，就会将前端的<code>role.rights</code> <code>patch</code>到后端，实现修改后端的<code>role.rights</code>。</p>
</li>
</ul>
<p>但此处有一部分功能没实现：</p>
<p>如开头<a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a>所述，我们的权限管理是通过侧边栏的导航是否隐藏来实现的。而侧边栏的渲染取决于<code>rights?_embed=children</code>表和当前登录用户的<code>role.rights</code>表。当我们在用户列表页面取消导航路由相关的权限时，侧边栏渲染时检查<code>role.rights</code>发现没有，自然不会渲染出来，能够成功实现权限管理；但当我们在用户列表取消修改角色、删除角色这类非导航路由的权限时，虽然后端<code>role.rights</code>依旧会删除相应的项，但由于我们并没有实现对<strong>非导航路由</strong>权限的检查，因此会发现，相应的角色依旧能够修改删除角色。</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/15/CDLHMld96zOt8VZ.png" width=50%>
</div>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">RoleList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setdataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [rightList, setRightList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [currentRights, setcurrentRights] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [currentId, setcurrentId] = useState(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [isModalVisible, setisModalVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleName&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; onClick=&#123;()=&gt;&#123;</span></span><br><span class="line"><span class="xml">                        setisModalVisible(true)</span></span><br><span class="line"><span class="xml">                        setcurrentRights(item.rights)</span></span><br><span class="line"><span class="xml">                        setcurrentId(item.id)</span></span><br><span class="line"><span class="xml">                    &#125;&#125;/&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;你确定要删除?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="comment">// content: &#x27;Some descriptions&#x27;,</span></span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;Cancel&#x27;);</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="keyword">const</span> deleteMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        setdataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id))</span><br><span class="line">        axios.delete(<span class="string">`/roles/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/roles&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data)</span></span><br><span class="line">            setdataSource(res.data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data)</span></span><br><span class="line">            setRightList(res.data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确认之后，隐藏 Modal-Tree 框</span></span><br><span class="line">    <span class="comment">// 根据 currentRights ，更新 Table 的表现，并更新后端数据</span></span><br><span class="line">    <span class="keyword">const</span> handleOk = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(currentRights,currentId)</span><br><span class="line">        setisModalVisible(<span class="literal">false</span>)</span><br><span class="line">        <span class="comment">//同步datasource</span></span><br><span class="line">        setdataSource(dataSource.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(item.id===currentId)&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    ...item,</span><br><span class="line">                    <span class="attr">rights</span>:currentRights</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">//patch</span></span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/roles/<span class="subst">$&#123;currentId&#125;</span>`</span>,&#123;</span><br><span class="line">            <span class="attr">rights</span>:currentRights</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleCancel  =<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setisModalVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每点一个选项，Tree 组件就会记录当前选中的所有项</span></span><br><span class="line">    <span class="comment">// checkKeys 形参就是接收点击后的所有选择项</span></span><br><span class="line">    <span class="comment">// 每点一次选项，就更新 currentRights，进而更新 Tree 的表现</span></span><br><span class="line">    <span class="keyword">const</span> onCheck = <span class="function">(<span class="params">checkKeys</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// console.log(checkKeys)</span></span><br><span class="line">        setcurrentRights(checkKeys.checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            // Table 组件 要求 dataSource 数组的对象都要有 “key” 属性</span></span><br><span class="line"><span class="xml">            // 当没有 “key” 属性时，要设置 rowKey 属性 指定一个属性代替 “key” </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rowKey</span>=<span class="string">&#123;(item)</span> =&gt;</span> item.id&#125;&gt;<span class="tag">&lt;/<span class="name">Table</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            // Modal 和 Table 的关系更像是并行关系。</span></span><br><span class="line"><span class="xml">            // 但是 Table 中的按钮控制 Modal 的出现和消失，并且两者共享 currentRights 状态</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span> <span class="attr">title</span>=<span class="string">&quot;权限分配&quot;</span> <span class="attr">visible</span>=<span class="string">&#123;isModalVisible&#125;</span> <span class="attr">onOk</span>=<span class="string">&#123;handleOk&#125;</span> <span class="attr">onCancel</span>=<span class="string">&#123;handleCancel&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            </span></span><br><span class="line"><span class="xml">            // 注意 checkedKeys 和 onCheck 的形参不是一回事</span></span><br><span class="line"><span class="xml">            // checkedKeys 属性决定了树形复选框的当前勾选表现 </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tree</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkable</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkedKeys</span> = <span class="string">&#123;currentRights&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCheck</span>=<span class="string">&#123;onCheck&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkStrictly</span> = <span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">treeData</span>=<span class="string">&#123;rightList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            /&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="用户列表-lt-UserList-gt"><a href="#用户列表-lt-UserList-gt" class="headerlink" title="用户列表 &lt;/UserList/&gt;"></a>用户列表 &lt;/UserList/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/15/WvzcJCUHKBhnQaY.png" width=70%>
</div>

<p>大同思路和 <strong>角色列表</strong> 类似</p>
<ul>
<li><p>挂载时向后端请求数据<code>/users?_expand=role</code> <code>/roles</code> <code>/regions</code>列表</p>
</li>
<li><p>用到的 antd 组件主要是<code>Table</code> <code>Modal</code> <code>Form</code>。<code>Table</code>展示<code>roles</code>列表信息。</p>
</li>
<li><p>删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即删除<code>users</code>列表中的某一个用户。</p>
</li>
<li><p>更新用户</p>
</li>
<li><p>添加用户</p>
</li>
</ul>
<p>特别的</p>
<ul>
<li><p>类似的，角色列表中的权限管理中关于用户的<strong>非路由权限</strong>的管理是无效的——比如添加用户、删除用户。因为<code>UserList</code>仅利用<code>user</code>的<code>role</code>的名称/类型进行逻辑判断，来决定添加用户时的可设置项，与<code>role.rights</code>无关。</p>
</li>
<li><p>关于添加用户、更新用户功能。这里的<code>Modal</code>作为父组件，在点击确定是，需要使用 ref 来获取子组件<code>UserForm</code>的属性（添加用户完成后，获取新用户的用户名等信息），然后前端更新 Table 组件表现并同步更新后端<code>users</code>列表。这里的业务逻辑和用户列表页面大致相同，不同的是用户列表页面是在外部设置了一个共享的<code>currentRights</code>状态，让父组件<code>Modal</code>能获取子组件<code>Tree</code>的属性。这主要是因为此处使用了<code>Form</code>表单。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setdataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [isAddVisible, setisAddVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [isUpdateVisible, setisUpdateVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [roleList, setroleList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [regionList, setregionList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [current, setcurrent] = useState(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [isUpdateDisabled, setisUpdateDisabled] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> addForm = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> updateForm = useRef(<span class="literal">null</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户登录信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123;roleId,region,username&#125;  = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line">        <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">            <span class="string">&quot;1&quot;</span>:<span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;2&quot;</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;3&quot;</span>:<span class="string">&quot;editor&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        axios.get(<span class="string">&quot;/users?_expand=role&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据当前登录身份，来选择性渲染用户界面 Table</span></span><br><span class="line">            setdataSource(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>?list:[</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.username===username),</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.region===region&amp;&amp; roleObj[item.roleId]===<span class="string">&quot;editor&quot;</span>)</span><br><span class="line">            ])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [roleId,region,username])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/regions&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line">            setregionList(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/roles&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line">            setroleList(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;区域&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">            <span class="attr">filters</span>: [</span><br><span class="line">                ...regionList.map(<span class="function"><span class="params">item</span>=&gt;</span>(&#123;</span><br><span class="line">                    <span class="attr">text</span>:item.title,</span><br><span class="line">                    <span class="attr">value</span>:item.value</span><br><span class="line">                &#125;)),</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>:<span class="string">&quot;全球&quot;</span>,</span><br><span class="line">                    <span class="attr">value</span>:<span class="string">&quot;全球&quot;</span></span><br><span class="line">                &#125;    </span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="attr">onFilter</span>:<span class="function">(<span class="params">value,item</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(value===<span class="string">&quot;全球&quot;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> item.region===<span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> item.region===value</span><br><span class="line">            &#125;,</span><br><span class="line">          </span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">region</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region === &quot;&quot; ? &#x27;全球&#x27; : region&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">role</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> role?.roleName</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;username&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;用户状态&quot;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleState&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">roleState, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;roleState&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;item.default&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span>=&gt;</span>handleChange(item)&#125;&gt;<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; disabled=&#123;item.default&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; onClick=&#123;()=&gt;handleUpdate(item)&#125;/&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleUpdate = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 此处用 setTimeout，主要是让此处的 setisUpdateVisible</span></span><br><span class="line">        <span class="comment">// 能够同步更新 UpdateVisible 状态，也就是让 Modal 立刻 visible</span></span><br><span class="line">        <span class="comment">// 因为 Modal 不 visible 的话，在首次渲染时，底层 DOM 可能根本不存在？</span></span><br><span class="line">        <span class="comment">// 也就意味着子组件 Form 都还不存在，setFieldsValue 自然无法运行</span></span><br><span class="line">        <span class="comment">// 总之，就是要确保 setFieldsValue 的时候 Form 真实存在</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            setisUpdateVisible(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这里需要手动检查预选结果是否应该禁用区域项，不然的话预选</span></span><br><span class="line">            <span class="comment">// 到管理员也不会禁用区域项，因为一般情况下只会在表单中选角色的时候 onChange</span></span><br><span class="line">            <span class="comment">// 才会进行检查并禁用区域项</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 但还有一个特殊情况</span></span><br><span class="line">            <span class="comment">// 点了 Table 的 非管理员 item，setisUpdateDisabled(false)</span></span><br><span class="line">            <span class="comment">// 对于 UserForm 来说 props.isUpdateDisabled 从未定义变成 false 进而触发副作用 isDisabled false</span></span><br><span class="line">            <span class="comment">// 然后在 UserForm 表单上 角色项 选择 管理员，Select onChange 导致 isDisabled true</span></span><br><span class="line">            <span class="comment">// 点击 Modal 取消/更新，UserForm 仍然 isDisabled true</span></span><br><span class="line">            <span class="comment">// 再点 Table 的 非管理员 item，setisUpdateDisabled(false)，props.isUpdateDisabled 仍未 false</span></span><br><span class="line">            <span class="comment">// UserForm 副作用未触发，进而保持 isDisabled true，导致预设的 非管理员item 的表单区域项也被禁用</span></span><br><span class="line">            <span class="comment">// 通过在点击取消/更新后添加 setisUpdateDisabled(!isUpdateDisabled) 来解决</span></span><br><span class="line">            <span class="keyword">if</span>(item.roleId===<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//禁用</span></span><br><span class="line">                setisUpdateDisabled(<span class="literal">true</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//取消禁用</span></span><br><span class="line">                setisUpdateDisabled(<span class="literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 由于是修改用户信息，在点击编辑的时候</span></span><br><span class="line">            <span class="comment">// 最好先将原来的用户信息显示在表单上</span></span><br><span class="line">            updateForm.current.setFieldsValue(item)</span><br><span class="line">        &#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        setcurrent(item)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        item.roleState = !item.roleState</span><br><span class="line">        setdataSource([...dataSource])</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/users/<span class="subst">$&#123;item.id&#125;</span>`</span>,&#123;</span><br><span class="line">            <span class="attr">roleState</span>:item.roleState</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;你确定要删除?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="comment">// content: &#x27;Some descriptions&#x27;,</span></span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;Cancel&#x27;);</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="keyword">const</span> deleteMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        <span class="comment">// 当前页面同步状态 + 后端同步</span></span><br><span class="line"></span><br><span class="line">        setdataSource(dataSource.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id!==item.id))</span><br><span class="line"></span><br><span class="line">        axios.delete(<span class="string">`/users/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addFormOK = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        addForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(value)</span></span><br><span class="line"></span><br><span class="line">            setisAddVisible(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">            addForm.current.resetFields()</span><br><span class="line">            <span class="comment">//post到后端，生成id，再设置 datasource, 方便后面的删除和更新</span></span><br><span class="line">            axios.post(<span class="string">`/users`</span>, &#123;</span><br><span class="line">                ...value,</span><br><span class="line">                <span class="string">&quot;roleState&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;default&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res.data)</span><br><span class="line">                setdataSource([...dataSource,&#123;</span><br><span class="line">                    ...res.data,</span><br><span class="line">                    <span class="attr">role</span>:roleList.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.id===value.roleId)[<span class="number">0</span>]</span><br><span class="line">                &#125;])</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> updateFormOK = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        updateForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(value)</span></span><br><span class="line">            setisUpdateVisible(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">            setdataSource(dataSource.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(item.id===current.id)&#123;</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        ...item,</span><br><span class="line">                        ...value,</span><br><span class="line">                        <span class="attr">role</span>:roleList.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id===value.roleId)[<span class="number">0</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">            &#125;))</span><br><span class="line">            setisUpdateDisabled(!isUpdateDisabled)</span><br><span class="line"></span><br><span class="line">            axios.patch(<span class="string">`/users/<span class="subst">$&#123;current.id&#125;</span>`</span>,value)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                setisAddVisible(true)</span></span><br><span class="line"><span class="xml">            &#125;&#125;&gt;添加用户<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">pageSize:</span> <span class="attr">5</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125;</span></span><br><span class="line"><span class="xml">            /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">visible</span>=<span class="string">&#123;isAddVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;添加用户&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">okText</span>=<span class="string">&quot;确定&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setisAddVisible(false)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">                onOk=&#123;() =&gt; addFormOK()&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">UserForm</span> <span class="attr">regionList</span>=<span class="string">&#123;regionList&#125;</span> <span class="attr">roleList</span>=<span class="string">&#123;roleList&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;addForm&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">UserForm</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">visible</span>=<span class="string">&#123;isUpdateVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;更新用户&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">okText</span>=<span class="string">&quot;更新&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setisUpdateVisible(false)</span></span><br><span class="line"><span class="xml">                    setisUpdateDisabled(!isUpdateDisabled)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">                onOk=&#123;() =&gt; updateFormOK()&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">UserForm</span> <span class="attr">regionList</span>=<span class="string">&#123;regionList&#125;</span> <span class="attr">roleList</span>=<span class="string">&#123;roleList&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;updateForm&#125;</span> <span class="attr">isUpdateDisabled</span>=<span class="string">&#123;isUpdateDisabled&#125;</span> <span class="attr">isUpdate</span>=<span class="string">&#123;true&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">UserForm</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UserForm = forwardRef(<span class="function">(<span class="params">props,ref</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于判断 “区域” 输入框是否禁用，对应管理员身份</span></span><br><span class="line">    <span class="keyword">const</span> [isDisabled, setisDisabled] = useState(<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 为什么要用副作用来更新状态？props.isUpdateDisabled 改变时</span></span><br><span class="line">    <span class="comment">// UserForm 不是会自动更新吗？</span></span><br><span class="line">    <span class="comment">// 因为我们之前已经为 UserForm 设计了 isDisabled状态</span></span><br><span class="line">    <span class="comment">// 所以我们现在要做的是勾连父子组件状态，而不能简单用子组件的props</span></span><br><span class="line">    <span class="comment">// 要注意，一定是 props.isUpdateDisabled 前后两次改变了才会触发副作用</span></span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setisDisabled(props.isUpdateDisabled)</span><br><span class="line">    &#125;,[props.isUpdateDisabled])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line">    <span class="comment">// 前端不会添加修改后端 roles Id、name 等属性，所以这个映射关系可以写死</span></span><br><span class="line">    <span class="comment">// 但后端可能会修改，修改时需要告知我们，然后我们做调整</span></span><br><span class="line">    <span class="keyword">const</span> &#123;roleId,region&#125;  = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line">    <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">        <span class="string">&quot;1&quot;</span>:<span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;2&quot;</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;3&quot;</span>:<span class="string">&quot;editor&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> checkRegionDisabled = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(props.isUpdate)&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> item.value!==region</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查当前用户角色权限，开放相应的区域选项</span></span><br><span class="line">    <span class="keyword">const</span> checkRoleDisabled = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(props.isUpdate)&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> roleObj[item.id]!==<span class="string">&quot;editor&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Form</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">layout</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        &gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;密码&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;region&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;区域&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;isDisabled?[]:[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Select</span> <span class="attr">disabled</span>=<span class="string">&#123;isDisabled&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        props.regionList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.value&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;checkRegionDisabled(item)&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;roleId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;角色&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Select</span> <span class="attr">onChange</span>=<span class="string">&#123;(value)</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="xml">                    // console.log(value)</span></span><br><span class="line"><span class="xml">                    // 添加后端后，1要改成后台的Id</span></span><br><span class="line"><span class="xml">                    // 绑定在表单角色项 onChange 事件上，也就意味着</span></span><br><span class="line"><span class="xml">                    // 得选了角色才会去检查是否应该禁用区域项</span></span><br><span class="line"><span class="xml">                    if(value === 1)&#123;</span></span><br><span class="line"><span class="xml">                        setisDisabled(true)</span></span><br><span class="line"><span class="xml">                        ref.current.setFieldsValue(&#123;</span></span><br><span class="line"><span class="xml">                            region:&quot;&quot;</span></span><br><span class="line"><span class="xml">                        &#125;)</span></span><br><span class="line"><span class="xml">                    &#125;else&#123;</span></span><br><span class="line"><span class="xml">                        setisDisabled(false)</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                &#125;&#125;&gt;</span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        props.roleList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;checkRoleDisabled(item)&#125;</span>&gt;</span>&#123;item.roleName&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserForm</span><br></pre></td></tr></table></figure>

<h4 id="登录界面-lt-Login-gt"><a href="#登录界面-lt-Login-gt" class="headerlink" title="登录界面 &lt;/Login/&gt;"></a>登录界面 &lt;/Login/&gt;</h4><p>实现的比较简陋。结果就是在登陆成功后，存下一个本地 token——包含了当前登录用户的信息，然后将网页重定向至<code>/</code>。这个 token 在<code>SideMenu</code> <code>UserList</code> <code>UserForm</code> 中被取出来，用于在前端业务逻辑中实现权限控制。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Login</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> onFinish = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(values)</span><br><span class="line"></span><br><span class="line">        axios.get(<span class="string">`/users?username=<span class="subst">$&#123;values.username&#125;</span>&amp;password=<span class="subst">$&#123;values.password&#125;</span>&amp;roleState=true&amp;_expand=role`</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.data)</span><br><span class="line">            <span class="keyword">if</span>(res.data.length===<span class="number">0</span>)&#123;</span><br><span class="line">                message.error(<span class="string">&quot;用户名或密码不匹配&quot;</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;token&quot;</span>,<span class="built_in">JSON</span>.stringify(res.data[<span class="number">0</span>]))</span><br><span class="line">                props.history.push(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新闻业务"><a href="#新闻业务" class="headerlink" title="新闻业务"></a>新闻业务</h3><p>新闻业务的业务逻辑：</p>
<ul>
<li>后端列表<code>news</code> 业务字段</li>
</ul>
<div align="center">
  <img src="https://s2.loli.net/2022/02/16/nx5jC3M6ZRqPhLI.png" width=40%>
</div>

<ul>
<li>审核流程</li>
</ul>
<div align="center">
  <img src="https://s2.loli.net/2022/02/16/6yjGT4FLPNRhHpu.png" width=40%>
</div>

<ul>
<li>发布流程</li>
</ul>
<div align="center">
  <img src=https://s2.loli.net/2022/02/16/afYM5FwJquB6Q3s.png width=40%>
</div>

<h4 id="撰写新闻-lt-NewsAdd-gt"><a href="#撰写新闻-lt-NewsAdd-gt" class="headerlink" title="撰写新闻 &lt;/NewsAdd/&gt;"></a>撰写新闻 &lt;/NewsAdd/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/17/srl8SGRbipWNyPv.png" width=60%>
</div>

<p>思路：</p>
<ul>
<li><p>使用 Ant Design 组件：PageHeader, Steps, Button, Form，Editor等</p>
</li>
<li><p>设置一个 <code>current</code> 状态，有 0/1/2 三个状态，分别对应三个 step。根据不同状态设置该页面的不同内容。值得注意的是，不同内容的切换是通过设置组件的可见性实现，而不是直接控制组件是否存在，这样可以在切换组件后仍能保留组件中输入的内容。</p>
</li>
<li><p>编辑器 <code>Editor</code> 中的的内容需要再恰当的时机（失去焦点）发送给父组件<code>NewsAdd</code>并存放在某个状态中，并且需要做一定内容格式的转换。然后在新闻提交step下，点击提交草稿或发送审核，将带有文章内容和状态的字段发送给后端存储。</p>
</li>
</ul>
<p><strong>新闻管理、审核管理、发布管理</strong>，这三个模块的大体逻辑都类似。</p>
<p>关键就在于清楚各个模块的功能需求是什么。技术上主要关注获取/校验/编辑<code>news</code>的审核和发布状态码；再者便是在前端获取用户登录信息，以此来决定用户在这三个模块的页面的<code>Table</code>中能看到哪些文章（选择性渲染，隐藏文章路由——Table中文章的标题，是可点的连接），以及是否能够预览<code>\preview</code>和更新<code>\update</code>文章（即此前提到的NewsRouter组件，使权限不够的用户在地址栏输入路由无效）。主要就是看是否是自己的文章，以及用户是否有权限审核、下线文章。</p>
<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><p>是</p>
<h2 id="添加后端并部署上线"><a href="#添加后端并部署上线" class="headerlink" title="添加后端并部署上线"></a>添加后端并部署上线</h2><h3 id="字节跳动轻服务简介"><a href="#字节跳动轻服务简介" class="headerlink" title="字节跳动轻服务简介"></a>字节跳动轻服务简介</h3><h4 id="云工程"><a href="#云工程" class="headerlink" title="云工程"></a>云工程</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://qingfuwu.cn/docs/nodejs/cloud-project/quickstart.html">轻服务 云工程入门</a></p>
<blockquote>
<p>云工程是轻服务面向大型工程项目的解决方案，开发者在本地开发、可选择任意的 Node.js 框架、通过 Git 协作及轻松部署服务，并且仍然有开箱即用的开发体验。</p>
<p>通过轻服务提供的云工程，你可以极其方便地在本地开发完整的 Web 项目，使用轻服务开箱即用的各种功能，并通过简单易用的命令行或 Git 部署到云端。</p>
</blockquote>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://qingfuwu.cn/docs/nodejs/database/quickstart.html">轻服务 数据库入门</a></p>
<p>轻服务提供了一套简单易用的数据库功能，在云函数/云工程中，只需通过 inspirecloud.db 即可进行操作</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/30/%E5%89%8D%E7%AB%AF-React%E7%AC%94%E8%AE%B0/" rel="prev" title="前端-React笔记">
                  <i class="fa fa-chevron-left"></i> 前端-React笔记
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wu Chaojie</span>
</div>
  <div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客量:<span id="busuanzi_value_site_pv"></span>
  </span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
