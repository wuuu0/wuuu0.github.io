<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Wu&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Wu&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Wu Chaojie">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Wu's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Wu's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CS Tech</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wu Chaojie"
      src="/images/miao.gif">
  <p class="site-author-name" itemprop="name">Wu Chaojie</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wuuu0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wuuu0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/03/React%E6%A1%86%E6%9E%B6%E8%AE%AD%E7%BB%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/03/React%E6%A1%86%E6%9E%B6%E8%AE%AD%E7%BB%83/" class="post-title-link" itemprop="url">React 系列训练</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-03 17:47:41" itemprop="dateCreated datePublished" datetime="2022-03-03T17:47:41+08:00">2022-03-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-12 14:28:30" itemprop="dateModified" datetime="2022-03-12T14:28:30+08:00">2022-03-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>React 框架 的知识掌握不牢固、实战经验少，故想要通过一些训练来熟练掌握，包括 React-router、React-redux、Axios。训练素材主要来自官方文档、博客</p>
<h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2><p><a target="_blank" rel="noopener" href="https://www.axios-http.cn/docs/intro">Axios 中文文档</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6884561821127491597">一篇Axios入门教程</a>（主要看这个）</p>
<p>训练案例：<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6LyagkoRWYA">Axios Crash Course | HTTP Library</a></p>
<p>PS：案例里用的 <a target="_blank" rel="noopener" href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>，似乎在服务端配置了跨域</p>
<p>比如，我们在任意网站按<code>F12</code>调试，输入以下代码，都可以请求成功</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://jsonplaceholder.typicode.com/todos/1&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">  .then(<span class="function"><span class="params">json</span> =&gt;</span> <span class="built_in">console</span>.log(json))</span><br></pre></td></tr></table></figure>

<h2 id="React-Router"><a href="#React-Router" class="headerlink" title="React Router"></a>React Router</h2><h3 id="基本概念和用法"><a href="#基本概念和用法" class="headerlink" title="基本概念和用法"></a>基本概念和用法</h3><p><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/index.html">React Router 中文文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6583b7258e78">React Router教程</a>（主要看这个）</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7025418839454122015">什么，React Router已经到V6了 ？？</a>（有空看看）</p>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8bc325107994">React-Router 嵌套路由</a></p>
<p><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/advanced/ComponentLifecycle.html">React 路由 组件生命周期</a><br>基本符合之前的设想：每次切换路由就会导致 被切换的组件卸载，切换到的组件挂载</p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p><a target="_blank" rel="noopener" href="http://cn.redux.js.org/tutorials/index">Redux 官方文档</a></p>
<h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><p>在教程的第一节，会包含使用 Redux 需要了解的关键术语和概念</p>
<h4 id="Redux-是什么？"><a href="#Redux-是什么？" class="headerlink" title="Redux 是什么？"></a>Redux 是什么？</h4><ul>
<li>Redux 是一个使用叫做“action”的事件来管理和更新应用状态的模式和工具库 它以集中式Store（centralized store）的方式对整个应用中使用的状态进行集中管理，其规则确保状态只能以可预测的方式更新。</li>
</ul>
<p><strong>为什么要使用？</strong></p>
<ul>
<li><p>Redux 帮你管理“全局”状态 - 哪些应用程序的许多部分都需要的状态。</p>
</li>
<li><p>Redux 提供的模式和工具使您更容易理解应用程序中的状态何时、何地、为什么以及如何更新，以及当这些更改发生时您的应用程序逻辑将如何表现。 Redux 指导您编写可预测和可测试的代码，这有助于让您确信您的应用程序将按预期工作。</p>
</li>
</ul>
<p><strong>什么时候应该使用？</strong></p>
<ul>
<li>在应用的大量地方，都存在大量的状态</li>
<li>应用状态会随着时间的推移而频繁更新</li>
<li>更新该状态的逻辑可能很复杂</li>
<li>中型和大型代码量的应用，很多人协同开发</li>
</ul>
<h4 id="Redux-术语和概念"><a href="#Redux-术语和概念" class="headerlink" title="Redux 术语和概念"></a>Redux 术语和概念</h4><p>在我们深入研究一些实际代码之前，让我们先谈谈使用 Redux 需要了解的一些术语和概念</p>
<p>了解 Redux 在没有 Redux Toolkit 的情况下如何使用</p>
<p><strong>概念</strong></p>
<ul>
<li><p>单向数据流</p>
</li>
<li><p>不可变性 Immutability</p>
</li>
</ul>
<p><strong>术语</strong></p>
<ul>
<li>Action、Action Creator</li>
<li>Reducer</li>
<li>Store</li>
<li>Dispatch</li>
<li>Selector</li>
</ul>
<div align="center">
<img src="https://s2.loli.net/2021/12/15/I7lrOfyVb32W4UB.gif" width="70%">
</div>

<h3 id="应用结构"><a href="#应用结构" class="headerlink" title="应用结构"></a>应用结构</h3><p>下面使用 Redux-toolkit 来介绍 Redux 的基本使用</p>
<p>补充资料：<a target="_blank" rel="noopener" href="https://redux-toolkit-cn.netlify.app/tutorials/basic-tutorial/">基础教程: 介绍 Redux 工具包</a></p>
<blockquote>
<p>要意识到，上面的动画表达的是 Redux 最基本的特性。Redux 库为我们提供了基本的 API 来使用这些基本特性，Redux-toolkit 的话则提供了更方便的 API 来使用这些特性</p>
</blockquote>
<p><strong>创建 Store</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&#x27;../features/counter/counterSlice&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> configureStore(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: counterReducer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Redux store 是使用 Redux Toolkit 中的<code>configureStore</code>函数创建的。<code>configureStore</code>要求我们传入一个<code>reducer</code>参数。</p>
<p>当我们传入一个像<code>&#123;counter: counterReducer&#125;</code>这样的对象时，它表示我们希望在 Redux 状态对象中有一个<code>state.counter</code>部分，并且我们希望<code>counterReducer</code>函数负责决定是否以及如何在 dispatch action 时更新<code>state.counter</code>部分。</p>
<p>Redux 切片 (Slice)</p>
<p>“切片”是应用中单个功能的 Redux reducer 逻辑和 action 的集合, 通常一起定义在一个文件中。该名称来自于将根 Redux 状态对象拆分为多个状态“切片。看下面的例子</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> usersReducer <span class="keyword">from</span> <span class="string">&#x27;../features/users/usersSlice&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postsReducer <span class="keyword">from</span> <span class="string">&#x27;../features/posts/postsSlice&#x27;</span></span><br><span class="line"><span class="keyword">import</span> commentsReducer <span class="keyword">from</span> <span class="string">&#x27;../features/comments/commentsSlice&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> configureStore(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">users</span>: usersReducer,</span><br><span class="line">    <span class="attr">posts</span>: postsReducer,</span><br><span class="line">    <span class="attr">comments</span>: commentsReducer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>例子中，<code>state.users</code>，<code>state.posts</code>，和<code>state.comments</code>均是 Redux state 的一个切片“slice”。由于<code>usersReducer</code>负责更新<code>state.users</code>切片，我们将其称为“slice reducer”函数。</p>
<p><strong>创建 Slice Reducer 和 Action</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSlice = createSlice(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">increment</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      state.value += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      state.value -= <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.value += action.payload</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.actions</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.reducer</span><br></pre></td></tr></table></figure>

<p>Redux Toolkit 有一个名为<code>createSlice</code>的函数，<strong>它负责</strong>生成 action 类型字符串、action creator 函数和 action 对象的工作。<strong>您所要做的</strong>就是为这个切片定义一个名称，编写一个包含 reducer 函数的对象，它会自动生成相应的 action 代码。</p>
<p>更多规则：Reducer 的规则、Reducer 与 不可变更新/ Immer 库、用 Thunk 编写异步逻辑</p>
<p>关于 Thunk：大致流程是：组件/view dispatch 一个函数（可包含同步+异步行为），中间件接收并运行函数并生成 action 并将其 dispatch 到 Store</p>
<p><strong>React Counter 组件</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> count = useSelector(selectCount)</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">  <span class="keyword">const</span> [incrementAmount, setIncrementAmount] = useState(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.row&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">className</span>=<span class="string">&#123;styles.button&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">aria-label</span>=<span class="string">&quot;Increment value&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(increment())&#125;</span></span><br><span class="line"><span class="xml">        &gt;</span></span><br><span class="line"><span class="xml">          +</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;styles.value&#125;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">className</span>=<span class="string">&#123;styles.button&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">aria-label</span>=<span class="string">&quot;Decrement value&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(decrement())&#125;</span></span><br><span class="line"><span class="xml">        &gt;</span></span><br><span class="line"><span class="xml">          -</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/* 这里省略了额外的 render 代码 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在我们的组件中，看起来我们并没有将当前计数器的值存储为 state。而是放到<code>count</code>变量中，但它不是来自<code>useState</code>hooks。<a target="_blank" rel="noopener" href="https://react-redux.js.org/api/hooks">React-Redux 库</a> 有一组自定义 hooks，允许你的 React 组件与 Redux store 交互。（我们的组件不能直接与 Redux store 对话，因为组件文件中不能引入 store）</p>
<ul>
<li>使用<code>useSelector</code>提取数据</li>
<li>使用<code>useDispatch</code>来 dispatch action</li>
</ul>
<p><strong>Redux State 和 组件 State</strong></p>
<p>整个应用程序所需的全局状态应该放在 Redux store 中。而只在一个地方用到的状态应该放到组件的 state。</p>
<p>一些常用的经验法则，用于确定应该将哪种数据放入 Redux：</p>
<ul>
<li>应用程序的其他部分是否关心这些数据？</li>
<li>您是否需要能够基于这些原始数据创建进一步的派生数据？</li>
<li>是否使用相同的数据来驱动多个组件？</li>
<li>能够将这种状态恢复到给定的时间点（即时间旅行调试）对您是否有价值？</li>
<li>是否要缓存数据（即，如果数据已经存在，则使用它的状态而不是重新请求它）？</li>
<li>您是否希望在热重载 UI 组件（交换时可能会丢失其内部状态）时保持此数据一致？</li>
</ul>
<p><strong>Providing the Store</strong></p>
<p>我们已经看到我们的组件可以使用 useSelector 和 useDispatch 这两个 hooks 与 Redux 的 store 通信。奇怪的是，我们并没有导入 store，那么这些 hooks 怎么知道要与哪个 Redux store 对话呢？</p>
<p>使用一个名为 <Provider> 的组件在幕后传递 Redux store，以便我们的组件可以访问它</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<div align="center">
<img src="https://s2.loli.net/2022/03/09/mGPEDL68I2Y3gF5.jpg" width="100%">
</div>

<h3 id="React-redux"><a href="#React-redux" class="headerlink" title="React-redux"></a>React-redux</h3><p><a target="_blank" rel="noopener" href="https://react-redux.js.org/">React-redux 官方文档</a></p>
<p>Why Use React Redux? Redux 和 React-redux 的关系？</p>
<blockquote>
<p>Redux itself is a standalone library that can be used with any UI layer or framework, including React, Angular, Vue, Ember, and vanilla JS. Although Redux and React are commonly used together, they are independent of each other.</p>
</blockquote>
<blockquote>
<p>React Redux is the official Redux UI binding library for React.</p>
</blockquote>
<p>进一步说，Redux 主要是实现了 dispatch、action、store/state/reducer（参见之前的动画），其本身只提供了一种数据流的概念+数据更新的机制（<a target="_blank" rel="noopener" href="http://cn.redux.js.org/introduction/core-concepts">更本质的 Redux</a>）。真实的 Redux 全流程类似下面的描述：</p>
<p>组件触发事件，调用了 Redux dispatch —&gt; Redux 运作 —&gt; 返回数据（Redux state）给组件，组件更新渲染</p>
<p>可见 Redux 没有直接负责一下事情：组件触发事件时，如何实现调用 Redux dispatch；Redux 处理完 action 后返回的 Redux state，如何传给我们的组件并让它更新渲染？ 这些事情，就是由 UI binding library 来实现。React-redux 就是 React 框架对应的 UI binding library</p>
<p><strong>Connecting API</strong></p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://react-redux.js.org/tutorials/connect">Tutorial: Using the API connect</a></p>
<p>在之前计数器的案例中，我们用<code>useSelector</code>和<code>useDispatch</code>实现了 React 组件和 Redux 的连接，这也是现在官方推荐的方式</p>
<div align="center">
<img src="https://segmentfault.com/img/remote/1460000011473976/view?w=1149&h=554" width="100%">
</div>

<p>此前的做法是使用 connection API，大致用法如下：</p>
<ul>
<li>Providing th Store</li>
</ul>
<p>首先我们需要让我们的组件能够获取到<code>store</code>。我们可以在应用组件的最外层套上一个由 React Redux 提供的 <Provider /> API</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">TodoApp</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  rootElement</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>Connecting the Component</li>
</ul>
<p>React Redux 为我们提供了一个<code>connect</code> function，让我们能够从<code>store</code>中读取数据（包括 state 和 dispatch）（并且能够在<code>store</code>中数据更新时，自动重新读取）</p>
<p>The connect function takes two arguments, both optional:</p>
<ul>
<li><p><code>mapStateToProps</code>: called every time the store state changes. It receives the entire store state, and should return an object of data this component needs.</p>
</li>
<li><p><code>mapDispatchToProps</code>: this parameter can either be a function, or an object.</p>
<ul>
<li>If it’s a function, it will be called once on component creation. It will receive dispatch as an argument, and should return an object full of functions that use dispatch to dispatch actions.</li>
<li>If it’s an object full of action creators, each action creator will be turned into a prop function that automatically dispatches its action when called. Note: We recommend using this “object shorthand” form.</li>
</ul>
</li>
</ul>
<p>下面看具体的使用方法。</p>
<p>① 首先，对于需要更改 store state 的组件，它要能够将 action dispatch 到 store。简化流程：</p>
<ul>
<li>从 Redux 工程文件中（概念上 Action 属于 Redux 范畴，我们实现时也一般将 Action 放在 Redux 文件夹实现）导入 action creator</li>
<li>作为<code>connect</code>的第二个参数。导出组件时调用<code>connect</code>包装组件</li>
<li>action creator 作为 props 传入组件中，组件调用 action creator 就会创建对应的 action，并自动调用 redux dispatch 将其发送到 store</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/AddTodo.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; addTodo &#125; <span class="keyword">from</span> <span class="string">&#x27;../redux/actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddTodo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  handleAddTodo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// dispatches actions to add todo</span></span><br><span class="line">    <span class="built_in">this</span>.props.addTodo(<span class="built_in">this</span>.state.input)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sets state back to empty string</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; <span class="attr">input</span>: <span class="string">&#x27;&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> this.updateInput(e.target.value)&#125;</span></span><br><span class="line"><span class="xml">          value=&#123;this.state.input&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;add-todo&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleAddTodo&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          Add Todo</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="literal">null</span>, &#123; addTodo &#125;)(AddTodo)</span><br></pre></td></tr></table></figure>

<p>store 接收到 action，redux 进行处理并更改 state。</p>
<p>② 然后，对于依赖 store state 的组件，它们需要同 redux 连接起来，获取 store 的 state，并保持它变化，组件获取的值也变化同时更新渲染。简化流程：</p>
<ul>
<li>在组件端实现一个<code>mapStateToProps</code>函数，它描述了组件想要从 store 中获取 state 的哪一部分数据（可以用 selector 方法简化）。</li>
<li><code>mapStateToProps</code>函数作为<code>connect</code>第一个参数。导出组件时调用<code>connect</code>包装组件</li>
<li><code>mapStateToProps</code>函数的返回值是一个对象，对象中的 key 值会作为同名 props 传入组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/TodoList.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...other imports</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getTodos &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/selectors&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoList = <span class="comment">// ... UI component implementation</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123; <span class="attr">todos</span>: getTodos(state) &#125;))(TodoList);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/03/React%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/03/React%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">React 组件设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-03 17:33:22" itemprop="dateCreated datePublished" datetime="2022-03-03T17:33:22+08:00">2022-03-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-11 21:16:32" itemprop="dateModified" datetime="2022-03-11T21:16:32+08:00">2022-03-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="React-哲学（官方文档）"><a href="#React-哲学（官方文档）" class="headerlink" title="React 哲学（官方文档）"></a>React 哲学（官方文档）</h2><p><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/thinking-in-react.html">官方文档</a></p>
<p>尝试自己用 Hooks 写出来。复现的代码见：<a target="_blank" rel="noopener" href="https://codesandbox.io/">CodeSandBox - React Philosophy</a></p>
<p><strong>第一步：将设计好的 UI 划分为组件层级</strong></p>
<p>根据单一功能原则划分组件</p>
<p>列出组件层级</p>
<ul>
<li>FilterableProductTable</li>
<li>SearchBar</li>
<li>ProductTable<ul>
<li>ProductCategoryRow</li>
<li>ProductRow</li>
</ul>
</li>
</ul>
<p><strong>第二步：用 React 创建一个静态版本</strong></p>
<p>先假设我们已经从后台获取了数据（要清楚后台的数据格式）</p>
<p>先根据该已有的后台数据，渲染出来一个没有交互功能的，应用的静态版本</p>
<ul>
<li>小型应用：自上而下</li>
<li>大型应用：自下而上。每实现一个小组件测试一个小组件。</li>
</ul>
<p>这一步要清楚自顶向下的数据流（<strong>单向数据流，单向绑定</strong>）情况如何。后端数据整个输入给谁的<code>props</code>？父组件的什么数据要继续下传？子组件<code>props</code>接受自谁，包含了什么属性？</p>
<p>如何根据后台数据渲染组件？和后台数据的结构有关。此例子中，就是简单的遍历后台数据（数组），然后根据某些控制字段判断条件对应创建元素即可</p>
<p>包含关系：<br>① 在我们的例子中，<code>ProductTable</code>和<code>Row</code>是包含关系，我们是将渲染<code>Row</code>的必要数据通过<code>props</code>传给<code>ProductTable</code>后，再由<code>ProductTable</code>自己<code>render</code>出<code>Row</code>来。<br>② <a target="_blank" rel="noopener" href="https://react.docschina.org/docs/composition-vs-inheritance.html">官方文档-组合&amp;继承</a> 中的<code>children</code>模式则是直接将子组件传递给父组件。<br>这两者方法都可以应对官方文档里说的“有些组件无法提前知晓它们子组件的具体内容”情况。第二种官方文档里的<code>children</code>模式一般什么时候使用呢？</p>
<p><strong>第三步：确定 UI state 的最小（且完整）表示</strong></p>
<p>通过问自己以下三个问题，你可以逐个检查相应数据是否属于 state：</p>
<ul>
<li>该数据是否是由父组件通过 props 传递而来的？如果是，那它应该不是 state。</li>
<li>该数据是否随时间的推移而保持不变？如果是，那它应该也不是 state。（一般来说，交互处就需要 state）</li>
<li>你能否根据其他 state 或 props 计算出该数据的值？如果是，那它也不是 state。</li>
</ul>
<p>注意，要以设计的组件当前层级的视角去思考上面的准则。比如获取后端数据肯定是会变的，但是它是在我们设计的<code>FilterableProdcutTable</code>之外获取的数据，对于这个组件来说，就把它当<code>props</code>就好</p>
<p>状态的抽取还是挺看经验的</p>
<p><strong>第四步：确定 state 放置的位置</strong></p>
<p>对于应用中的每一个 state：</p>
<ul>
<li>找到根据这个 state 进行渲染的所有组件。</li>
<li>找到他们的共同所有者（common owner）组件（在组件层级上高于所有需要该 state 的组件）。</li>
<li>该共同所有者组件或者比它层级更高的组件应该拥有该 state。</li>
<li>如果你找不到一个合适的位置来存放该 state，就可以直接创建一个新的组件来存放该 state，并将这一新组件置于高于共同所有者组件层级的位置。</li>
</ul>
<p>针对状态，稍微细分一下组件，其实有 <strong>状态设置者</strong>（一般就是状态提升前的状态所有者，此处是<code>SerchBar</code>） 和 <strong>状态响应者</strong>（此处是<code>ProductTable</code>） 之分。在这个例子中，状态提升后，两者需要从父组件获取状态——设置者需要即使更新显示当前的设置状态，响应者自然就是需要响应状态。</p>
<p><strong>第五步：添加反向数据流</strong></p>
<p>在创建状态的组件上，定义“伪”事件处理函数，然后将它们通过<code>props</code>传递给对应的子组件</p>
<p>子组件拿到父组件的“伪”事件处理函数，自己定义真的事件处理函数，挂载到元素上去，实现反向数据流：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UI交互/事件 ---&gt; （异步）调用真事件处理函数 ---&gt; 调用“伪”事件处理函数，设置状态</span><br></pre></td></tr></table></figure>

<p>值得讨论的是，此处“伪”事件处理函数指负责<code>setState</code>，留出一个接口给子组件传值进来设置状态。复杂情况下，事件处理的逻辑可能需要分层实现，即在每个层次的组件就实现其对应的事件处理逻辑</p>
<hr>
<h2 id="React-组件设计案例"><a href="#React-组件设计案例" class="headerlink" title="React 组件设计案例"></a>React 组件设计案例</h2><h3 id="类-MaterialUI-按钮"><a href="#类-MaterialUI-按钮" class="headerlink" title="类 MaterialUI 按钮"></a>类 MaterialUI 按钮</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904066435252238">精通React/Vue系列</a> 作者自己封装的几个组件，可以拿来练手</p>
</blockquote>
<p>参考资料：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904054917693453">纯 CSS 打造 materialUI 按钮 封装成react组件</a></p>
<h4 id="CSS3-实现点击动效"><a href="#CSS3-实现点击动效" class="headerlink" title="CSS3 实现点击动效"></a>CSS3 实现点击动效</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transition">CSS transition MDN</a></p>
<p>总结来说，就是对同一个元素的不同状态（通过伪类，比如<code>:hover</code>）（也可以是父元素的不同状态下的同一子组件），设置不同的样式。如果设置了<code>transition</code>属性（一般设置在正常的样式中，而不是伪类样式中），则在状态变化时，两个样式的切换会有动画。</p>
<h4 id="组件设计思路"><a href="#组件设计思路" class="headerlink" title="组件设计思路"></a>组件设计思路</h4><p>组件的设计思路我这里参考ant-design的模式, 基于开闭原则,我们知道一个可扩展的按钮组件一般都具备如下特点:</p>
<ul>
<li>允许用户修改按钮样式</li>
<li>对外暴露按钮事件方法</li>
<li>提供按钮主题和外形配置</li>
<li>可插拔,可组合</li>
</ul>
<p><strong>抽象来说</strong>：确定需求（功能/效果如何）+提供接口（开发者如何使用）</p>
<p>基于以上几点,我们来设计这个react组件</p>
<h4 id="React-封装"><a href="#React-封装" class="headerlink" title="React 封装"></a>React 封装</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/classnames">classnames 模块</a>，简单来说就是把多个字符串，以空格为间隔拼接成一个字符串</p>
<p>要深刻认识到 Webpack 中一切皆模块。当我们在封装<code>Button</code>时，<code>import</code>了它的样式，之后<code>export</code>这个<code>Button</code>后，它就自带了样式，不必再<code>import</code>它的样式。在<code>Antd</code>中，有时候我们引用了组件还不够，还要再引入样式的情况，应该是需要一些公用/补充样式？</p>
<p>所谓给用户暴露设置项，就是用户通过<code>Button</code>的<code>props</code>输入配置，<code>Button</code>拿到配置后进行相应的处理。比如用户自定义样式，用户输入的<code>type</code>下放到<code>Button</code>中就是一个类名，我们给<code>div</code>添加这个类，并且在<code>Button</code>的<code>css/less</code>文件中设置相关的样式即可；用户自定义处理函数，<code>Button</code>收到后设置给<code>div</code>的对应的事件处理函数即可</p>
<h3 id="可定制的进度条"><a href="#可定制的进度条" class="headerlink" title="可定制的进度条"></a>可定制的进度条</h3><p>参考资料：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904055702028296">快速实现一个可定制的进度条组件</a></p>
<p>自己的实现：<a target="_blank" rel="noopener" href="https://codesandbox.io/s/progress-component-bvd884?file=/src/Progress/index.jsx">CodeSandBox - Progress</a></p>
<p><strong>组件设计三原则</strong></p>
<ul>
<li>高内聚, 低耦合（尤其是vue/react组件中, 降低组件之间的耦合尤为重要）</li>
<li>组件边界划分清晰（每一个组件都有自己清晰的边界划分）</li>
<li>单一职责（每一个组件只负责某一特定的表现或者功能）</li>
</ul>
<h4 id="组件设计思路-1"><a href="#组件设计思路-1" class="headerlink" title="组件设计思路"></a>组件设计思路</h4><p>由于组件设计的前提还是基于需求, 所以我们第一步是要确认需求. 一个进度条组件一般都会有如下需求点:</p>
<ul>
<li>通过进度控制进度条长度</li>
<li>进度条总长度可以由用户来控制</li>
<li>随时修改精度条的颜色（来自于设计师或产品经理独特而百变的审美）</li>
<li>当进度为100%时进度条可以自动消失（可能的需求）</li>
<li>进度提示文本（用户想知道当前长度下的具体进度, 比如体温计）</li>
<li>对于不同的进度节点,需要有不同的进度条颜色（比如游戏人物里的血, 快没血的时候为红色, 血满的时候为蓝色）</li>
</ul>
<p>需求收集好之后，得出如下线框图：</p>
<div align="center">
    <img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/2/17005d7e20a61b52~tplv-t2oaga2asx-watermark.awebp" width=80%>
</div>

<p>也即大概确定需求和接口后，我们要进一步思考如何实现。上面的思维导图我们也知道了，进度条组件的实现原理就是通过对外暴露一定的属性，使用css先画一个进度条，最后通过属性和样式之间的调度来实现我们需求满满的进度条。至于如何画进度条,下面会详细介绍</p>
<h4 id="实现进度条的静态样式"><a href="#实现进度条的静态样式" class="headerlink" title="实现进度条的静态样式"></a>实现进度条的静态样式</h4><ul>
<li>思考 HTML 组织结构 和 CSS 布局和样式（非暴露接口的），实现之</li>
<li>用<code>JS</code>控制组件样式。<ul>
<li>在组件中取出<code>props</code>，实现必要的需求逻辑。</li>
<li>在组件的<code>jsx元素</code>中，传入<code>JS</code>控制的样式。注意，这里直接设置<code>div</code>的内联样式<code>style</code>，而不是通过<code>JS</code>去修改静态样式文件或者添加CSS类来控制样式，那样没必要</li>
</ul>
</li>
</ul>
<p>在实现过程中，感悟如下</p>
<ul>
<li>要清楚我们的需求是什么，想清楚了需求，有大概的实现思路，就成功了一大半</li>
<li>需求实现步骤：我们先写好了静态样式，然后再通过暴露的接口<code>props</code>+<code>js</code>设置元素的样式。不够熟练的时候，也可以将动态的样式先定死，写进静态样式中；后面再将它们抽离出来<ul>
<li>HTML和CSS还是要熟练。我们先写静态，然后基于静态写动态，这个过程中，静态的 HTML CSS 是基础</li>
<li>写动态，也就是<code>js</code>的时候，就是看我们的程序逻辑、对数据的操作处理了（也即正常的编程基础）</li>
</ul>
</li>
</ul>
<h3 id="轮播图-Swiper"><a href="#轮播图-Swiper" class="headerlink" title="轮播图 Swiper"></a>轮播图 Swiper</h3><h4 id="基础版"><a href="#基础版" class="headerlink" title="基础版"></a>基础版</h4><ul>
<li>《DOM 编程艺术》中的简陋轮播图</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">moveElement</span>(<span class="params">elementID,final_x,final_y,interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">document</span>.getElementById) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">document</span>.getElementById(elementID)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> elem = <span class="built_in">document</span>.getElementById(elementID);</span><br><span class="line">  <span class="keyword">if</span> (elem.movement) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(elem.movement);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!elem.style.left) &#123;</span><br><span class="line">    elem.style.left = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!elem.style.top) &#123;</span><br><span class="line">    elem.style.top = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> xpos = <span class="built_in">parseInt</span>(elem.style.left);</span><br><span class="line">  <span class="keyword">var</span> ypos = <span class="built_in">parseInt</span>(elem.style.top);</span><br><span class="line">  <span class="keyword">if</span> (xpos == final_x &amp;&amp; ypos == final_y) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (xpos &lt; final_x) &#123;</span><br><span class="line">    <span class="keyword">var</span> dist = <span class="built_in">Math</span>.ceil((final_x - xpos)/<span class="number">10</span>);</span><br><span class="line">    xpos = xpos + dist;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (xpos &gt; final_x) &#123;</span><br><span class="line">    <span class="keyword">var</span> dist = <span class="built_in">Math</span>.ceil((xpos - final_x)/<span class="number">10</span>);</span><br><span class="line">    xpos = xpos - dist;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ypos &lt; final_y) &#123;</span><br><span class="line">    <span class="keyword">var</span> dist = <span class="built_in">Math</span>.ceil((final_y - ypos)/<span class="number">10</span>);</span><br><span class="line">    ypos = ypos + dist;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ypos &gt; final_y) &#123;</span><br><span class="line">    <span class="keyword">var</span> dist = <span class="built_in">Math</span>.ceil((ypos - final_y)/<span class="number">10</span>);</span><br><span class="line">    ypos = ypos - dist;</span><br><span class="line">  &#125;</span><br><span class="line">  elem.style.left = xpos + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">  elem.style.top = ypos + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> repeat = <span class="string">&quot;moveElement(&#x27;&quot;</span>+elementID+<span class="string">&quot;&#x27;,&quot;</span>+final_x+<span class="string">&quot;,&quot;</span>+final_y+<span class="string">&quot;,&quot;</span>+interval+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">  elem.movement = <span class="built_in">setTimeout</span>(repeat,interval);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/07f36235eb2e">React 实现简易轮播图</a></li>
</ul>
<p>自己的实现：<a target="_blank" rel="noopener" href="https://codesandbox.io/">CodeSandBox Swiper</a></p>
<p>基本思路：把图片横向排列成组(image row),放置在相框(frame)中，隐藏超出相框的部分。利用图片组左侧和相框左侧的距离(margin-left)改变当前展示在相框中的内容，点击左右按钮可以改变这个距离</p>
<p>需求：实现一个展示区，用于展示一系列图片；有“往前”“往后”两个按钮，点击后能切换图片<br>接口：组件 props 接收一个包含图片路径的数组的参数 srcSet；接收参数 width、height 设置展示区和图片的宽高</p>
<ul>
<li>先实现一个静态版本：Swiper 组件的 jsx 元素结构写好；css 样式+布局写好</li>
<li>提取出状态：当前放送图片的 Index，取值范围在 [0, N-1]，N 为图片的数量</li>
<li>抽象到现实的映射：Index 和 margin-left 的关系；点击按钮简单的给 index 加减，会让 index 超出取值范围，如何实现值的轮回</li>
<li>反向数据流：为按钮添加事件处理函数，点击按钮修改 Index 状态</li>
</ul>
<p>在以上实现过程中，可以每实现一个小功能就测试一下。比如静态效果实现的如何；确保点击按钮输出 index 的值，确保 index 在 [0, N-1] 中不断轮回，然后再将 index-marginLeft 传入到元素中</p>
<p>不足：不能自动播放；组后一张图继续往下，会切换到第一张图，效果比较生硬（直接往回滚到第一张）</p>
<p>补充：</p>
<p><a target="_blank" rel="noopener" href="https://qa.icopy.site/questions/49291442/react-children-map-vs-children-map-whats-the-different">React.Children.map vs children.map，有什么不同？</a>、<a target="_blank" rel="noopener" href="https://www.kancloud.cn/cris/react/660148">React.Children和props.children</a></p>
<ul>
<li>进阶版</li>
</ul>
<p>月影大佬 原生JS写轮播图 JS设计模式</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903939159277576">纯js-普通轮播图、卡片式轮播图、堆叠式轮播图</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/xiaolin/react-image-gallery">React Image Gallery</a></p>
<h2 id="React-组件设计实践——组件的组织"><a href="#React-组件设计实践——组件的组织" class="headerlink" title="React 组件设计实践——组件的组织"></a>React 组件设计实践——组件的组织</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903842392309768">React组件设计实践总结</a> 宝藏系列，主要是文字经验总结，有空细读</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/10/%E5%85%A8%E7%90%83%E6%96%B0%E9%97%BB%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">新闻发布管理系统实战——React全家桶前端+轻服务后端</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-10 15:03:34" itemprop="dateCreated datePublished" datetime="2022-02-10T15:03:34+08:00">2022-02-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-16 15:41:53" itemprop="dateModified" datetime="2022-03-16T15:41:53+08:00">2022-03-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h3><p>本项目实现了一个新闻展示+后台管理网站</p>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/wuuu0/NewsHub">https://github.com/wuuu0/NewsHub</a><br>项目演示：<a target="_blank" rel="noopener" href="https://qcigwi.app.cloudendpoint.cn/">https://qcigwi.app.cloudendpoint.cn</a></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p>前端：React (hooks) + React Router + Redux + Axios + Antd<br>后端：Json Server（辅助前端开发）、Express + 字节跳动轻服务</p>
<h3 id="功能需求-组织架构"><a href="#功能需求-组织架构" class="headerlink" title="功能需求+组织架构"></a>功能需求+组织架构</h3><ul>
<li>前端：</li>
</ul>
<div align="center">
<img src="https://s2.loli.net/2022/02/19/IB35YnE1RiWUjMw.png" width=90%>
</div>

<ul>
<li>后端：</li>
</ul>
<ol>
<li>数据库设计：</li>
</ol>
<ul>
<li>rights</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>权限Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>权限名/侧边栏导航项标题</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>路由地址当作key</td>
</tr>
<tr>
<td>pagepermisson</td>
<td>Number</td>
<td>开关状态，用于判断权限是否可用</td>
</tr>
<tr>
<td>grade</td>
<td>Number</td>
<td>权限层级（默认1）</td>
</tr>
</tbody></table>
<ul>
<li>children</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>权限Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>权限名/导航项标题/功能名称</td>
</tr>
<tr>
<td>rightId</td>
<td>Number</td>
<td>对应一级权限的Id</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>路由地址当作key</td>
</tr>
<tr>
<td>pagepermisson</td>
<td>Number</td>
<td>开关状态，用于判断权限是否可用；<br>非路由权限没有此字段</td>
</tr>
<tr>
<td>grade</td>
<td>Number</td>
<td>权限层级（默认2）</td>
</tr>
</tbody></table>
<ul>
<li>users</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>用户Id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>密码</td>
</tr>
<tr>
<td>roleState</td>
<td>Bool</td>
<td>开关状态，用于判断用户是否可用</td>
</tr>
<tr>
<td>default</td>
<td>Bool</td>
<td>用于判断用户是否可编辑</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>用户地区</td>
</tr>
<tr>
<td>roleId</td>
<td>Number</td>
<td>用户角色的Id</td>
</tr>
</tbody></table>
<ul>
<li>roles</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>角色Id</td>
</tr>
<tr>
<td>roleName</td>
<td>String</td>
<td>角色名称</td>
</tr>
<tr>
<td>roleType</td>
<td>Number</td>
<td>角色类型</td>
</tr>
<tr>
<td>rights</td>
<td>Array-String</td>
<td>角色权限列表，<br>权限用路由地址表示</td>
</tr>
</tbody></table>
<ul>
<li>categories</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>文章类别Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>文章类别标题</td>
</tr>
<tr>
<td>value</td>
<td>String</td>
<td>文章类别值（备用）</td>
</tr>
</tbody></table>
<ul>
<li>regions</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>地区Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>地区标题</td>
</tr>
<tr>
<td>value</td>
<td>String</td>
<td>地区值（备用）</td>
</tr>
</tbody></table>
<ul>
<li>news</li>
</ul>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>文章Id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>文章标题</td>
</tr>
<tr>
<td>categoryId</td>
<td>Number</td>
<td>文章类别Id</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td>文章内容-html格式</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>文章作者所在区域</td>
</tr>
<tr>
<td>author</td>
<td>String</td>
<td>作者用户名</td>
</tr>
<tr>
<td>roleId</td>
<td>Number</td>
<td>作者角色Id</td>
</tr>
<tr>
<td>auditState</td>
<td>Number</td>
<td>审核状态</td>
</tr>
<tr>
<td>publishState</td>
<td>Number</td>
<td>发布状态</td>
</tr>
<tr>
<td>createTime</td>
<td>Number</td>
<td>创建时间</td>
</tr>
<tr>
<td>star</td>
<td>Number</td>
<td>获赞数</td>
</tr>
<tr>
<td>view</td>
<td>Number</td>
<td>浏览数</td>
</tr>
<tr>
<td>publishTime</td>
<td>Number</td>
<td>发表时间</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口 API</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">users</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - username</span><br><span class="line">            | - password</span><br><span class="line">            | - roleState</span><br><span class="line">            | - _expand=role</span><br><span class="line">| - post</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">roles</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">children</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">rights</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - _embed = children</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">categories</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br><span class="line"></span><br><span class="line">regions</span><br><span class="line">| - get</span><br><span class="line">    | - /</span><br><span class="line"></span><br><span class="line">news</span><br><span class="line">| - get</span><br><span class="line">    | - /:id</span><br><span class="line">        | - queryString:</span><br><span class="line">            | - _expand=category</span><br><span class="line">            | - _expand=role</span><br><span class="line">    | - /</span><br><span class="line">        | - queryString</span><br><span class="line">            | - publishState</span><br><span class="line">            | - author=$&#123;username&#125;</span><br><span class="line">            | - auditState=1</span><br><span class="line">            | - _expand=category</span><br><span class="line">            | - _sort=view</span><br><span class="line">            | - _order=desc</span><br><span class="line">            | - _limit=6</span><br><span class="line">| - post</span><br><span class="line">    | - /</span><br><span class="line">| - patch</span><br><span class="line">    | - /:id</span><br><span class="line">| - delect</span><br><span class="line">    | - /:id</span><br></pre></td></tr></table></figure>

<h2 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h2><h3 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h3><p>借助 React 官方脚手架创建项目和进行工程化开发</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/getting-started/">create-react-app 官方文档</a></p>
<h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>包版本管理使用 npm</p>
<p>安装 React</p>
<p>使用 React 提供的脚手架 create-react-app 创建项目 newssystem</p>
<p>将 App.js 中的传统的组件类的写法，更换成 React Hooks 写法</p>
<h3 id="使用-CSS-Module"><a href="#使用-CSS-Module" class="headerlink" title="使用 CSS Module"></a>使用 CSS Module</h3><p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/adding-a-css-modules-stylesheet/">Create React App 中文文档：添加 CSS Modules 样式表</a>、<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html">CSS Modules 用法教程 阮一峰</a></p>
<p>简而言之：使用 CSS Module 可以让 CSS 声明局部作用于个别的组件上，而不是影响全局的组件/html元素。</p>
<p>原理：CSS Module 只对类或者id选择器起作用。通过构建工具，CSS Module 中的类或者id选择器名会被编码，然后再挂载到html中。将 CSS Module 中的样式 import 到一个对象中（下例为style对象），然后我们通过这个对象来获取编码后的类名或id名，再添加给组件/元素。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;./Child.module.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(style)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;style.item&#125;</span>&gt;</span>child-11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;style.item&#125;</span>&gt;</span>child-11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Child.module.css */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-SASS"><a href="#使用-SASS" class="headerlink" title="使用 SASS"></a>使用 SASS</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/adding-a-sass-stylesheet/">Create React App 中文文档：添加 Sass 样式表</a></p>
<p>安装好 sass 后，React 脚手架可以自动识别并处理<code>.sass</code>文件（一般用<code>.scss</code>），使得 Sass 语法生效。可以结合 CSS Module 来使用（即同样延续了上小结的 CSS 局部作用域）。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Child.module.sass */</span></span><br><span class="line"></span><br><span class="line">$<span class="attribute">width</span>:<span class="number">300px</span>;</span><br><span class="line"><span class="selector-tag">ul</span>&#123;</span><br><span class="line">    <span class="selector-class">.item</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: $width;</span><br><span class="line">        <span class="attribute">background-color</span>: red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置反向代理"><a href="#设置反向代理" class="headerlink" title="设置反向代理"></a>设置反向代理</h3><p>参考资料：<a target="_blank" rel="noopener" href="https://www.html.cn/create-react-app/docs/proxying-api-requests-in-development/#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86">手动配置代理</a></p>
<p>前端可能需要向后端请求一些数据，而后端可能与我们的页面不同源，也就是存在跨域。因此，我们要设置反向代理来方便我们对后端进行跨域请求。</p>
<p>此处我们先安装并<code>import axios</code>来进行后端请求测试。（本项目的请求也都使用 axios）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//这是一个跨域请求，在未设置代理的情况下会报错。</span></span><br><span class="line">    axios.get(<span class="string">&quot;https://m.maoyan.com/ajax/movieOnInfoList?token=&amp;optimus_uuid=74B5F0A032A711EB82DD6B9282E93C676D27D7B9731D4E608D7612C3E708C120&amp;optimus_risk_level=71&amp;optimus_code=10&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    app</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>11111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>22222<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Child</span>/&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们设置代理。首先安装<code>http-proxy-middleware</code>。接下来，将上方代码中请求的URL的主机域名<code>https://m.maoyan.com</code>删掉，然后创建<code>src/setupProxy.js</code>并将以下内容放入该文件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(</span><br><span class="line">    <span class="string">&#x27;/ajax&#x27;</span>,</span><br><span class="line">    createProxyMiddleware(&#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&#x27;https://m.maoyan.com&#x27;</span>,</span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>PS：此处的跨域请求只是示例，具体情况具体分析。比如我们后面可能要向后端服务器请求数据，然后我们本地开发的时候是用 <code>https://localhost:xxxx</code> 来模拟后端服务器，那么<code>setupProxy.js</code>中的<code>target</code>就要修改成<code>https://localhost:xxxx</code>。</p>
<p>此外，我们请求成功后获取json格式的数据，如下所示（详见HTTP知识）。</p>
<figure class="highlight plaintext"><figcaption><span>tidy</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;chiefBonus&quot;:&#123;&quot;1433696&quot;:[&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p0.meituan.net/movie/3c38fac891a015c4d7762267a25e40d684709.jpg&quot;,&quot;chiefName&quot;:&quot;马丽&quot;&#125;,&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p0.meituan.net/movie/f9d2ab86553fbdbb615e55dfff74f0b678394.jpg&quot;,&quot;chiefName&quot;:&quot;周大勇&quot;&#125;,&#123;&quot;chiefAvatarUrl&quot;:&quot;http://p1.meituan.net/movie/39069df1dd096df841d20abaf80264e970266.jpg&quot;,&quot;chiefName&quot;:&quot;陈明昊&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>前后端的接口就围绕着这种json数据格式，前端向后端请求获得json数据来进行组件的渲染、权限开关等功能，而后端则需要写好数据库增删查改、整合形成前端需要的json数据等逻辑。</p>
<p>这涉及到：产品需求分析、产品业务逻辑、前后端分工：</p>
<ul>
<li>前端：确定要实现什么产品功能，用户交互时要返回什么数据来实现这个功能</li>
<li>后端：如何组织存储数据，接到前端请求如何返回前端需要的数据</li>
</ul>
<h3 id="路由架构"><a href="#路由架构" class="headerlink" title="路由架构"></a>路由架构</h3><p>参考内容：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903923963133959">掘金 前端路由和后端路由简单总结</a></p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/11/DR3PBFC48jlXKcm.png" width=60%>
</div>

<p>安装<code>react-router-dom</code>。</p>
<p>更具路由结构，确定工程目录结构：</p>
<p>views 目录下针对每个路由都创建一个文件夹，用来存放相应的组件和css等。每一个（前端）路由都对应一个组件，而这些组件中由包括对应的后端路由，向后端请求相应的数据。三个一级路由<code>/login</code> <code>/</code> <code>/news</code>分别对应三个大的页面：<strong>登录页面</strong>、<strong>后端管理系统页面</strong>、<strong>新闻展示页面</strong>。</p>
<p>component 目录则存放 views 目录中组件可能用到的子组件。</p>
<h3 id="引入-Ant-Design"><a href="#引入-Ant-Design" class="headerlink" title="引入 Ant Design"></a>引入 Ant Design</h3><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/docs/react/use-with-create-react-app-cn">Ant Design: 在 create-react-app 中使用</a></p>
<p>安装 ant design</p>
<p>修改 src/App.js，引入 src/App.css；<br>修改 src/App.css，在文件顶部引入 antd/dist/antd.css</p>
<blockquote>
<p>这样就做到了 antd 的样式全局生效，即任何地方引入的antd组件都有用。但有些组件还需手动引入文档给出的样式，比如后面用到的 layout</p>
</blockquote>
<p>然后就可以在各处引入 antd 组件来使用了。</p>
<h3 id="使用-Json-Server-模拟后端"><a href="#使用-Json-Server-模拟后端" class="headerlink" title="使用 Json Server 模拟后端"></a>使用 Json Server 模拟后端</h3><p>数据库数据格式设计：</p>
<p>Json Server 基本使用：</p>
<h2 id="项目实现"><a href="#项目实现" class="headerlink" title="项目实现"></a>项目实现</h2><p>前端实现的大体思路：</p>
<ul>
<li>确定项目路由关系，划分清楚页面+组件模块</li>
<li>构思如何实现一个静态页面。假定已获取后端数据，不考虑交互效果、业务逻辑，实现基本的静态页面</li>
<li>实现动态功能：组件挂载时请求后端数据；交互时更新前端 View + 处理后端数据</li>
<li>回过头来根据用户登录信息和权限数据添加逻辑，实现权限控制</li>
</ul>
<h3 id="后端管理页面-lt-NewsSandBox-gt"><a href="#后端管理页面-lt-NewsSandBox-gt" class="headerlink" title="后端管理页面 &lt;/NewsSandBox/&gt;"></a>后端管理页面 &lt;/NewsSandBox/&gt;</h3><p>对应 src/views/sandbox 文件夹</p>
<h4 id="页面布局-Layout"><a href="#页面布局-Layout" class="headerlink" title="页面布局 Layout"></a>页面布局 Layout</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/components/layout-cn/#components-layout-demo-side">Ant Design：Layout 布局</a></p>
<p>页面的实现（样式布局，交互效果）主要依赖 antd 的 layout 组件，但是要自己拆解拆解组合。</p>
<p>Antd Layout 效果图</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/12/uwWLgpDzxUyjs17.png" width=90%>
</div>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Ant Design：Layout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文档给出的是类写法，我们要改成 Hooks 写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文档点击按钮侧边栏缩放，是通过 layout 的父组件的 state：collapsed 进行子组件间的通信。后面我们要统一用 Redux 进行状态管理。</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span> <span class="attr">collapsible</span> <span class="attr">collapsed</span>=<span class="string">&#123;this.state.collapsed&#125;</span>&gt;</span> ---------------&gt; ours <span class="tag">&lt;<span class="name">SideMenu</span>/&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span> <span class="attr">defaultSelectedKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">1</span>&#x27;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 1</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">VideoCameraOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 2</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UploadOutlined</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">              nav 3</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;site-layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> <span class="attr">0</span> &#125;&#125;&gt;</span> ---------------&gt; ours <span class="tag">&lt;<span class="name">TopHeader</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;React.createElement(this.state.collapsed ? MenuUnfoldOutlined : MenuFoldOutlined, &#123;</span></span><br><span class="line"><span class="xml">              className: &#x27;trigger&#x27;,</span></span><br><span class="line"><span class="xml">              onClick: this.toggle,</span></span><br><span class="line"><span class="xml">            &#125;)&#125; -----------------------------------------------&gt; 改改，写回纯组件形式，记得补上类和事件处理函数</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">margin:</span> &#x27;<span class="attr">24px</span> <span class="attr">16px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">padding:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">              <span class="attr">minHeight:</span> <span class="attr">280</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">          &gt;</span></span></span><br><span class="line"><span class="xml">            Content ---------------------------------------------------&gt; ours 路由组件</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>改造后</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsSandBox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面进度条</span></span><br><span class="line">    NProgress.start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 渲染完成，进度条结束</span></span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        NProgress.done()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">SideMenu</span>&gt;</span><span class="tag">&lt;/<span class="name">SideMenu</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;site-layout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">TopHeader</span>&gt;</span><span class="tag">&lt;/<span class="name">TopHeader</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">margin:</span> &#x27;<span class="attr">24px</span> <span class="attr">16px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">padding:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">minHeight:</span> <span class="attr">280</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">overflow:</span>&quot;<span class="attr">auto</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">NewsRouter</span>&gt;</span><span class="tag">&lt;/<span class="name">NewsRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="顶部栏-lt-TopHeader-gt"><a href="#顶部栏-lt-TopHeader-gt" class="headerlink" title="顶部栏 &lt;/TopHeader/&gt;"></a>顶部栏 &lt;/TopHeader/&gt;</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/components/dropdown-cn/">Ant Design：Dropdown下拉菜单</a></p>
<p>左方的按钮设置一下；顶部栏右上角添加一个下拉菜单，用来控制用户登录退出——目前还没有实现用户登录功能，所以这个下拉菜单栏先设计出来占个位。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TopHeader</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [collapsed, setCollapsed] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> changeCollapsed = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setCollapsed(!collapsed)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> menu = (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                超级管理员</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">danger</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> &#x27;<span class="attr">0</span> <span class="attr">16px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                collapsed ? <span class="tag">&lt;<span class="name">MenuUnfoldOutlined</span> <span class="attr">onClick</span>=<span class="string">&#123;changeCollapsed&#125;</span> /&gt;</span> : <span class="tag">&lt;<span class="name">MenuFoldOutlined</span> <span class="attr">onClick</span>=<span class="string">&#123;changeCollapsed&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">float:</span> &quot;<span class="attr">right</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎admin回来<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Dropdown</span> <span class="attr">overlay</span>=<span class="string">&#123;menu&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Dropdown</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="侧边栏-lt-SideMenu-gt"><a href="#侧边栏-lt-SideMenu-gt" class="headerlink" title="侧边栏 &lt;/SideMenu/&gt;"></a>侧边栏 &lt;/SideMenu/&gt;</h4><p>侧边栏左上角添加“全球新闻发布系统”标题</p>
<p>查看 antd layout 文档，为侧边栏添加二级下拉菜单：<a target="_blank" rel="noopener" href="https://ant.design/components/menu-cn/#components-menu-demo-inline">Ant Design：SubMenu 内嵌菜单</a></p>
<p>大致摸清了前端实现界面的方法（组件），就开始考虑从后端接受类似是数组的数据，前端根据后端的数据，动态的确定我们页面的情况。大致思路：</p>
<ul>
<li><code>&lt;SideMenu/&gt;</code>组件写一个副作用<code>useEffect</code>，在它挂载/渲染时就向后端请求数据（类似数组结构数据），然后根据后端的数组数据来渲染我们的侧边栏。渲染侧边栏的时候，还需要检查校验用户权限+权限管理开关状态。</li>
<li><code>Menu</code>的每项<code>item</code>都有一个<code>key</code>属性，可以将该<code>key</code>设置为我们的前端路由名。可以给每个菜单项设置一个对应的 OnCLick 属性，点到对应的<code>item</code>，就取出<code>key</code>值，并路由到相应的路由组件——<code>content</code>就渲染出对应的组件。</li>
<li>请求的后端<code>/rights?_embed=children</code>数据，读取到前端后的格式如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">menu = [</span><br><span class="line">  &#123;--------------------------------------------&gt; 一项就是一个菜单栏项</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&quot;/home&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;首页&quot;</span>,</span><br><span class="line">    <span class="attr">pagepermision</span>:<span class="number">1</span>, --------------------------&gt; 用于判断是否是渲染：是否为路由级权限 and 该权限是否开放</span><br><span class="line">    <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    children:[]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">key</span>:<span class="string">&quot;/user-manage&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">    <span class="attr">pagepermision</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    children:[ --------------------------------&gt; 二级菜单</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>:<span class="string">&quot;/user-manage/list&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&quot;用户列表&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>SideMenu 组件的实现。具体逻辑看注释。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SideMenu</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [menu, setMeun] = useState([])</span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取完整的权限列表</span></span><br><span class="line">    axios.get(<span class="string">&quot;/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取到数据后根据数据构造 meun 数据</span></span><br><span class="line">      setMeun(res.data)                                  </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据当前登录的用户信息，来获取用户可以使用的权限的列表</span></span><br><span class="line">  <span class="comment">// 用于后续渲染侧边栏时，同后端的完整权限列表作比较，看哪些该渲染出来</span></span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">role</span>:&#123;rights&#125;&#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据获取的用户权限和权限列表的papgepermission属性，进行路由权限管理</span></span><br><span class="line">  <span class="keyword">const</span> checkPagePermission = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.pagepermisson &amp;&amp; rights.includes(item.key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据 menu 数据，返回相应的侧边栏组件。</span></span><br><span class="line">  <span class="comment">// 递归方式：数据中有 children 则渲染出一级菜单再进一步渲染子菜单；</span></span><br><span class="line">  <span class="comment">// 若没有children——也就是到底了，则渲染本身的item。</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> renderMenu = <span class="function">(<span class="params">menuList</span>)=&gt;</span>&#123;                        </span><br><span class="line">    <span class="keyword">return</span> menuList.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(item.children?.length&gt;<span class="number">0</span> &amp;&amp; checkPagePermission(item))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SubMenu</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;iconList[item.key]&#125;</span> <span class="attr">title</span>=<span class="string">&#123;item.title&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">           &#123; renderMenu(item.children) &#125;   </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// js 语法，会先判断第一个的值，若为真则直接返回第二个值</span></span><br><span class="line">      <span class="keyword">return</span> checkPagePermission(item) &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;iconList[item.key]&#125;</span>  <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        // SideMenu 并不直接外接 Router，想使用路由参数需要借助 withRouter</span></span><br><span class="line"><span class="xml">        // SideMenu ---&gt; NewsSandBox ---&gt; SideMenu</span></span><br><span class="line"><span class="xml">        // console.log(props)</span></span><br><span class="line"><span class="xml">        // 这里实现导航功能：</span></span><br><span class="line"><span class="xml">        // 点击侧边栏的最底层项，会设置当前的地址栏为指定路由，进而导致对应路由组件的渲染</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        props.history.push(item.key)</span></span><br><span class="line"><span class="xml">      &#125;&#125;&gt;&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// selectKeys 存放当前的路由路径，用于页面刷新后，菜单栏对应的项保持高亮</span></span><br><span class="line">  <span class="comment">// console.log(props.location.pathname)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selectKeys = [props.location.pathname]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// openKeys 存放当前的路由路径下，侧边栏应该打开的项，需要截取当前路径的一级路径</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> openKeys = [<span class="string">&quot;/&quot;</span>+props.location.pathname.split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 组件初次挂载、副作用向后端请求数据到手后获取设置 state 会触组件更新。毫无疑问</span></span><br><span class="line">  <span class="comment">// Menu 项被点击后也会改变组件的表现，也即更新，这应该是封装在了 antd 中 </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span> <span class="attr">collapsible</span> <span class="attr">collapsed</span>=<span class="string">&#123;props.isCollapsed&#125;</span> &gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;display:</span>&quot;<span class="attr">flex</span>&quot;,<span class="attr">height:</span>&quot;<span class="attr">100</span>%&quot;,&quot;<span class="attr">flexDirection</span>&quot;<span class="attr">:</span>&quot;<span class="attr">column</span>&quot;&#125;&#125;&gt;</span>  // 添加侧边栏部分的滚动条</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> &gt;</span>全球新闻发布管理系统<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;flex:1,</span>&quot;<span class="attr">overflow</span>&quot;<span class="attr">:</span>&quot;<span class="attr">auto</span>&quot;&#125;&#125;&gt;</span>                             // 添加侧边栏部分的滚动条</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">          // selectedKeys 和 defaultSelectedKeys 的区别</span></span><br><span class="line"><span class="xml">          // 前者的值变动时 Menu 组件会更新重新渲染，后者的值只在 Menu 挂载时生效</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span> <span class="attr">selectedKeys</span>=<span class="string">&#123;selectKeys&#125;</span> <span class="attr">className</span>=<span class="string">&quot;aaaaaaa&quot;</span> <span class="attr">defaultOpenKeys</span>=<span class="string">&#123;openKeys&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">              &#123;renderMenu(meun)&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line">  ) </span><br><span class="line"></span><br><span class="line">  <span class="comment">// withRouter 高阶函数，返回一个能够获取路由参数的 SideMenu</span></span><br><span class="line">  <span class="comment">// 后续还要使用 redux，因此还要将状态传输出去</span></span><br></pre></td></tr></table></figure>

<h4 id="内容区域-lt-Content-gt"><a href="#内容区域-lt-Content-gt" class="headerlink" title="内容区域 &lt;/Content/&gt;"></a>内容区域 &lt;/Content/&gt;</h4><p>根据路由选择显示什么组件，目前这些组件尚未实现。在添加路由组件前，还需要检查用户权限和权限管理开关，看是否可以添加。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Content</span><br><span class="line">    className=<span class="string">&quot;site-layout-background&quot;</span></span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">        <span class="attr">margin</span>: <span class="string">&#x27;24px 16px&#x27;</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="attr">minHeight</span>: <span class="number">280</span>,</span><br><span class="line">        <span class="attr">overflow</span>:<span class="string">&quot;auto&quot;</span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">NewsRouter</span>&gt;</span><span class="tag">&lt;/<span class="name">NewsRouter</span>&gt;</span></span></span><br><span class="line">&lt;/Content&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> LocalRouterMap = &#123;</span><br><span class="line">    <span class="string">&quot;/home&quot;</span>: Home,</span><br><span class="line">    <span class="string">&quot;/user-manage/list&quot;</span>: UserList,</span><br><span class="line">    <span class="string">&quot;/right-manage/role/list&quot;</span>: RoleList,</span><br><span class="line">    <span class="string">&quot;/right-manage/right/list&quot;</span>: RightList,</span><br><span class="line">    <span class="string">&quot;/news-manage/add&quot;</span>: NewsAdd,</span><br><span class="line">    <span class="string">&quot;/news-manage/draft&quot;</span>: NewsDraft,</span><br><span class="line">    <span class="string">&quot;/news-manage/category&quot;</span>: NewsCategory,</span><br><span class="line">    <span class="string">&quot;/news-manage/preview/:id&quot;</span>: NewsPreview,</span><br><span class="line">    <span class="string">&quot;/news-manage/update/:id&quot;</span>: NewsUpdate,</span><br><span class="line">    <span class="string">&quot;/audit-manage/audit&quot;</span>: Audit,</span><br><span class="line">    <span class="string">&quot;/audit-manage/list&quot;</span>: AuditList,</span><br><span class="line">    <span class="string">&quot;/publish-manage/unpublished&quot;</span>: Unpublished,</span><br><span class="line">    <span class="string">&quot;/publish-manage/published&quot;</span>: Published,</span><br><span class="line">    <span class="string">&quot;/publish-manage/sunset&quot;</span>: Sunset</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewsRouter</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [BackRouteList, setBackRouteList] = useState([])</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all([</span><br><span class="line">            axios.get(<span class="string">&quot;/rights&quot;</span>),</span><br><span class="line">            axios.get(<span class="string">&quot;/children&quot;</span>),</span><br><span class="line">        ]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// BackRouteList 对应的是完整的权限列表</span></span><br><span class="line">            <span class="comment">// console.log(res)</span></span><br><span class="line">            setBackRouteList([...res[<span class="number">0</span>].data, ...res[<span class="number">1</span>].data])</span><br><span class="line">            <span class="comment">// console.log(BackRouteList)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据用户登录信息，取出用户权限</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">role</span>: &#123; rights &#125; &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查权限是否对应路由组件；检查是否开启，对应我们此前的权限管理中的 switch 开关的功能</span></span><br><span class="line">    <span class="keyword">const</span> checkRoute = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalRouterMap[item.key] &amp;&amp; (item.pagepermisson || item.routepermisson)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查用户是否拥有路由权限</span></span><br><span class="line">    <span class="keyword">const</span> checkUserPermission = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rights.includes(item.key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Spin</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">spinning</span>=<span class="string">&#123;props.isLoading&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    BackRouteList.map(item =&gt; &#123;</span></span><br><span class="line"><span class="xml">                        if (checkRoute(item) &amp;&amp; checkUserPermission(item)) &#123;</span></span><br><span class="line"><span class="xml">                            return <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">component</span>=<span class="string">&#123;LocalRouterMap[item.key]&#125;</span> <span class="attr">exact</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;</span></span><br><span class="line"><span class="xml">                        return null</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                    )</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;/&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">exact</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    BackRouteList.length &gt; 0 &amp;&amp; <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Nopermission&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Spin</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123;LoadingReducer:&#123;isLoading&#125;&#125;</span>)=&gt;</span>(&#123;</span><br><span class="line">    isLoading</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(NewsRouter)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="网站路由关系小结"><a href="#网站路由关系小结" class="headerlink" title="网站路由关系小结"></a>网站路由关系小结</h4><p>输入我们的应用网址：</p>
<ul>
<li><p>未登录会重定向到<code>/login</code></p>
</li>
<li><p>登陆后默认路由至<code>/</code>。<code>/</code>路由对应路由组件<code>&lt;NewSandBox /&gt;</code></p>
<ul>
<li><p>子组件<code>&lt;SideMenu/&gt;</code>有个副作用，会向后端请求<code>rights</code>数据，获取数据后 setState 更新状态并渲染<code>&lt;SideMenu/&gt;</code>；侧边栏有导航作用，即点击侧边栏最底层项，会设置当前路由地址</p>
</li>
<li><p>子组件<code>&lt;Content/&gt;</code>会根据当前路由地址，选择渲染对应的路由组件来显示内容。其中，特别的是，若路由为<code>/</code>则重定向至<code>/home</code>（不会撤销<code>/</code>的路由下已渲染的组件）</p>
</li>
<li><p><code>&lt;SideMenu/&gt;</code> 渲染侧边栏导航项、<code>&lt;Content/&gt;</code> 构建路由组件，都会限制于当前用户的登录权限。详情见 <a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">IndexRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/news&quot;</span> <span class="attr">component</span>=<span class="string">&#123;News&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/detail/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Detail&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;NewsSandBox&#125;/</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml">                // 以下这种路由写法，NewsSandBox 的 props 无法自动拿到 history 等路由参数</span></span><br><span class="line"><span class="xml">                // 并且不直接匹配路由的组件，比如 NewsSandBox 的子组件，也无法自动获取路由参数</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">render</span>=<span class="string">&#123;()</span>=&gt;</span></span></span><br><span class="line"><span class="xml">                    localStorage.getItem(&quot;token&quot;)?</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">NewsSandBox</span> &gt;</span><span class="tag">&lt;/<span class="name">NewsSandBox</span>&gt;</span>:</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;/&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/isayme/blog/issues/40">Koa/Express 定义含有冒号(:)的路由</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903685554700302">React中的url参数——this.props.match</a></p>
<p>至此，整个网站的大框架已经基本搭建完成。后端管理页面的导航和路由框架也实现，后续继续添加系统功能，以及实现各分级路由下的<code>&lt;Content/&gt;</code>组件。</p>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>权限管理的业务逻辑：</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/14/q2Bw9AKTzf5hbZl.png" width=70%>
</div>

<div align="center">
  <img src="https://s2.loli.net/2022/02/16/6rqfuFGjBEzJHL5.jpg" width=60%>
</div>

<ul>
<li><p>权限列表<code>rights</code>是最根本的列表，它保存了网址的所有权限。侧边栏根据它来渲染导航项，内容区根据它来添加路由组件。可以直接在这个层级上进行统一的权限开关。</p>
</li>
<li><p>用户系统和角色系统编辑维护<code>users</code>和<code>roles</code>两个列表。届时，要先获取用户信息和其角色信息——包含一个存放角色权限信息的数组。路由在侧边栏<code>SideMenu</code>渲染的时候，以角色权限数组和后端权限列表作比较，来确定是否渲染对应的侧边栏项。关闭侧边栏导航远远不够，为了防止用户直接在地址栏输入相应路由，还需要在编写内容去区<code>Content</code>时，检查用户的角色权限数组，来决定是否添加相应的路由组件。</p>
</li>
<li><p>所谓权限管理：都是通过编辑后端相应的列表数据来实现的。而真正的让权限管理生效，则是通过在前端业务逻辑中，对比用户登录数据和后端数据，来决定是否渲染相应内容来实现——是否渲染侧边栏对应路由权限，是否渲染具体页面中的小组件或下拉栏选项对应非路由权限。</p>
<ul>
<li><p>路由权限：① 针对第一点修改<code>rights</code>表，可以控制<code>SideMenu</code> <code>Content</code>从后端获取的数据进而在前端隐藏相应导航项或路由组件；② 针对第二点修改<code>roles</code> <code>users</code>表，可以控制用户角色，以及特定角色从后端获取到的<code>roles</code>表，在渲染<code>SideMenu</code>和构建<code>Content</code>的时候通过逻辑给绕过某些导航项或路由组件。</p>
</li>
<li><p>非路由权限：① 后台管理页面-用户列表页面：“添加用户”“修改用户”功能，会根据当前用户角色权限来做一定的限制。<code>UserList</code> 根据登录用户角色权限，渲染了有限的用户<code>Table</code>项；<code>UserForm</code>根据登录用户角色权限，让 添加/修改用户 的表单中，只能创建有限种类的区域和角色的用户。② 后台管理页面-新闻、审核、发布管理页面：都需要核验用户登录信息，检查其权限，来确定哪些<code>Table</code>项应该被渲染。</p>
</li>
</ul>
</li>
</ul>
<p>接下来，我们先实现这三个列表。</p>
<p>即 <code>&lt;RightList/&gt;</code>、<code>&lt;RoleList/&gt;</code>、<code>&lt;UserList&gt;</code>。这三个组件/页面的功能，都是获取并展示各自对应的后端列表，并在前端提供了编辑后端的列表的功能，仅此而已。真正的权限管理，需要另外实现，比如如前所述的<code>SideMenu</code>组件中控制侧边栏导航项渲染的逻辑。</p>
<p>在后续编写代码时，我们要时刻清楚：前端基于什么数据渲染？前端交互效果是如何？对应了什么后端数据库操作？</p>
<p>此外，我们约定，前端只能对后端 <code>rights</code> <code>roles</code> 表进行删除项不能添加项，也不能修改 ID、名称等信息。</p>
<h4 id="权限列表-lt-RightList-gt"><a href="#权限列表-lt-RightList-gt" class="headerlink" title="权限列表 &lt;/RightList/&gt;"></a>权限列表 &lt;/RightList/&gt;</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://ant.design/components/table-cn/#components-table-demo-basic">Ant design：Table表格</a></p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/14/QhVJPz4ElvjIfZK.png" width=70%>
</div>

<p>权限列表组件的实现比较简单。</p>
<ul>
<li><p>首先向后端获取<code>/rights?_embed=children</code>数据</p>
</li>
<li><p>使用 antd <code>&lt;Table/&gt;</code> 组件，展示后端数据。还用到 <code>Button</code> <code>Modal</code> <code>Popover</code> 等组件。参考文档，根据我们的需求进行自定义设置。</p>
</li>
<li><p>删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新（前端，立即有效果），同时调用后端接口修改数据库表（需要刷新页面，才有效果——SideMenu组件重新挂载，向后端申请数据，才有效）。就是删除<code>rights</code>表中的某一项权限。</p>
</li>
<li><p>开关权限：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。就是修改<code>rigths</code>表中某一项权限的<code>pagepermission</code>值。</p>
</li>
</ul>
<p>PS：前端显示的内容都来自于后端，直觉上可能会觉得：我们操作更新后端，前端的数据不也就更新了吗？何必还要多写一次更新前端？但我们实现的时候，只是在组件挂载的时候（<code>useEffect</code>第二个参数填<code>[]</code>，不然的话在副作用中更新状态，会导致无限循环）请求后端数据，因此需要刷新页面重新向后端请求数据，前端才会更新。因此，最好在我们操作的时候实现就手动更新前端，这样用户体验会好很多。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">RightList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setdataSource] = useState([])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line"></span><br><span class="line">            list.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (item.children.length === <span class="number">0</span>) &#123;</span><br><span class="line">                    item.children = <span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            setdataSource(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;权限名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;权限路径&quot;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;key&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Tag</span> <span class="attr">color</span>=<span class="string">&quot;orange&quot;</span>&gt;</span>&#123;key&#125;<span class="tag">&lt;/<span class="name">Tag</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置 dataIndex，则会将源数组中的一个完整对象传给 render 的形参  </span></span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    </span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Popover</span> <span class="attr">content</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;textAlign:</span>&quot;<span class="attr">center</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;item.pagepermisson&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span>=&gt;</span>switchMethod(item)&#125;&gt;<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125; title=&quot;页面配置项&quot; trigger=&#123;item.pagepermisson===undefined?&#x27;&#x27;:&#x27;click&#x27;&#125;&gt;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.pagepermisson===undefined&#125;/&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Popover</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span>  switchMethod = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        item.pagepermisson = item.pagepermisson===<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span></span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        setdataSource([...dataSource])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(item.grade===<span class="number">1</span>)&#123;</span><br><span class="line">            axios.patch(<span class="string">`/rights/<span class="subst">$&#123;item.id&#125;</span>`</span>,&#123;</span><br><span class="line">                <span class="attr">pagepermisson</span>:item.pagepermisson</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            axios.patch(<span class="string">`/children/<span class="subst">$&#123;item.id&#125;</span>`</span>,&#123;</span><br><span class="line">                <span class="attr">pagepermisson</span>:item.pagepermisson</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;你确定要删除?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="comment">// content: &#x27;Some descriptions&#x27;,</span></span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;Cancel&#x27;);</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="keyword">const</span> deleteMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        <span class="comment">// 当前页面同步状态 + 后端同步</span></span><br><span class="line">        <span class="keyword">if</span> (item.grade === <span class="number">1</span>) &#123;</span><br><span class="line">            setdataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id))</span><br><span class="line">            axios.delete(<span class="string">`/rights/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// antd-Table 支持树形数据的展示。数据中有 children 字段的时候会自动展示位树形结构。</span></span><br><span class="line">            <span class="comment">// 且默认情况下 children 数组在表格中的渲染，同样遵循 columns 中的设置</span></span><br><span class="line">            <span class="comment">// 所以这里 item 对应的是 children 数组中的单个对象；datasource 仍是完整的链接过的表</span></span><br><span class="line">            <span class="keyword">let</span> list = dataSource.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id===item.rightId)</span><br><span class="line">            list[<span class="number">0</span>].children = list[<span class="number">0</span>].children.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id!==item.id)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 注意，要返回一个新的数组，以确保能识别到 dataSource 有所改变</span></span><br><span class="line">            setdataSource([...dataSource])</span><br><span class="line">            axios.delete(<span class="string">`/children/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">pageSize:</span> <span class="attr">5</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="角色列表-lt-RoleList-gt"><a href="#角色列表-lt-RoleList-gt" class="headerlink" title="角色列表 &lt;/RoleList/&gt;"></a>角色列表 &lt;/RoleList/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/15/IPOWxvJeVd8bzNp.png" width=70%>
</div>

<p>思路和 <strong>权限列表</strong> 类似。</p>
<ul>
<li><p>挂载时向后端请求数据<code>/roles</code>和<code>/rights?_embed=children</code></p>
</li>
<li><p>用到的 antd 组件主要是<code>Table</code> <code>Modal</code> <code>Tree</code>。<code>Table</code>展示<code>roles</code>列表信息。</p>
</li>
<li><p>删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即删除<code>roles</code>列表中的某一个角色。</p>
</li>
<li><p>编辑角色权限：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即点到相应角色，弹出框显示<code>rights?_embed=children</code>所有权限，并默认勾选上该角色有的权限即<code>role.rights</code>数组。然后在前端勾选或取消某些权限，就会将前端的<code>role.rights</code> <code>patch</code>到后端，实现修改后端的<code>role.rights</code>。</p>
</li>
</ul>
<p>但此处有一部分功能没实现：</p>
<p>如开头<a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a>所述，我们的权限管理是通过侧边栏的导航是否隐藏来实现的。而侧边栏的渲染取决于<code>rights?_embed=children</code>表和当前登录用户的<code>role.rights</code>表。当我们在用户列表页面取消导航路由相关的权限时，侧边栏渲染时检查<code>role.rights</code>发现没有，自然不会渲染出来，能够成功实现权限管理；但当我们在用户列表取消修改角色、删除角色这类非导航路由的权限时，虽然后端<code>role.rights</code>依旧会删除相应的项，但由于我们并没有实现对<strong>非导航路由</strong>权限的检查，因此会发现，相应的角色依旧能够修改删除角色。</p>
<div align="center">
  <img src="https://s2.loli.net/2022/02/15/CDLHMld96zOt8VZ.png" width=50%>
</div>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">RoleList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setdataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [rightList, setRightList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [currentRights, setcurrentRights] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [currentId, setcurrentId] = useState(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [isModalVisible, setisModalVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleName&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; onClick=&#123;()=&gt;&#123;</span></span><br><span class="line"><span class="xml">                        setisModalVisible(true)</span></span><br><span class="line"><span class="xml">                        setcurrentRights(item.rights)</span></span><br><span class="line"><span class="xml">                        setcurrentId(item.id)</span></span><br><span class="line"><span class="xml">                    &#125;&#125;/&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;你确定要删除?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="comment">// content: &#x27;Some descriptions&#x27;,</span></span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;Cancel&#x27;);</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="keyword">const</span> deleteMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        setdataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id))</span><br><span class="line">        axios.delete(<span class="string">`/roles/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/roles&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data)</span></span><br><span class="line">            setdataSource(res.data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data)</span></span><br><span class="line">            setRightList(res.data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确认之后，隐藏 Modal-Tree 框</span></span><br><span class="line">    <span class="comment">// 根据 currentRights ，更新 Table 的表现，并更新后端数据</span></span><br><span class="line">    <span class="keyword">const</span> handleOk = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(currentRights,currentId)</span><br><span class="line">        setisModalVisible(<span class="literal">false</span>)</span><br><span class="line">        <span class="comment">//同步datasource</span></span><br><span class="line">        setdataSource(dataSource.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(item.id===currentId)&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    ...item,</span><br><span class="line">                    <span class="attr">rights</span>:currentRights</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">//patch</span></span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/roles/<span class="subst">$&#123;currentId&#125;</span>`</span>,&#123;</span><br><span class="line">            <span class="attr">rights</span>:currentRights</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleCancel  =<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setisModalVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每点一个选项，Tree 组件就会记录当前选中的所有项</span></span><br><span class="line">    <span class="comment">// checkKeys 形参就是接收点击后的所有选择项</span></span><br><span class="line">    <span class="comment">// 每点一次选项，就更新 currentRights，进而更新 Tree 的表现</span></span><br><span class="line">    <span class="keyword">const</span> onCheck = <span class="function">(<span class="params">checkKeys</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// console.log(checkKeys)</span></span><br><span class="line">        setcurrentRights(checkKeys.checked)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            // Table 组件 要求 dataSource 数组的对象都要有 “key” 属性</span></span><br><span class="line"><span class="xml">            // 当没有 “key” 属性时，要设置 rowKey 属性 指定一个属性代替 “key” </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rowKey</span>=<span class="string">&#123;(item)</span> =&gt;</span> item.id&#125;&gt;<span class="tag">&lt;/<span class="name">Table</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            // Modal 和 Table 的关系更像是并行关系。</span></span><br><span class="line"><span class="xml">            // 但是 Table 中的按钮控制 Modal 的出现和消失，并且两者共享 currentRights 状态</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span> <span class="attr">title</span>=<span class="string">&quot;权限分配&quot;</span> <span class="attr">visible</span>=<span class="string">&#123;isModalVisible&#125;</span> <span class="attr">onOk</span>=<span class="string">&#123;handleOk&#125;</span> <span class="attr">onCancel</span>=<span class="string">&#123;handleCancel&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            </span></span><br><span class="line"><span class="xml">            // 注意 checkedKeys 和 onCheck 的形参不是一回事</span></span><br><span class="line"><span class="xml">            // checkedKeys 属性决定了树形复选框的当前勾选表现 </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tree</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkable</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkedKeys</span> = <span class="string">&#123;currentRights&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCheck</span>=<span class="string">&#123;onCheck&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">checkStrictly</span> = <span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">treeData</span>=<span class="string">&#123;rightList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            /&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="用户列表-lt-UserList-gt"><a href="#用户列表-lt-UserList-gt" class="headerlink" title="用户列表 &lt;/UserList/&gt;"></a>用户列表 &lt;/UserList/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/15/WvzcJCUHKBhnQaY.png" width=70%>
</div>

<p>大同思路和 <strong>角色列表</strong> 类似</p>
<ul>
<li><p>挂载时向后端请求数据<code>/users?_expand=role</code> <code>/roles</code> <code>/regions</code>列表</p>
</li>
<li><p>用到的 antd 组件主要是<code>Table</code> <code>Modal</code> <code>Form</code>。<code>Table</code>展示<code>roles</code>列表信息。</p>
</li>
<li><p>删除操作：点击 item 时获取 item 信息，在前端 setState 修改状态并更新，同时调用后端接口修改数据库表。即删除<code>users</code>列表中的某一个用户。</p>
</li>
<li><p>更新用户</p>
</li>
<li><p>添加用户</p>
</li>
</ul>
<p>特别的</p>
<ul>
<li><p>类似的，角色列表中的权限管理中关于用户的<strong>非路由权限</strong>的管理是无效的——比如添加用户、删除用户。因为<code>UserList</code>仅利用<code>user</code>的<code>role</code>的名称/类型进行逻辑判断，来决定添加用户时的可设置项，与<code>role.rights</code>无关。</p>
</li>
<li><p>关于添加用户、更新用户功能。这里的<code>Modal</code>作为父组件，在点击确定是，需要使用 ref 来获取子组件<code>UserForm</code>的属性（添加用户完成后，获取新用户的用户名等信息），然后前端更新 Table 组件表现并同步更新后端<code>users</code>列表。这里的业务逻辑和用户列表页面大致相同，不同的是用户列表页面是在外部设置了一个共享的<code>currentRights</code>状态，让父组件<code>Modal</code>能获取子组件<code>Tree</code>的属性。这主要是因为此处使用了<code>Form</code>表单。</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setdataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [isAddVisible, setisAddVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [isUpdateVisible, setisUpdateVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [roleList, setroleList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [regionList, setregionList] = useState([])</span><br><span class="line">    <span class="keyword">const</span> [current, setcurrent] = useState(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [isUpdateDisabled, setisUpdateDisabled] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> addForm = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> updateForm = useRef(<span class="literal">null</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户登录信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123;roleId,region,username&#125;  = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line">        <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">            <span class="string">&quot;1&quot;</span>:<span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;2&quot;</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;3&quot;</span>:<span class="string">&quot;editor&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        axios.get(<span class="string">&quot;/users?_expand=role&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据当前登录身份，来选择性渲染用户界面 Table</span></span><br><span class="line">            setdataSource(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>?list:[</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.username===username),</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.region===region&amp;&amp; roleObj[item.roleId]===<span class="string">&quot;editor&quot;</span>)</span><br><span class="line">            ])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [roleId,region,username])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/regions&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line">            setregionList(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/roles&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> list = res.data</span><br><span class="line">            setroleList(list)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;区域&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">            <span class="attr">filters</span>: [</span><br><span class="line">                ...regionList.map(<span class="function"><span class="params">item</span>=&gt;</span>(&#123;</span><br><span class="line">                    <span class="attr">text</span>:item.title,</span><br><span class="line">                    <span class="attr">value</span>:item.value</span><br><span class="line">                &#125;)),</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>:<span class="string">&quot;全球&quot;</span>,</span><br><span class="line">                    <span class="attr">value</span>:<span class="string">&quot;全球&quot;</span></span><br><span class="line">                &#125;    </span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="attr">onFilter</span>:<span class="function">(<span class="params">value,item</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(value===<span class="string">&quot;全球&quot;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> item.region===<span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> item.region===value</span><br><span class="line">            &#125;,</span><br><span class="line">          </span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">region</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region === &quot;&quot; ? &#x27;全球&#x27; : region&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">role</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> role?.roleName</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;username&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;用户状态&quot;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleState&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">roleState, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;roleState&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;item.default&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span>=&gt;</span>handleChange(item)&#125;&gt;<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmMethod(item)&#125; disabled=&#123;item.default&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; onClick=&#123;()=&gt;handleUpdate(item)&#125;/&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleUpdate = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 此处用 setTimeout，主要是让此处的 setisUpdateVisible</span></span><br><span class="line">        <span class="comment">// 能够同步更新 UpdateVisible 状态，也就是让 Modal 立刻 visible</span></span><br><span class="line">        <span class="comment">// 因为 Modal 不 visible 的话，在首次渲染时，底层 DOM 可能根本不存在？</span></span><br><span class="line">        <span class="comment">// 也就意味着子组件 Form 都还不存在，setFieldsValue 自然无法运行</span></span><br><span class="line">        <span class="comment">// 总之，就是要确保 setFieldsValue 的时候 Form 真实存在</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            setisUpdateVisible(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这里需要手动检查预选结果是否应该禁用区域项，不然的话预选</span></span><br><span class="line">            <span class="comment">// 到管理员也不会禁用区域项，因为一般情况下只会在表单中选角色的时候 onChange</span></span><br><span class="line">            <span class="comment">// 才会进行检查并禁用区域项</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 但还有一个特殊情况</span></span><br><span class="line">            <span class="comment">// 点了 Table 的 非管理员 item，setisUpdateDisabled(false)</span></span><br><span class="line">            <span class="comment">// 对于 UserForm 来说 props.isUpdateDisabled 从未定义变成 false 进而触发副作用 isDisabled false</span></span><br><span class="line">            <span class="comment">// 然后在 UserForm 表单上 角色项 选择 管理员，Select onChange 导致 isDisabled true</span></span><br><span class="line">            <span class="comment">// 点击 Modal 取消/更新，UserForm 仍然 isDisabled true</span></span><br><span class="line">            <span class="comment">// 再点 Table 的 非管理员 item，setisUpdateDisabled(false)，props.isUpdateDisabled 仍未 false</span></span><br><span class="line">            <span class="comment">// UserForm 副作用未触发，进而保持 isDisabled true，导致预设的 非管理员item 的表单区域项也被禁用</span></span><br><span class="line">            <span class="comment">// 通过在点击取消/更新后添加 setisUpdateDisabled(!isUpdateDisabled) 来解决</span></span><br><span class="line">            <span class="keyword">if</span>(item.roleId===<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//禁用</span></span><br><span class="line">                setisUpdateDisabled(<span class="literal">true</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//取消禁用</span></span><br><span class="line">                setisUpdateDisabled(<span class="literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 由于是修改用户信息，在点击编辑的时候</span></span><br><span class="line">            <span class="comment">// 最好先将原来的用户信息显示在表单上</span></span><br><span class="line">            updateForm.current.setFieldsValue(item)</span><br><span class="line">        &#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        setcurrent(item)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        item.roleState = !item.roleState</span><br><span class="line">        setdataSource([...dataSource])</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/users/<span class="subst">$&#123;item.id&#125;</span>`</span>,&#123;</span><br><span class="line">            <span class="attr">roleState</span>:item.roleState</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;你确定要删除?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="comment">// content: &#x27;Some descriptions&#x27;,</span></span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                deleteMethod(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">//   console.log(&#x27;Cancel&#x27;);</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="keyword">const</span> deleteMethod = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item)</span></span><br><span class="line">        <span class="comment">// 当前页面同步状态 + 后端同步</span></span><br><span class="line"></span><br><span class="line">        setdataSource(dataSource.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id!==item.id))</span><br><span class="line"></span><br><span class="line">        axios.delete(<span class="string">`/users/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addFormOK = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        addForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(value)</span></span><br><span class="line"></span><br><span class="line">            setisAddVisible(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">            addForm.current.resetFields()</span><br><span class="line">            <span class="comment">//post到后端，生成id，再设置 datasource, 方便后面的删除和更新</span></span><br><span class="line">            axios.post(<span class="string">`/users`</span>, &#123;</span><br><span class="line">                ...value,</span><br><span class="line">                <span class="string">&quot;roleState&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;default&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res.data)</span><br><span class="line">                setdataSource([...dataSource,&#123;</span><br><span class="line">                    ...res.data,</span><br><span class="line">                    <span class="attr">role</span>:roleList.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.id===value.roleId)[<span class="number">0</span>]</span><br><span class="line">                &#125;])</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> updateFormOK = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        updateForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(value)</span></span><br><span class="line">            setisUpdateVisible(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">            setdataSource(dataSource.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(item.id===current.id)&#123;</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        ...item,</span><br><span class="line">                        ...value,</span><br><span class="line">                        <span class="attr">role</span>:roleList.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id===value.roleId)[<span class="number">0</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">            &#125;))</span><br><span class="line">            setisUpdateDisabled(!isUpdateDisabled)</span><br><span class="line"></span><br><span class="line">            axios.patch(<span class="string">`/users/<span class="subst">$&#123;current.id&#125;</span>`</span>,value)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                setisAddVisible(true)</span></span><br><span class="line"><span class="xml">            &#125;&#125;&gt;添加用户<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">pageSize:</span> <span class="attr">5</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125;</span></span><br><span class="line"><span class="xml">            /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">visible</span>=<span class="string">&#123;isAddVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;添加用户&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">okText</span>=<span class="string">&quot;确定&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setisAddVisible(false)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">                onOk=&#123;() =&gt; addFormOK()&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">UserForm</span> <span class="attr">regionList</span>=<span class="string">&#123;regionList&#125;</span> <span class="attr">roleList</span>=<span class="string">&#123;roleList&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;addForm&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">UserForm</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">visible</span>=<span class="string">&#123;isUpdateVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;更新用户&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">okText</span>=<span class="string">&quot;更新&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setisUpdateVisible(false)</span></span><br><span class="line"><span class="xml">                    setisUpdateDisabled(!isUpdateDisabled)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">                onOk=&#123;() =&gt; updateFormOK()&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">UserForm</span> <span class="attr">regionList</span>=<span class="string">&#123;regionList&#125;</span> <span class="attr">roleList</span>=<span class="string">&#123;roleList&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;updateForm&#125;</span> <span class="attr">isUpdateDisabled</span>=<span class="string">&#123;isUpdateDisabled&#125;</span> <span class="attr">isUpdate</span>=<span class="string">&#123;true&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">UserForm</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UserForm = forwardRef(<span class="function">(<span class="params">props,ref</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于判断 “区域” 输入框是否禁用，对应管理员身份</span></span><br><span class="line">    <span class="keyword">const</span> [isDisabled, setisDisabled] = useState(<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 为什么要用副作用来更新状态？props.isUpdateDisabled 改变时</span></span><br><span class="line">    <span class="comment">// UserForm 不是会自动更新吗？</span></span><br><span class="line">    <span class="comment">// 因为我们之前已经为 UserForm 设计了 isDisabled状态</span></span><br><span class="line">    <span class="comment">// 所以我们现在要做的是勾连父子组件状态，而不能简单用子组件的props</span></span><br><span class="line">    <span class="comment">// 要注意，一定是 props.isUpdateDisabled 前后两次改变了才会触发副作用</span></span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setisDisabled(props.isUpdateDisabled)</span><br><span class="line">    &#125;,[props.isUpdateDisabled])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加后端数据库后，roleId 是随机分配的，这里的1、2、3要对应修改成后端的Id</span></span><br><span class="line">    <span class="comment">// 前端不会添加修改后端 roles Id、name 等属性，所以这个映射关系可以写死</span></span><br><span class="line">    <span class="comment">// 但后端可能会修改，修改时需要告知我们，然后我们做调整</span></span><br><span class="line">    <span class="keyword">const</span> &#123;roleId,region&#125;  = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>))</span><br><span class="line">    <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">        <span class="string">&quot;1&quot;</span>:<span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;2&quot;</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;3&quot;</span>:<span class="string">&quot;editor&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> checkRegionDisabled = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(props.isUpdate)&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> item.value!==region</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查当前用户角色权限，开放相应的区域选项</span></span><br><span class="line">    <span class="keyword">const</span> checkRoleDisabled = <span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(props.isUpdate)&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(roleObj[roleId]===<span class="string">&quot;superadmin&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> roleObj[item.id]!==<span class="string">&quot;editor&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Form</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">layout</span>=<span class="string">&quot;vertical&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        &gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;密码&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;region&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;区域&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;isDisabled?[]:[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Select</span> <span class="attr">disabled</span>=<span class="string">&#123;isDisabled&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        props.regionList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.value&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;checkRegionDisabled(item)&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">name</span>=<span class="string">&quot;roleId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">label</span>=<span class="string">&quot;角色&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">title</span> <span class="attr">of</span> <span class="attr">collection</span>!&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Select</span> <span class="attr">onChange</span>=<span class="string">&#123;(value)</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="xml">                    // console.log(value)</span></span><br><span class="line"><span class="xml">                    // 添加后端后，1要改成后台的Id</span></span><br><span class="line"><span class="xml">                    // 绑定在表单角色项 onChange 事件上，也就意味着</span></span><br><span class="line"><span class="xml">                    // 得选了角色才会去检查是否应该禁用区域项</span></span><br><span class="line"><span class="xml">                    if(value === 1)&#123;</span></span><br><span class="line"><span class="xml">                        setisDisabled(true)</span></span><br><span class="line"><span class="xml">                        ref.current.setFieldsValue(&#123;</span></span><br><span class="line"><span class="xml">                            region:&quot;&quot;</span></span><br><span class="line"><span class="xml">                        &#125;)</span></span><br><span class="line"><span class="xml">                    &#125;else&#123;</span></span><br><span class="line"><span class="xml">                        setisDisabled(false)</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                &#125;&#125;&gt;</span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        props.roleList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;checkRoleDisabled(item)&#125;</span>&gt;</span>&#123;item.roleName&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserForm</span><br></pre></td></tr></table></figure>

<h4 id="登录界面-lt-Login-gt"><a href="#登录界面-lt-Login-gt" class="headerlink" title="登录界面 &lt;/Login/&gt;"></a>登录界面 &lt;/Login/&gt;</h4><p>实现的比较简陋。用户填写完登录表单后，将带有表单数据当作参数的HTTP请求发送给后台，后台根据请求参数决定返回什么结果。在登陆成功后，浏览器存下一个本地 token——包含了当前登录用户的信息，然后将网页重定向至<code>/</code>。这个 token 在<code>SideMenu</code> <code>UserList</code> <code>UserForm</code> 中被取出来，用于在前端业务逻辑中实现权限控制。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Login</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> onFinish = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(values)</span><br><span class="line"></span><br><span class="line">        axios.get(<span class="string">`/users?username=<span class="subst">$&#123;values.username&#125;</span>&amp;password=<span class="subst">$&#123;values.password&#125;</span>&amp;roleState=true&amp;_expand=role`</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.data)</span><br><span class="line">            <span class="keyword">if</span>(res.data.length===<span class="number">0</span>)&#123;</span><br><span class="line">                message.error(<span class="string">&quot;用户名或密码不匹配&quot;</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;token&quot;</span>,<span class="built_in">JSON</span>.stringify(res.data[<span class="number">0</span>]))</span><br><span class="line">                props.history.push(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>PS：补充 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/nyw1983/p/11605241.html">JSON序列化与反序列化</a></p>
<h4 id="设置全局-Axios-配置"><a href="#设置全局-Axios-配置" class="headerlink" title="设置全局 Axios 配置"></a>设置全局 Axios 配置</h4><p>在<code>/util/http.js</code>中配置 Axios。主要是默认请求URL、拦截器（后续为 Redux 所用）</p>
<h3 id="新闻业务"><a href="#新闻业务" class="headerlink" title="新闻业务"></a>新闻业务</h3><p>新闻业务的业务逻辑：</p>
<ul>
<li>后端列表<code>news</code> 业务字段</li>
</ul>
<div align="center">
  <img src="https://s2.loli.net/2022/02/16/nx5jC3M6ZRqPhLI.png" width=40%>
</div>

<ul>
<li>审核流程</li>
</ul>
<div align="center">
  <img src="https://s2.loli.net/2022/02/16/6yjGT4FLPNRhHpu.png" width=40%>
</div>

<ul>
<li>发布流程</li>
</ul>
<div align="center">
  <img src=https://s2.loli.net/2022/02/16/afYM5FwJquB6Q3s.png width=40%>
</div>

<h4 id="撰写新闻-lt-NewsAdd-gt"><a href="#撰写新闻-lt-NewsAdd-gt" class="headerlink" title="撰写新闻 &lt;/NewsAdd/&gt;"></a>撰写新闻 &lt;/NewsAdd/&gt;</h4><div align="center">
  <img src="https://s2.loli.net/2022/02/17/srl8SGRbipWNyPv.png" width=60%>
</div>

<p>思路：</p>
<ul>
<li><p>使用 Ant Design 组件：PageHeader, Steps, Button, Form，Editor等</p>
</li>
<li><p>设置一个 <code>current</code> 状态，有 0/1/2 三个状态，分别对应三个 step。根据不同状态设置该页面的不同内容。值得注意的是，不同内容的切换是通过设置组件的可见性实现，而不是直接控制组件是否存在，这样可以在切换组件后仍能保留组件中输入的内容。</p>
</li>
<li><p>编辑器 <code>Editor</code> 中的的内容需要再恰当的时机（失去焦点）发送给父组件<code>NewsAdd</code>并存放在某个状态中，并且需要做一定内容格式的转换。然后在新闻提交step下，点击提交草稿或发送审核，将带有文章内容和状态的字段发送给后端存储。</p>
</li>
</ul>
<p><strong>新闻管理、审核管理、发布管理</strong>，这三个模块的大体逻辑都类似。</p>
<p>关键就在于清楚各个模块的功能需求是什么。技术上主要关注获取/校验/编辑<code>news</code>的审核和发布状态码；再者便是在前端获取用户登录信息，以此来决定用户在这三个模块的页面的<code>Table</code>中能看到哪些文章（选择性渲染，隐藏文章路由——Table中文章的标题，是可点的连接），以及是否能够预览<code>\preview</code>和更新<code>\update</code>文章（即此前提到的NewsRouter组件，使权限不够的用户在地址栏输入路由无效）。主要就是看是否是自己的文章，以及用户是否有权限审核、下线文章。</p>
<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><p>是</p>
<h2 id="添加后端并部署上线"><a href="#添加后端并部署上线" class="headerlink" title="添加后端并部署上线"></a>添加后端并部署上线</h2><h3 id="字节跳动轻服务简介"><a href="#字节跳动轻服务简介" class="headerlink" title="字节跳动轻服务简介"></a>字节跳动轻服务简介</h3><h4 id="云工程"><a href="#云工程" class="headerlink" title="云工程"></a>云工程</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://qingfuwu.cn/docs/nodejs/cloud-project/quickstart.html">轻服务 云工程入门</a></p>
<blockquote>
<p>云工程是轻服务面向大型工程项目的解决方案，开发者在本地开发、可选择任意的 Node.js 框架、通过 Git 协作及轻松部署服务，并且仍然有开箱即用的开发体验。</p>
<p>通过轻服务提供的云工程，你可以极其方便地在本地开发完整的 Web 项目，使用轻服务开箱即用的各种功能，并通过简单易用的命令行或 Git 部署到云端。</p>
</blockquote>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://qingfuwu.cn/docs/nodejs/database/quickstart.html">轻服务 数据库入门</a></p>
<p>轻服务提供了一套简单易用的数据库功能，在云函数/云工程中，只需通过 inspirecloud.db 即可进行操作</p>
<h3 id="后台实现"><a href="#后台实现" class="headerlink" title="后台实现"></a>后台实现</h3><h2 id="项目难点"><a href="#项目难点" class="headerlink" title="项目难点"></a>项目难点</h2><p>用户管理、用户列表——添加角色 UserForm、UserList 的预设状态、和状态切换细节<br>NewsUpdate、NewsEditor 根据后台数据，显示已有的内容</p>
<p>部署上线后 NewsUpdate 写新闻，content（字段内容是一堆HTML标签）post 不上去。json-server 和 字节轻服务后台的 区别？防止 xss？——后端news模型忘记写content了。。</p>
<p>Redux 持久化</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/30/React%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/30/React%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">React笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-30 15:03:34" itemprop="dateCreated datePublished" datetime="2022-01-30T15:03:34+08:00">2022-01-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-18 11:26:53" itemprop="dateModified" datetime="2022-03-18T11:26:53+08:00">2022-03-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>学习资料：React 官方文档 + 博客</p>
<p>内容：</p>
<ul>
<li>React 基本概念和特性</li>
<li>React 高级特性</li>
<li>React 原理</li>
</ul>
<h2 id="React基础"><a href="#React基础" class="headerlink" title="React基础"></a>React基础</h2><p>2021.11.29 - 2021.12.08 </p>
<h3 id="官方入门教程——一个井字棋游戏"><a href="#官方入门教程——一个井字棋游戏" class="headerlink" title="官方入门教程——一个井字棋游戏"></a>官方入门教程——一个井字棋游戏</h3><p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html">官方入门教程</a></p>
<p>利用 React.js 开发了一个简单的 Web井字棋小游戏。初步了解的 React 的特性</p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p>组件类、组件参数 <code>props</code>、<code>render()</code>方法-返回React元素/像XML的JSX特殊语法、组件的嵌套、组件的“记忆功能”——state属性、组件的自动更新——组件 <code>setState</code> 被调用，该组件会自动更新/再次 render</p>
<h4 id="受控组件和函数式组件"><a href="#受控组件和函数式组件" class="headerlink" title="受控组件和函数式组件"></a>受控组件和函数式组件</h4><p>当你遇到需要同时获取多个子组件数据，或者两个组件之间需要相互通讯的情况时，需要把子组件的 state 数据提升至其共同的父组件当中保存。之后父组件可以将状态数据传递到子组件的 <code>props</code> 当中。这样应用当中所有组件的状态数据就能够更方便地同步共享了</p>
<p>受控组件没有自己的 <code>state</code>，根据 JS 作用域原则，它可以访问父组件的变量和调用父组件的函数，以此在父组件中更新自身相关的状态。这种组件可以从类退化成函数</p>
<h4 id="React-基本作用流程"><a href="#React-基本作用流程" class="headerlink" title="React 基本作用流程"></a>React 基本作用流程</h4><p>在不考虑历史记录的情况下，总结来说：初始化时由父 <code>Board</code>到子 <code>Square</code> render 出界面（创建React元素，包括内容和属性，事件处理函数）；然后子组件触发事件，改变父组件状态（它也存储着子组件的状态，所谓子组件的状态“提升”），进而父组件 <code>Board</code> 重新 render，进而导致<strong>所有</strong>子组件 <code>Square</code> 重新 render（即创建一个新的React元素，其内容和属性，包括其绑定的事件处理函数都重新绑定），最终完成更新。此处要注意，组件点击事件的回调函数，其定义的参数指代的是square组件状态提升后的在父组件 <code>state.squares</code> 中对应的编号</p>
<div align="center">
<img src="https://i.loli.net/2021/11/30/scS35UokVw8XIQT.jpg" width="50%">
</div>

<p><strong>PS:</strong> 要意识到，事件处理函数是在父组件中定义的，处理的是父组件的 <code>state</code> 属性，但由子组件来调用。而且给某子组件绑定处理函数的时候是以该子组件的索引为参数的，即绑定关系为：父 <code>state</code> 反映子组件状态的某个量-指定参数的事件处理函数-子组件索引</p>
<ul>
<li>关于事件处理函数的理解</li>
</ul>
<p>直观理解就是 <code>handle(i)</code> 就是处理父组件 <code>Board</code> 属性 <code>state.squares</code> 中的第 i 位数，自然要绑定给第i个 <code>square</code> 子组件。若进一步考虑时间旅行的功能，状态进一步提升到 <code>Game</code> 组件中，<code>handle(i)</code> 定义在 <code>Game</code>，处理 <code>Game</code> 的 <code>state</code>，我们来观察 <code>handle(i)</code> 的传递/注册。<code>Game</code> 向下传递的是参数未确定的 handdle，<code>Board</code> 向下传递的是确定了参数的 handle，最终 <code>Square</code> 中的 button 绑定的是确定参数的 handle</p>
<p>上层组件的 <code>OnClick</code> 仅用于传递回调函数，最终事件触发的事件处理函数仅绑定在最底层的组件 <code>Button</code> 上——<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/lifting-state-up.html">文档-状态提升</a> 提到，“自定义组件中的 temperature 和 onTemperatureChange 这两个 prop 的命名没有任何特殊含义。我们可以给它们取其它任意的名字”。此外，事件处理函数/回调的函数，调用的时候参数一定是确定的。就算有参数，也是调用时隐式传入的参数，比如 event 和 解决的 promise</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">--- Game ---</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Board</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    <span class="attr">squares</span>=<span class="string">&#123;current.squares&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    // <span class="attr">Look</span> <span class="attr">at</span> <span class="attr">Me</span>，带参数的函数；函数是当作参数传下去的</span></span></span><br><span class="line"><span class="tag"><span class="xml">    // 和 <span class="attr">onClick</span>=<span class="string">this.handleClick</span> 有何区别，为了不可变性特地定义一个新的函数？</span></span></span><br><span class="line"><span class="tag"><span class="xml">    // 官方文档<span class="attr">-</span>事件处理：这是为了确保 <span class="attr">handleClick</span> 内的 <span class="attr">this</span> 被绑定</span></span></span><br><span class="line"><span class="tag"><span class="xml">    <span class="attr">onClick</span>=<span class="string">&#123;(i)</span> =&gt;</span> this.handleClick(i)&#125; </span></span><br><span class="line"><span class="xml">  /&gt;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">……</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">--- Board ---</span></span><br><span class="line"><span class="xml">renderSquare(i) &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Square</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    <span class="attr">value</span>=<span class="string">&#123;this.props.squares[i]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    // <span class="attr">Look</span> <span class="attr">at</span> <span class="attr">Me</span>，不带参数的函数，或者说参数已确定；函数是当作参数传下去的</span></span></span><br><span class="line"><span class="tag"><span class="xml">    // 官方文档<span class="attr">-</span>事件处理<span class="attr">-</span>向事件处理程序传递参数</span></span></span><br><span class="line"><span class="tag"><span class="xml">    // 对于回调函数来说，<span class="attr">i</span>是确定的值，不是参数的</span></span></span><br><span class="line"><span class="tag"><span class="xml">    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.props.onClick(i)&#125; </span></span><br><span class="line"><span class="xml">  /&gt;</span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">return (</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;status&quot;</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(0)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">    &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">--- Square ---</span></span><br><span class="line"><span class="xml">function Square(props) &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line"><span class="xml">    // Look at Me，不带参数的函数；这里的参数才是真正的事件处理函数</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onClick&#125;</span>&gt;</span> </span></span><br><span class="line"><span class="xml">    &#123;props.value&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="官方文档-核心概念"><a href="#官方文档-核心概念" class="headerlink" title="官方文档 核心概念"></a>官方文档 核心概念</h3><p><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/introducing-jsx.html">官方文档——核心概念</a></p>
<h4 id="元素渲染"><a href="#元素渲染" class="headerlink" title="元素渲染"></a>元素渲染</h4><p>“React 元素是不可变对象，（目前）更新 UI 的唯一方式是创建一个全新的元素，并将其传入。尽管每一秒我们都会新建一个描述整个 UI 树的元素，React DOM 只会更新实际改变了的内容”</p>
<p>PS：React元素（对象）是新的，render 的对象是新的，如何实现局部更新？优化的原理是？可能需要看 render 的实现。—— 详见 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/faq-internals.html#gatsby-focus-wrapper">虚拟DOM</a> 和 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/reconciliation.html">Diff算法</a>，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wy4y1D7JT?p=48">DOM的diff算法 尚硅谷</a></p>
<h4 id="组件-amp-Props"><a href="#组件-amp-Props" class="headerlink" title="组件 &amp; Props"></a>组件 &amp; Props</h4><p>“组件，<strong>从概念上</strong>类似于 JavaScript 函数。它接受任意的入参（即 “props”），并返回用于描述页面展示内容的 React 元素。”</p>
<h4 id="State-amp-生命周期"><a href="#State-amp-生命周期" class="headerlink" title="State &amp; 生命周期"></a>State &amp; 生命周期</h4><p>在此之前，我们只了解了一种更新 UI 界面的方法。通过调用 <code>ReactDOM.render()</code> 来修改我们想要渲染的元素。也即人为地从外部传入不同的 <code>props</code> 参数创建一个新的 React元素/组件，再重新手动 render 它。</p>
<p>以 <code>Clock</code> 组件为例，我们希望从概念上来说，它自身就带有变更状态/更新 UI 界面——也即跳时间，的功能。于是就有了 <code>state</code> 属性。</p>
<p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/state-and-lifecycle.html#state-updates-may-be-asynchronous">官方文档</a>中提到，setState 的更新可能是异步的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong</span></span><br><span class="line"><span class="comment">// 这样在同步代码中调用 setState，在异步执行 setState 的时候 </span></span><br><span class="line"><span class="comment">// this.state.counter、this.props.increment 会是在同步代码中</span></span><br><span class="line"><span class="comment">// 调用 setState 那一时刻的它们的值</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="built_in">this</span>.state.counter + <span class="built_in">this</span>.props.increment,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Correct</span></span><br><span class="line"><span class="comment">// 这样，在异步执行 setState 的时候</span></span><br><span class="line"><span class="comment">// 此回调函数会获取异步执行时的 state 和 props</span></span><br><span class="line"><span class="built_in">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">counter</span>: state.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>PS：可以联想一下：原生JS中，我们是如何实现动作—&gt;重新渲染的？其实就是事件处理函数进行了DOM操作，DOM更新完成后，然后浏览器就重新渲染了。</p>
<p><strong>补充：</strong></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/faq-state.html#why-is-setstate-giving-me-the-wrong-value">官方文档：更多有关 setState 的异步</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/optimizing-performance.html#the-power-of-not-mutating-data">官方文档：setState 和 不可变对象</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903715921477640">setState异步、同步与进阶</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903636749778958">你真的理解setState吗？（硬核，从原理上和setTimeout对比）</a></p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">incrementCount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 注意：这样 *不会* 像预期的那样工作。</span></span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">handleSomething</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 假设 `this.state.count` 从 0 开始。</span></span><br><span class="line">  <span class="built_in">this</span>.incrementCount();</span><br><span class="line">  <span class="built_in">this</span>.incrementCount();</span><br><span class="line">  <span class="built_in">this</span>.incrementCount();</span><br><span class="line">  <span class="comment">// 如果你现在在这里读取 `this.state.count`，它还是会为 0。</span></span><br><span class="line">  <span class="comment">// 当 React 重新渲染该组件时，`this.state.count` 会变为 1，而不是你期望的 3。</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这是因为上面的 `incrementCount()` 函数是从 `this.state.count` 中读取数据的，</span></span><br><span class="line">  <span class="comment">// 但是 React 不会更新 `this.state.count`，直到该组件被重新渲染。</span></span><br><span class="line">  <span class="comment">// 所以最终 `incrementCount()` 每次读取 `this.state.count` 的值都是 0，并将它设为 1。</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>setState</code>的<strong>异步</strong>只能能解释我们同步读取<code>state</code>得到的值是<code>0</code><br>但不能解释为什么：传对象时，<code>setState</code>读的是同步调用它时候的参数值；传函数时<code>setState</code>读的是异步执行时候的参数值；</p>
<p>“React 其实会维护着一个 state 的更新队列，每次调用 setState 都会先把当前修改的 state 推进这个队列，在最后，React 会对这个队列进行<strong>合并处理</strong>，然后去执行回调。根据最终的合并结果再去走下面的流程（更新虚拟dom，触发渲染）”——这句话应该能解释这个情况</p>
<p>此外，很容易联想到<code>setTimeout</code>的行为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">6</span>; i++)&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出 6</span></span><br><span class="line"><span class="comment">// 也即，读取的参数是异步执行时的值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;i++&#125;,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;i++&#125;,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;<span class="built_in">console</span>.log(i)&#125;,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制台输出 2</span></span><br><span class="line"><span class="comment">// 也即不存在合并行为</span></span><br></pre></td></tr></table></figure>

<h4 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h4><p>关于回调函数的 this 指针的绑定。根据红宝书中类章节的知识，class 中直接定义的函数是定义在类的原型上的。以下构造函数中的绑定语句应该是初始化一个实例方法，等号前面是自己的实例化方法，后面是访问原型方法</p>
<p>PS：等号后面，为什么不直接将 <code>this.handleClick</code> 写成 <code>handleClick</code>？因为实例访问原型方法，也是需要通过<code>this</code>来访问的（this访问后发现实例中没有此方法，就会沿着原型链找到原型中的方法）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toggle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;<span class="attr">isToggleOn</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了在回调中使用 `this`，这个绑定是必不可少的</span></span><br><span class="line">    <span class="built_in">this</span>.handleClick = <span class="built_in">this</span>.handleClick.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">isToggleOn</span>: !prevState.isToggleOn</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;this.state.isToggleOn ? &#x27;ON&#x27; : &#x27;OFF&#x27;&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不绑定的写法</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 此语法确保 `handleClick` 内的 `this` 已被绑定。</span></span><br><span class="line">  <span class="comment">// 注意: 这是 *实验性* 语法。</span></span><br><span class="line">  handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;this is:&#x27;</span>, <span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      Click me</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;this is:&#x27;</span>, <span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 此语法确保 `handleClick` 内的 `this` 已被绑定。</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.handleClick()&#125;&gt;</span></span><br><span class="line"><span class="xml">        Click me</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="状态提升"><a href="#状态提升" class="headerlink" title="状态提升"></a>状态提升</h4><p>状态提升的基本模式和工作流程在此前的入门教程中总结过，此处来讲讲该以怎样的思路来编写存在状态提升的组件。</p>
<p>基本上分为两块</p>
<ul>
<li>组件的某个“状态”：父组件的 state 需要保存什么信息（思考子组件们应该有哪些状态，哪些状态需要提升）；子组件需要什么信息，其 props 传入什么参数，实例化时是手动设置还是基于父组件的 state。即，我如何渲染出某一个状态？</li>
<li>事件发生导致的状态“改变”：父组件中需针对不同的子组件设置对应的事件处理函数——如何在父组件的状态中反映出来“是<strong>我</strong>发生了事件”，进而进一步确定父组件的 state 设置；子组件状态未提升的时候，其控件发生事件后需要修改自身的什么内容？——将此内容对标到提升后的父组件的 state 中。即，发生事件时我要怎么变更状态？以及如何实现？</li>
</ul>
<p>此外，关于事件参数e，它应该保留在事件target的控件的组件中处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TemperatureInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(props);</span><br><span class="line">  <span class="built_in">this</span>.handleChange = <span class="built_in">this</span>.handleChange.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接受事件e参数的相应函数，保持在包含 target 控件的组件中定义</span></span><br><span class="line">  <span class="comment">// 其父组件传入的处理函数，仅考虑如何处理发生事件的值</span></span><br><span class="line">  <span class="function"><span class="title">handleChange</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.onTemperatureChange(e.target.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> temperature = <span class="built_in">this</span>.props.temperature;</span><br><span class="line">    <span class="keyword">const</span> scale = <span class="built_in">this</span>.props.scale;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Enter temperature in &#123;scaleNames[scale]&#125;:<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;temperature&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.handleCelsiusChange = <span class="built_in">this</span>.handleCelsiusChange.bind(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">this</span>.handleFahrenheitChange = <span class="built_in">this</span>.handleFahrenheitChange.bind(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;<span class="attr">temperature</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">scale</span>: <span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleCelsiusChange</span>(<span class="params">temperature</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;<span class="attr">scale</span>: <span class="string">&#x27;c&#x27;</span>, temperature&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleFahrenheitChange</span>(<span class="params">temperature</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;<span class="attr">scale</span>: <span class="string">&#x27;f&#x27;</span>, temperature&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> scale = <span class="built_in">this</span>.state.scale;</span><br><span class="line">    <span class="keyword">const</span> temperature = <span class="built_in">this</span>.state.temperature;</span><br><span class="line">    <span class="keyword">const</span> celsius = scale === <span class="string">&#x27;f&#x27;</span> ? tryConvert(temperature, toCelsius) : temperature;</span><br><span class="line">    <span class="keyword">const</span> fahrenheit = scale === <span class="string">&#x27;c&#x27;</span> ? tryConvert(temperature, toFahrenheit) : temperature;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">TemperatureInput</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">scale</span>=<span class="string">&quot;c&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">temperature</span>=<span class="string">&#123;celsius&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">onTemperatureChange</span>=<span class="string">&#123;this.handleCelsiusChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">TemperatureInput</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">scale</span>=<span class="string">&quot;f&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">temperature</span>=<span class="string">&#123;fahrenheit&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">onTemperatureChange</span>=<span class="string">&#123;this.handleFahrenheitChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">BoilingVerdict</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">celsius</span>=<span class="string">&#123;parseFloat(celsius)&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="React-哲学-小项目实践"><a href="#React-哲学-小项目实践" class="headerlink" title="React 哲学 + 小项目实践"></a>React 哲学 + 小项目实践</h4><p>本章讲解了实际开发中，我们如何利用 React 从产品的设计稿（界面和交互效果）和已有的数据（比如一个返回JSON的API）来实现我们的产品应用界面。然后给了我们一个小项目进行实践。</p>
<ul>
<li><p>第一步：将设计好的 UI 划分为组件层级</p>
<p>之前的教学都是直接告诉我们有哪些组件，每个组件的功能是什么。这一步更加贴近真实开发的情况。<br>但如何确定应该将哪些部分划分到一个组件中呢？你可以将组件当作一种函数或者是对象来考虑，根据单一功能原则来判定组件的范围。</p>
</li>
<li><p>第二步：用 React 创建一个静态版本</p>
<p>到这一步，我们清楚了我们要实现什么，且划分好了组件，接下来就是如何实现的问题。我们在上一节中总结的“状态”和“改变状态”大致符合 React 哲学。“状态”即产品的静态版本，“改变状态”即添加反向数据流（设置回调函数处理事件）（即添加动态/交互）。当然 React 哲学更加科学，它将添加 state 单独拎出来讨论并充分考虑其交互性（它的存在基本就是为了交互）；不像我们，想要在实现静态版本的同时也把 state 给拎清楚（可能熟练后能做到吧）。</p>
<p>这一步有点类似于传统前端中 HTML+CSS 确定好静态界面，然后再考虑交互。</p>
</li>
<li><p>第三步：确定 UI state 的最小（且完整）表示</p>
</li>
<li><p>第四步：确定 state 放置的位置</p>
</li>
<li><p>第五步：添加反向数据流</p>
</li>
</ul>
<p>详细的笔记见 <a href="">React 组件设计</a></p>
<h2 id="React-高阶指引"><a href="#React-高阶指引" class="headerlink" title="React 高阶指引"></a>React 高阶指引</h2><p><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/accessibility.html">官方文档——高阶指引</a></p>
<p>在通常情况下，我们就是在抽象的、逻辑的层面，从流程上，来<strong>理解和使用 React 的各种特性</strong>。比如 ReactDom.render 就是将组件对应的 DOM 挂载到 html 根节点上、组件就是一个返回一定UI元素的封装-它先初步挂载渲染+更新后渲染，组件 render 就是它所对应显示的内容等，可以先不管它们具体底层是怎么实现的。</p>
<p>但要知道，最终 React 项目也都是要归为 html、css、js，在浏览器上运行。所以，适当从浏览器的运行原理的层次、从 React 的底层设计和实现（原生JS，毕竟React本身只是一个JS库） 来思考 React 运作也是必要的。但也要注意下潜到什么层次。至于后者，React 概念、特性、使用、效果（命令式编程） —&gt; React 底层的逻辑、工作流程/数据流、其设计的类和函数的作用概括、和浏览器的配合等 —&gt; React JS 源码、最细节的代码实现。目前来说，看到第二层就好。</p>
<p>高阶指引，不仅给我们介绍了更多 React 的特性，也进一步地讲解了 <strong>React 的底层原理</strong>。</p>
<blockquote>
<p>根据牛客网的前端实习面经<a target="_blank" rel="noopener" href="https://www.nowcoder.com/discuss/647892?type=post&order=recall&pos=&page=1&ncTraceId=&channel=-1&source_id=search_post_nctrack&gio_id=CFBB6E205C1C9D6CB464B7DB3DFAE9EB-1640004306851">1</a>、<a target="_blank" rel="noopener" href="https://www.nowcoder.com/discuss/373429?type=post&order=recall&pos=&page=1&ncTraceId=&channel=-1&source_id=search_post_nctrack&gio_id=CFBB6E205C1C9D6CB464B7DB3DFAE9EB-1640004073735">2</a>、<a target="_blank" rel="noopener" href="https://www.nowcoder.com/discuss/600596?type=post&order=recall&pos=&page=1&ncTraceId=&channel=-1&source_id=search_post_nctrack&gio_id=CFBB6E205C1C9D6CB464B7DB3DFAE9EB-1640004306851">3</a>，有些大厂面试官喜欢问 React 的原理和细节（特别是在介绍项目亮点时，所以可以想想如何妥善利用 React 的各种特性。webpack、antd之类的也类似，项目特别提及了，就最好详细学习）</p>
</blockquote>
<h3 id="React-高级概念"><a href="#React-高级概念" class="headerlink" title="React 高级概念"></a>React 高级概念</h3><p>按照以下模块来思考<code>React 高级概念</code>和<code>Hook</code></p>
<ul>
<li>设计动机/应用场景 + 此前方法的缺点</li>
<li>基本使用方法</li>
<li>注意事项/使用原则</li>
</ul>
<h4 id="高阶组件-HOC"><a href="#高阶组件-HOC" class="headerlink" title="高阶组件 HOC"></a>高阶组件 HOC</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/higher-order-components.html">HOC</a></p>
<p>高阶组件是参数为组件，返回值为新组件的函数</p>
<p>HOC 不会修改传入的组件，也不会使用继承来复制其行为。相反，HOC 通过将组件包装在容器组件中来组成新组件。HOC 是纯函数，没有副作用</p>
<p>被包装组件的一些共用逻辑会被抽离到用于包装的父组件中：比如 订阅模式下 生命周期函数、状态及其更新状态的处理函数。让父组件中完成这些逻辑，被包装组件只需通过<code>props</code>从父组件中拿到这些数据并渲染即可</p>
<h4 id="Render-Props"><a href="#Render-Props" class="headerlink" title="Render Props"></a>Render Props</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/render-props.html">Render Props</a>  </p>
<h4 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/context.html">Context</a></p>
<h4 id="refs-和-DOM"><a href="#refs-和-DOM" class="headerlink" title="refs 和 DOM"></a>refs 和 DOM</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">Refs and the DOM</a></p>
<blockquote>
<p>Refs 提供了一种方式，允许我们访问 DOM 节点或在 render 方法中创建的 React 元素。</p>
<p>在典型的 React 数据流中，props 是父组件与子组件交互的唯一方式。要修改一个子组件，你需要使用新的 props 来重新渲染它。但是，在某些情况下，你需要在典型数据流之外强制修改子组件。被修改的子组件可能是一个 React 组件的实例，也可能是一个 DOM 元素。对于这两种情况，React 都提供了解决办法。</p>
</blockquote>
<p>或者有时候可能父组件想要获取子组件的信息（也属于父子组件通信范畴），比如表单或者评论输入框，用户输入了一定的内容后，在某个事件发生时（如点击submit）它们父组件想获取它们中的信息。</p>
<p>补充：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Q64y1c7nt?spm_id_from=333.337.search-card.all.click">【 ref用法 和使用场景 B站视频】</a></p>
<blockquote>
<p>React 会在组件挂载时给 current 属性传入 DOM 元素，并在组件卸载时传入 null 值。ref 会在 componentDidMount 或 componentDidUpdate 生命周期钩子触发前更新。</p>
</blockquote>
<ul>
<li>问题一</li>
</ul>
<p>关于<code>ref</code>的更新 和 <code>ref</code>代表元素的内容改变（比如表单的内容）是一回事吗？</p>
<p>React <code>ref</code> 直接对应的是元素对象，而不是元素内容，所谓<code>ref</code>更新应该指的是它更新指向的元素对象。所以ref元素内容的变化并不对应<code>ref</code>的更新</p>
<ul>
<li>问题二</li>
</ul>
<p>表单之类的元素，其内容变化时，<code>ref</code>如何跟进-能保持获取元素的最新内容？或者说：<code>ref</code>如何融入 React 生命周期？用户更新 DOM 表单，是否在 React 生命周期中有对应环节？</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/cuggz/interview/pgw8v4#29910abcd3bdd1e6cdb330333cfc968a">React中什么是受控组件和非控组件？</a> 中提到了一个概念：受控组件消除了组件的 <strong>局部状态</strong>。也许 <code>ref</code>对应元素的 “局部状态” 就是没有设计进生命周期？</p>
<p>补充 <a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#useref">useRef</a></p>
<blockquote>
<p>请记住，当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。</p>
</blockquote>
<h4 id="非受控组件"><a href="#非受控组件" class="headerlink" title="非受控组件"></a>非受控组件</h4><p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/uncontrolled-components.html">非受控组件</a></p>
<p>在大多数情况下，我们推荐使用 受控组件 来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/optimizing-performance.html#avoid-reconciliation">性能优化</a></p>
<ul>
<li>调停</li>
<li>不可变数据</li>
</ul>
<p><strong>不可变性</strong>：即不直接修改组件的 state 对象，而是拷贝、修改、重新给对象（即换个新的对象）。<strong>好处：</strong> 简化复杂的功能、跟踪数据的改变、确定 React 中何时重新渲染。</p>
<h3 id="React-Hook"><a href="#React-Hook" class="headerlink" title="React Hook"></a>React Hook</h3><p>参考资料：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-intro.html">Hook</a></p>
<p>Hook 使你在非 class 的情况下可以使用更多的 React 特性。 从概念上讲，React 组件一直更像是函数。而 Hook 则拥抱了函数，同时也没有牺牲 React 的精神原则。</p>
<p><strong>为什么要叫 Hook ？</strong></p>
<ul>
<li>Hook 是一些可以让你在函数组件里“钩入” React state 及生命周期等特性的函数。这使得你不使用 class 也能使用 React。—— <a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-overview.html#but-what-is-a-hook">那么，什么是 Hook?</a></li>
<li>React Hooks 的意思是，组件尽量写成纯函数，如果需要外部功能和副作用，就用钩子把外部代码”钩”进来。 React Hooks 就是那些钩子。—— <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/09/react-hooks.html">React Hooks 入门教程</a></li>
</ul>
<p>学习资料：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903709927800846">30分钟精通 React Hooks</a></p>
<p>深入熟练：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903985338400782">React Hooks 详解 【近 1W 字】+ 项目实战</a></p>
<h4 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h4><p>当我们想在两个函数之间共享逻辑时，我们会把它提取到第三个函数中。而组件和 Hook 都是函数，所以也同样适用这种方式。自定义 Hook 是一个函数，其名称以 “use” 开头，函数内部可以调用其他的 Hook。</p>
<p>要理解自定义 Hook 有什么用，有什么特性/效果，首先要理解什么是 Hook。（看之前的介绍）</p>
<p>可以理解为，自定义 Hook 就是封装了 useState、useEffect和一些逻辑+数据的 函数，它也是用来给我们的函数组件添加状态、生命周期等特性，但是对它们进行了一定的逻辑处理和封装。从各种方面来说，它就像一个正常的函数。（我们不要忘了一些普遍适用的规则）</p>
<h4 id="Hook-原理"><a href="#Hook-原理" class="headerlink" title="Hook 原理"></a>Hook 原理</h4><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6891577820821061646">React Hooks原理探究，看完不懂，你打我</a></p>
<h3 id="React-原理"><a href="#React-原理" class="headerlink" title="React 原理"></a>React 原理</h3><h4 id="React-组件的生命周期"><a href="#React-组件的生命周期" class="headerlink" title="React 组件的生命周期"></a>React 组件的生命周期</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/514fe21b9914">React 组件的生命周期</a></p>
<p>深入了解组件的生命周期，能让我们初探 React 的底层原理。</p>
<div align="center">
<img src="https://s2.loli.net/2021/12/15/iAR38QusWFhLeqm.png" width="80%">
</div>

<p>后面将详细介绍 组件生命周期 中的流程细节。此图反映单个组件的生命周期，不反映父子/嵌套组件的关系（即某个组件整体，不考虑其内部细节）。</p>
<h4 id="虚拟DOM-和-Diff算法"><a href="#虚拟DOM-和-Diff算法" class="headerlink" title="虚拟DOM 和 Diff算法"></a>虚拟DOM 和 Diff算法</h4><p><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/faq-internals.html#gatsby-focus-wrapper">虚拟DOM</a> 和 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/reconciliation.html">Diff算法</a></p>
<p>这一小节相当于是对 组件生命周期 的 <code>render 阶段</code> - 构建虚拟DOM + diffing 比较、<code>commit 阶段</code> - diffing patch 以及 后续的浏览器渲染 的细节补充。</p>
<p><strong>虚拟 DOM (VDOM) 的动机</strong></p>
<p>首先我们要知道，为什么我们没办法直接知道增量的 DOM操作 呢？直接知道的话，就按增量去操作 真实DOM 不就好了？——问题就在于现实应用情况中我们无法直接获知，或者这种直接增量 操作DOM 不便于我们编程思考。比如 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wy4y1D7JT?p=1">虚拟DOM 尚硅谷</a> 中展示的，我们经常获取的是全新的 json 数据；比如，我们组件更新时，是 <code>render()</code> 返回一整块<code>React元素</code>的可能仅局部更新了的 React 元素。在下图的情况中，若没有 虚拟 DOM，我们就得重新再对新的列表中的三个表项各进行一次 DOM操作 即 3次 JS操作真实DOM；而有 虚拟 DOM 的话，我们就只需要有 1次 JS操作真实DOM。</p>
<div align="center">
<img src="https://s2.loli.net/2021/12/17/nMtNYKIyBv7HbO2.png" width="60%">
</div>

<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9f16b96a2dec">深入理解react中的虚拟DOM、diff算法</a> 这篇博客认为，使用 VDOM 减少了 <strong>js操作真实DOM</strong> 的次数（在只有局部 UI 需要发生改变时），而 <strong>js操作DOM</strong> 本身（暂时不考虑渲染）就是代价非常大的操作，因此 VDOM 起到了优化效果。</p>
<blockquote>
<p>这个元素会挂载默认的styles、得到这个元素的computed属性、注册相应的Event Listener、DOM Breakpoints以及大量的properties，这些属性、方法的注册肯定是需要h耗费大量时间的。<br>尤其是在 <strong>js操作DOM</strong> 的过程中，不仅有dom本身的繁重，js的操作也需要浪费时间，我们认为js和DOM之间有一座桥，如果你频繁的在桥两边走动，显然效率是很低的，如果你的JavaScript操作DOM的方式还非常不合理，那么显然就会更糟糕了。<br>而 React 的虚拟DOM就是解决这个问题的！ 虽然它解决不了DOM自身的繁重，但是虚拟DOM可以对JavaScript操作DOM这一部分内容进行优化。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994959998283907102">15张图，20分钟吃透Diff算法核心原理</a> 除了更少地 <strong>js操作DOM</strong>，在浏览器渲染的角度是否也有优化？该博客下面的评论中讨论了这个问题。有人认为一次 真实DOM操作 就会导致一次浏览器回流（即重新渲染一次DOM，是对全部DOM还是局部DOM重新渲染，得看具体浏览器的实现，暂时不确定），那么减少了 <strong>js操作真实DOM</strong> 的次数，也减少了渲染的成本；但也有人说浏览器会“攒”一定数量的 真实DOM操作 再进行渲染。<mark>这一块不是很清楚。——浏览器针对回流与重绘进行了自身的优化：渲染队列，就是会定期积攒一定时间段的回流重绘操作，然后一波处理。但需要注意的是，操作DOM和回流重绘并非严格的一一对应，即便是将密集的的DOM操作打包在一起仅进行一次回流重绘，但实际上DOM操作可能还是进行了那么多次；亦或DOM操作的代价在于获取DOM而不在修改DOM？。（不确定，待核实）</mark></p>
<h4 id="React-的-渲染流程细节（初步探讨）"><a href="#React-的-渲染流程细节（初步探讨）" class="headerlink" title="React 的 渲染流程细节（初步探讨）"></a>React 的 渲染流程细节（初步探讨）</h4><p><mark>可以确定的是：</mark><br>VDOM 的本质就是一个数据结构与 DOM 一一对应的 JS 对象。如果是首次渲染，我们先得到 VDOM，然后 基于 VDOM 将内容转化成 真实DOM，然后渲染；当我们的 UI-View 需要发生改变（更新）时，我们先构建一个新的 VDOM ——这个“简单”易操作的 JS 对象——这一步代价比较小，然后将新的到的 VDOM 与 之前的 VDOM 进行比较，得出差异，然后对 真实DOM 进行增量操作。</p>
<p>React 的渲染可分为<strong>两种情况</strong>：首次渲染 和 更新渲染，分别对应组件生命周期 挂载时 和 更新时。</p>
<p>结合上上一小节的生命周期，总结：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">需要渲染时：ReactDOM.render() or setState()</span><br><span class="line">⬇</span><br><span class="line">构建 VDOM：上小节 render() 方法 + JSX 语法编译后的相关方法（但更新时如何得到完整的 VDOM 还不是很清楚）</span><br><span class="line">⬇（更新）                             ⬇（首次渲染）</span><br><span class="line">比较 VDOM：Diffing 算法 - 比较         操作真 DOM</span><br><span class="line">⬇                                    ⬇</span><br><span class="line">操作 真DOM：Diffing 算法 - patch       渲染</span><br><span class="line">⬇</span><br><span class="line">渲染：浏览器 非 JS 的工作</span><br></pre></td></tr></table></figure>

<div align="center">
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c57a7b4e91a4a359474fb4c281f6d8e~tplv-k3u1fbpfcp-watermark.awebp" width="80%">
</div>

<p><mark>不确定的是:</mark><br>DOM 的渲染 具体发生了什么，React 完整细节的 更新、渲染流程 为何？组件状态更新时，是重新构造一棵完整的（整个应用的） VDOM 树吗？diffing 算法 比较的是两颗完整的 VDOM 树吗？</p>
<p>要弄清楚渲染细节，主要需要学习：JSX React元素 转译结果、<code>ReactDOM.render()</code>  方法的原理、组件内部定义的<code>render()</code>。</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/react-dom.html#render">ReactDOM API 官方文档</a>、<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8dc8e59844c9">react渲染原理分析（侧重 ReactDOM.render 生成 fiber-tree）</a>、<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/45091185">React渲染原理（侧重 ReactDOM.render 遍历组件的过程）</a></p>
<ul>
<li><p><code>ReactDOM.render()</code> 和 <code>render()</code> 是什么关系？<code>ReactDOM.render()</code>的原理？</p>
<p>生命周期图中的各组件的挂载时，各组件的 <code>render()</code> 应该是在 <code>ReactDOM.render()</code> 中被一一调用；那更新时，是否也意味着再次调用 <code>ReactDOM.render()</code> ——就算是，行为也不一样，详见补充的两个链接——“当首次调用时，容器节点里的所有 DOM 元素都会被替换，后续的调用则会使用 React 的 DOM 差分算法（DOM diffing algorithm）进行高效的更新。来自 <code>ReactDOM.render()</code> 官方文档” 。</p>
<p><code>Component</code> 中定义的 <code>render()</code>，也即生命周期中的 <code>render()</code>，仅返回 React 元素对象（实质上是调用了内置方法，构建了 Virtual DOM 的一部分）。<code>ReactDOM.render()</code>则负责更多的事情，其行为根据 挂载时 和 更新时 进行区分。比如，它在挂载时以递归的方式不断调用组件（树状结构）的render，得到 VDOM碎片 然后依次转换成 真实DOM；在更新时，构建 VDOM，Diff 比较，更新 真实DOM。</p>
</li>
<li><p>挂载时，零碎的 组件render 如何生成完整的 VDOM 树？更新时，会生成一颗新的完整的 VDOM 树吗？（也即diff比较的是完整的 VDOM 树还是不完整的？）更新时，<code>ReactDOM.render()</code>的行为如何？</p>
<p>部分组件更新时（以变动 State 的组件为节点，逻辑上会向下传播得到一个更新的子树），我们得到的 Virtual DOM 是完整的还是仅覆盖状态变更的组件的？——可以确定的是仅满足生命周期图中的三个条件的组件才会按生命周期往下走，进而调用 <code>render()</code>——<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/rendering-elements.html">官方文档 元素渲染</a> 中最后说道：“尽管每一秒我们都会新建一个描述整个 UI 树的元素，React DOM 只会更新实际改变了的内容，也就是例子中的文本节点。”</p>
</li>
<li><p>React的在浏览器下的渲染时机</p>
<p>好奇的一点是，render 构建出最终的 DOM 后，（在浏览器运行视角）渲染进程的主进程的控制权是否需要从 运行js 交由 渲染DOM（估计是的），具体的流程是怎样的（类似的问题 在浏览器原理部分提到过 <a href="###%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86">原生 JS 写DOM</a>）。</p>
<p>详细的得看更大的 <a target="_blank" rel="noopener" href="http://www.ayqy.net/blog/dive-into-react-fiber/">React Fiber</a>。</p>
</li>
</ul>
<p><strong>我们平常使用 React 可以这样偷懒地想</strong>，部分的组件更新，React 只会局部更新 DOM 并重新渲染。</p>
<h4 id="React-的事件机制"><a href="#React-的事件机制" class="headerlink" title="React 的事件机制"></a>React 的事件机制</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/21/%E5%89%8D%E7%AB%AF-%E7%9F%A5%E8%AF%86%E7%82%B9%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/%E5%89%8D%E7%AB%AF-%E7%9F%A5%E8%AF%86%E7%82%B9%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">前端-知识点笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-21 15:03:34" itemprop="dateCreated datePublished" datetime="2021-12-21T15:03:34+08:00">2021-12-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-18 19:42:12" itemprop="dateModified" datetime="2022-03-18T19:42:12+08:00">2022-03-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><p><a target="_blank" rel="noopener" href="https://www.yuque.com/cuggz/interview">前端面试题汇总</a></p>
<h2 id="前端知识之HTML篇"><a href="#前端知识之HTML篇" class="headerlink" title="前端知识之HTML篇"></a>前端知识之HTML篇</h2><p>2021.12.15 - 2021.27</p>
<table>
<thead>
<tr>
<th>题号</th>
<th>补充</th>
</tr>
</thead>
<tbody><tr>
<td>7</td>
<td><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903922109267976">响应式图片之 srcset &amp; sizes 详讲</a></td>
</tr>
<tr>
<td>9</td>
<td>替换：红宝书 P841 小结 + 红宝书 P792 工作者线程类型简介<br>一般来说，每个页面都对应一个浏览器渲染进程，该页面中的常规js脚本（script标签中的）会在渲染进程的主线程中执行。在常规js脚本的执行过程中，用户界面是阻塞的。而<strong>工作者线程</strong>是在浏览器后台单独开设的进程或线程，它独立于渲染进程的主线程运行，不会阻塞用户界面。这非常适合复杂计算和数据处理，特别是需要花较长时间因而会影响用户使用网页的处理任务。工作者线程有自己独立的环境，只能通过异步消息与外界通信。</td>
</tr>
<tr>
<td>14</td>
<td>替代：label标签通常用作某个表单控件的说明：当用户选择……</td>
</tr>
</tbody></table>
<h3 id="2-对-HTML-语义化的理解"><a href="#2-对-HTML-语义化的理解" class="headerlink" title="2. 对 HTML 语义化的理解"></a>2. 对 HTML 语义化的理解</h3><p>根据文档的内容和结构的语义，选择合适的标签</p>
<p>优点：</p>
<ul>
<li>为程序提供额外信息。有利于搜索引擎爬虫爬取有效信息；博客文章自动生成目录</li>
<li>对开发者友好。增强文档可读性，让网页结构更清晰；有利于团队的开发和维护</li>
</ul>
<p>常见的：</p>
<ul>
<li>布局：header footer nav aside</li>
<li>内容：article main section</li>
<li>标题: h1</li>
</ul>
<h2 id="前端知识之CSS篇"><a href="#前端知识之CSS篇" class="headerlink" title="前端知识之CSS篇"></a>前端知识之CSS篇</h2><p>2021.12.15 - 2021.1.27</p>
<table>
<thead>
<tr>
<th>题号</th>
<th>补充内容</th>
</tr>
</thead>
<tbody><tr>
<td>一、1</td>
<td>补充：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85788761">CSS–选择器及其优先级</a><br>讨论CSS优先级，首先是要符合选择器规则被选中，然后在能够选中该元素的选择器中做优先级的比较（这也是为什么兄弟后代等选择器的优先级为0）</td>
</tr>
<tr>
<td>一.3/4</td>
<td>补充：行内元素：padding 上下方向，会撑开border，但不会影响元素位置</td>
</tr>
<tr>
<td>一.9</td>
<td>替换：MDN的说法：<br>伪元素：选择元素的特定部分修改样式，或添加内容。<br>伪类：选择处于特定状态的元素，并修改其样式。</td>
</tr>
<tr>
<td>一.18</td>
<td><a target="_blank" rel="noopener" href="https://editor.leonh.space/2021/rediscover-pixel-dpi-ppi-and-pixel-density/#css-pixel">重新認識 Pixel、DPI / PPI 以及像素密度</a></td>
</tr>
<tr>
<td>一.20</td>
<td><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/59f31a1704de">css基线与行高</a></td>
</tr>
<tr>
<td>一.22</td>
<td>替换：<br>CSS预处理器用于将Sass、Less等语言编译成CSS，它允许我们使用层级、mixin、变量、循环、函数等语法，来编写样式代码。这样使我们的样式代码更加简洁易读，也更具有可维护性、可拓展性、和复用性。此外，使用Sass、Less可以轻松实现多重继承，且完全兼容CSS代码。<br>CSS后处理器在完成的CSS样式表中根据CSS规范处理CSS代码，以保证CSS代码的有效性。目前最常做的是给CSS属性添加浏览器私有前缀，实现跨浏览器兼容的问题。</td>
</tr>
<tr>
<td>二.02</td>
<td><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903607347707918">前端响应式布局基础——rem</a></td>
</tr>
<tr>
<td>二.03</td>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context">MDN-BFC</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25321647">10 分钟理解BFC 原理</a></td>
</tr>
<tr>
<td>二.07</td>
<td><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25303493">30分钟学会 flex 布局</a></td>
</tr>
<tr>
<td>二.11</td>
<td><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yugege/p/9264319.html">为什么height:100%不生效？</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1575141/how-to-make-a-div-100-height-of-the-browser-window">How to make a div 100% height of the browser window</a><br>结论就是，使用百分比作为单位时，父级元素的 width 和 height 大小最好为确定值。在此题案例中，也就是最好给ul的容器div设置好宽高（比如 400x400）</td>
</tr>
<tr>
<td>三.2</td>
<td>关于css-clear属性的解释，看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clear">MDN clear</a></td>
</tr>
<tr>
<td>三.3</td>
<td>依旧可以从两个方面来理解BFC的作用：触发BFC后对同级元素的影响（比如，两栏布局）；触发BFC后对BFC内部的元素的适应（比如撑开坍塌的高度）</td>
</tr>
<tr>
<td>四.1</td>
<td>设置一个像素为零的div块，可以想象以一个点划两条垂直和水平的线，border-top right bottom left 就是以这两条线为边界，border 的大小指定的是 border 的厚度</td>
</tr>
</tbody></table>
<h3 id="一-1-补充"><a href="#一-1-补充" class="headerlink" title="一.1 补充"></a>一.1 补充</h3><p>注意 类选择器 的同时类和后代的区别</p>
<div align="center">
    <img src="https://s2.loli.net/2022/03/06/gmBXGE4aF3xY7jO.png" width="70%">
</div>

<h3 id="一-3-display的属性值及其作用"><a href="#一-3-display的属性值及其作用" class="headerlink" title="一.3 display的属性值及其作用"></a>一.3 display的属性值及其作用</h3><p>什么类型、默认宽度、可否设置宽高、是否换行、margin/padding 设置效果</p>
<h3 id="一-20-对line-height-的理解及其赋值方式"><a href="#一-20-对line-height-的理解及其赋值方式" class="headerlink" title="一.20 对line-height 的理解及其赋值方式"></a>一.20 对line-height 的理解及其赋值方式</h3><p>概念：</p>
<ul>
<li>指一行文本的高度，包括了字之间的行间距。本质上是下一行基线到上一行基线的距离</li>
<li>如果一个容器没有设置 height，那撑开容器高度的就是 line-height，而不是文本内容</li>
<li>line-height 和 height 设置相同值，可以实现单行文字的垂直居中</li>
</ul>
<h3 id="二-1-补充"><a href="#二-1-补充" class="headerlink" title="二.1 补充"></a>二.1 补充</h3><p>百分比, em：具体的含义要看用在什么属性上：</p>
<table>
<thead>
<tr>
<th></th>
<th>line-height 以及 大部分属性</th>
<th>font-szie</th>
<th>盒子属性</th>
<th>圆角和translate</th>
</tr>
</thead>
<tbody><tr>
<td>百分比</td>
<td>相比当前元素的字体大小</td>
<td>相比父级元素的字体大小</td>
<td>相比父级元素的盒子width</td>
<td>相对于自身元素border内的大小·</td>
</tr>
<tr>
<td>em</td>
<td>相比当前元素的字体大小</td>
<td>相比父级元素的字体大小</td>
<td>相比当前元素的字体大小</td>
<td></td>
</tr>
</tbody></table>
<h3 id="三-1"><a href="#三-1" class="headerlink" title="三.1"></a>三.1</h3><p>从两个方面理解浮动：浮动元素对同级元素的影响 + 浮动元素对父级（以及父级同级元素）的影响</p>
<ul>
<li>父级块元素，就当浮动元素不存在，无视浮动元素进行布局；但内容受影响。</li>
<li>父级行内元素，以及父级块元素中的行内元素，则会被浮动元素“排挤”。</li>
<li>同级块级元素，布局不受影响。但内容受影响</li>
<li>同级行内元素，会被浮动元素“排挤”。</li>
</ul>
<p>以下是浮动元素对其他元素的影响示例。创建了两个 div 块（为了看得更明显，规定这两个 div 的 height 为 150px，这也是后面测试 clearfix 失效的原因……），在第一个块中放入一些向左浮动的图片。</p>
<div align="center">
    <img src="https://s2.loli.net/2021/12/24/zVO4t9HI1RNQLDE.png" width="70%">
</div>

<blockquote>
<p>通过BFC、clearfix等方法撑起自适应的高度，事先不能设置好高度（当然，高度坍塌就是经常在没有设置高度的情况下发生的）。</p>
</blockquote>
<blockquote>
<p>补充一些好看的 CSS颜色（随手可用）：<a target="_blank" rel="noopener" href="https://www.wfublog.com/2015/08/css-color-code-table.html">CSS 色碼英文名稱對照表一覽</a>；salom, sandybrown, gold, lightgreen, skyblue, orchid</p>
</blockquote>
<h3 id="三-2"><a href="#三-2" class="headerlink" title="三.2"></a>三.2</h3><p>清除浮动用 after，即便最后的元素没有浮动，但只要同级元素中有浮动，它都能清除浮动。</p>
<p>清除浮动前</p>
<div align="center">
    <img src="https://s2.loli.net/2021/12/24/1Oy6bnwHjNg5Pfs.png" width="70%">
</div>

<p>清除浮动后。注意：最后的 div 和 span 都没有设置浮动属性。而且块元素中的内容溢出来的部分（绿色字，父级打错了，应该是同级），不会撑起来。——简单来说，就是布局时只考虑 元素-盒子模型 的大小，块元素的大小经过设置后与内容无关（布局不用管块的内容），而行内元素的大小与内容有关。</p>
<div align="center">
    <img src="https://s2.loli.net/2021/12/24/a8sZE3FdIitYU2o.png" width="70%">
</div>

<div align="center">
    <img src="https://s2.loli.net/2021/12/24/tmIGKykpaBgEn2q.png" width="70%">
</div>

<p>关于css-clear属性的解释，看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clear">MDN clear</a>：<br>“clear CSS 属性指定一个元素是否必须移动(清除浮动后)到在它之前的浮动元素下面。”。重点在于“之前”，且应该指的是“所有的”浮动元素。</p>
<h3 id="三-4"><a href="#三-4" class="headerlink" title="三.4"></a>三.4</h3><p>对于同级元素，通过 hidden 触发 BFC 能够撑起高度，但是不能解决 margin 重叠问题。(将 outer1 和 outer2 调换顺序，即让底部块 hidden 触发 BFC 也不行)</p>
<div align="center">
    <img src="https://s2.loli.net/2021/12/26/9ZCRy3UkN2x8hnA.png" width="70%">
</div>

<p>一种情况是：想让兄弟元素的 margin 不重叠，就需要将一个兄弟放到一个 BFC 上下文中（而不是让它自己触发 BFC）。参考资料：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000012265930">边距重叠与BFC</a></p>
<p>其他情况是：将顶部/底部兄弟元素设置<code>display: inline-block</code>；将底部兄弟元素设置浮动、和绝对定位</p>
<p>关于父子元素的 margin 重叠问题 &amp; 子元素 margin 溢出父元素问题，参考 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000039093635">子元素margin-top导致父元素移动的问题</a>。</p>
<h3 id="四-1"><a href="#四-1" class="headerlink" title="四.1"></a>四.1</h3><p>利用 border 来绘制各种图形——border的绘制规则</p>
<p>设置一个像素为零的div块，可以想象以一个点划两条垂直和水平的线，border-top right bottom left 就是以这两条线为边界，border 的大小指定的是 border 的厚度</p>
<div align="center">
    <img src="https://s2.loli.net/2021/12/27/2JQNZrinCwphuTf.png" width="30%">
</div>

<h2 id="前端知识之JavaScript篇"><a href="#前端知识之JavaScript篇" class="headerlink" title="前端知识之JavaScript篇"></a>前端知识之JavaScript篇</h2><p>2021.12.27 - 2022.1.8</p>
<table>
<thead>
<tr>
<th>题号</th>
<th>补充内容</th>
</tr>
</thead>
<tbody><tr>
<td>一.11</td>
<td>红宝书 P71 + 各数据类型的转换规则 + 一.18 对象的转换规则<br>类型转换问题：操作（各种操作符）时，确定谁转换成谁，转换优先级和顺序 + a数据类型如何转化成b数据类型</td>
</tr>
<tr>
<td>一.21</td>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">MDN Object.assign()</a> 、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax#%E6%9E%84%E9%80%A0%E5%AD%97%E9%9D%A2%E9%87%8F%E5%AF%B9%E8%B1%A1%E6%97%B6%E4%BD%BF%E7%94%A8%E5%B1%95%E5%BC%80%E8%AF%AD%E6%B3%95">构造字面量对象时使用展开语法</a></td>
</tr>
<tr>
<td>二.2</td>
<td>面经说的有点绕。const 变量的值为引用值（也即对象数据类型）的时候，在栈空间的变量本身存储的值是对象的指针，它指向存储在堆内存中的真实对象的位置。此时变量直接存储的值，也就是栈空间中对象的指针不能修改，但是堆内存中的对象可以被修改。</td>
</tr>
<tr>
<td>二.6</td>
<td>扩展操作符的应用情况分类：两个方面：对什么数据操作 + 用于构造什么。<br>对普通对象使用：构造对象字面量<br>对数组对象使用：数组拷贝、数组合并、解构赋值拆分数组、用于函数调用时传入参数<br>ps: 对数组的扩展操作，逻辑上就等价于获得用逗号分隔的数据序列，比如 [1,2,3] —&gt; 1,2,3<br>对（非数组）可迭代对象使用：将可迭代对象转化成数组、当展开参数传入函数（比如 argument）<br>定义函数时在形参中使用：将参数收集到一个数组中，类似于 argument</td>
</tr>
<tr>
<td>三.5</td>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions">正则表达式 MDN</a></td>
</tr>
<tr>
<td>三.11</td>
<td>位运算简介看 红宝书：<br>位运算符用于数值的底层操作，也就是操作内存中表示数据的比特（位）。ES中的所有数值都是用IEEE754 64位格式存储，位操作并不直接应用到64位表示，而是先把值转换为32位整数再进行位操作，再把结果转换为64位。</td>
</tr>
<tr>
<td>三.17</td>
<td>关于提高性能：<br>在JS中，拿到一个函数要执行，会有以下步骤：<br>解析：预编译，语法检查，生成可执行代码（可能后续调用也会沿用已编译好的代码）；创建执行上下文，为声明的变量分配存储空间并让其占位（并不填充其被赋予的值）<BR>执行：执行函数中的代码<br>声明提升，就是为了方便声明的变量能够在一开始解析的时候就被一次性收集处理好，以提高性能</td>
</tr>
<tr>
<td>三.18</td>
<td>详见红宝书 P307</td>
</tr>
<tr>
<td>三.19</td>
<td>补充： <a target="_blank" rel="noopener" href="https://juejin.cn/post/6938581764432461854">聊聊什么是CommonJs和Es Module及它们的区别</a>、<a href=""></a><br>总结：<br>commonJs是被加载的时候运行，esModule是编译的时候运行（是否可以动态引入）<br>commonJs输出的是值的浅拷贝，esModule输出值的引用<br>commentJs具有缓存。在第一次被加载时，会完整运行整个文件并输出一个对象，拷贝（浅拷贝）在内存中。下次加载文件时，直接从内存中取值</td>
</tr>
<tr>
<td>三.20</td>
<td>补充：DOM-红宝书 P401</td>
</tr>
<tr>
<td>三.21</td>
<td>补充区别 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode">严格模式的区别</a></td>
</tr>
<tr>
<td>三.23</td>
<td>面经说的不清楚 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1EE411R7hL?p=1&share_medium=android&share_plat=android&share_session_id=1af835fa-014b-4365-b4cd-1b3c8970108a&share_source=WEIXIN&share_tag=s_i&timestamp=1641224087&unique_k=7oZrrz4">B站 什么是强/弱类型，动态/静态类型语言？</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%BA%E7%B1%BB%E5%9E%8B/5074514">百度百科 强类型语言</a></td>
</tr>
<tr>
<td>三.25</td>
<td>红宝书 for-in 用于枚举对象中的非符号键属性；for-of 用于遍历可迭代对象的元素</td>
</tr>
<tr>
<td>三.27</td>
<td>AJAX精简描述见笔记中的三.16；<br>补充：Axios是一个基于promise的HTTP库，可以用在浏览器和 node.js 中。它本质也是对原生XMLHttpRequest的封装，只不过它是Promise的实现版本，符合最新的ES规范。</td>
</tr>
<tr>
<td>七.1</td>
<td>补充：发布订阅模式/事件机制 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/onepixel/p/10806891.html">观察者模式与订阅发布模式的区别</a></td>
</tr>
</tbody></table>
<h3 id="一-3-总结类型判断"><a href="#一-3-总结类型判断" class="headerlink" title="一.3 总结类型判断"></a>一.3 总结类型判断</h3><p>获取数据的原型、构造函数（原始数据类型会被隐式转换成包装类型），然后再对比判断</p>
<ol>
<li><code>Object.prototype.getString.call(obj)</code> 返回字符串</li>
<li><code>obj._proto_</code> &lt;=&gt; <code>Object.getPrototypeOf(obj)</code> 返回原型对象</li>
<li><code>obj.constructor</code> 返回构造函数</li>
</ol>
<p>从类型入手，直接判断</p>
<ol>
<li><code>Array.isArray(obj)</code></li>
<li><code>Array.prototype.isPrototypeOf(obj)</code></li>
<li><code>obj instanceof Array</code></li>
</ol>
<h3 id="二、ES6"><a href="#二、ES6" class="headerlink" title="二、ES6"></a>二、ES6</h3><ul>
<li><p>解决原有语法的缺陷和不足<br>let const 块级作用域、Symbol数据类型</p>
</li>
<li><p>对原有语法进行增强<br>解构、扩展、模板字符串</p>
</li>
<li><p>新增对象、全新的方法，全新的功能<br>Object.assign()、Proxy/Reflect、Promise</p>
</li>
<li><p>全新的数据类型和数据结构<br>set/map、class、迭代器/生成器</p>
</li>
</ul>
<h3 id="三-16"><a href="#三-16" class="headerlink" title="三.16"></a>三.16</h3><p>以红宝书 P711 为准</p>
<p>AJAX 是指通过 JavaScript 以异步通信的方式向服务器发送请求来获取额外的数据，而且可以局部地更新页面，不用刷新重新请求整个页面</p>
<p>大致步骤：</p>
<ul>
<li>创建XHR对象</li>
<li>注册onreadystatechange事件处理程序</li>
<li>调用open()方法为发送请求做准备</li>
<li>调用setRequestHeader()设置请求头部</li>
<li>调用send()方法发送请求</li>
<li>收到响应后XHR对象相应属性被填充响应数据</li>
</ul>
<p>代码示例见 P716</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SERVER_URL = <span class="string">&quot;/server&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">// 设置状态监听函数</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) &#123;</span><br><span class="line">            alert(xhr.responseText);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">&quot;Request was unsuccessful: &quot;</span> + xhr.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 设置请求失败时的监听函数</span></span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(xhr.statusText);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 创建 Http 请求</span></span><br><span class="line">xhr.open(<span class="string">&quot;GET&quot;</span>, SERVER_URL, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 设置请求头信息</span></span><br><span class="line">xhr.responseType = <span class="string">&quot;json&quot;</span>;</span><br><span class="line">xhr.setRequestHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line"><span class="comment">// 发送 Http 请求</span></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>用 Promise 封装 AJAX</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getJSON</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> getPromase = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status === <span class="number">304</span>) &#123;</span><br><span class="line">          resolve(xhr.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          reject(xhr.status);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(xhr.status));</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.open(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">    xhr.responseType = <span class="string">&quot;json&quot;</span>;</span><br><span class="line">    xhr.setRequestHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">    xhr.send(<span class="literal">null</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> getPromase;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zoulonglong/article/details/80501029">form和ajax表单提交方式的区别</a></p>
<h3 id="三-补充"><a href="#三-补充" class="headerlink" title="三.补充"></a>三.补充</h3><p><a target="_blank" rel="noopener" href="https://github.com/zachrey/zblog/issues/3">【JS概念】纯函数和副作用</a><br><a target="_blank" rel="noopener" href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/">函数式编程指北</a></p>
<p>红宝书 第7章 迭代器和生成器</p>
<h3 id="五-1"><a href="#五-1" class="headerlink" title="五.1"></a>五.1</h3><p>关于 <code>setTimeout()</code> ，它接受的函数只是函数的定义，并非直接调用了函数。函数中涉及到的外部的变量，得在调用它的时候才能确定变量的值。（也因此，外部函数/作用域执行结束后，其上下文不会被销毁——普通情况下执行完就要销毁，而会保留？）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">  &#125;, i * <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至于 for-let 语句，此前就有疑问，let 的作用域是块，那 for 语句括号中的 let 变量算什么？原来是，for 每执行一次块语句，就会为当前的块作用域 let 一个变量。普通情况下，此次块语句执行完成，这个块作用域的 let 变量也就被销毁了。但以下代码中，let 变量被引入到了 setTimeout 中的回调函数的定义中，只要每次的异步调用不完成，对应的 let 变量就不会被销毁。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">  &#125;, i * <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自行补充复习 红宝书 中闭包的内容。</p>
<h3 id="五-2-3"><a href="#五-2-3" class="headerlink" title="五.2/3"></a>五.2/3</h3><p>面试还是背红宝书 P87-89，面经保留“创建执行上下文”部分的内容</p>
<ul>
<li>执行上下文：是什么；变量对象</li>
<li>全局上下文：是什么；window对象；代码执行完后销毁；</li>
<li>函数上下文：是什么；活动对象；代码执行-函数上下文-执行栈；</li>
<li>作用域链：是什么-存储了各级变量对象；标识符解析规则</li>
</ul>
<p>关键在于理清概念：作用域&amp;访问规则、执行上下文、作用域链</p>
<h3 id="七-1-异步编程的实现方式"><a href="#七-1-异步编程的实现方式" class="headerlink" title="七.1 异步编程的实现方式"></a>七.1 异步编程的实现方式</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903556936548359">Generator 函数异步应用</a></p>
<h3 id="八-2"><a href="#八-2" class="headerlink" title="八.2"></a>八.2</h3><p>总结一下</p>
<table>
<thead>
<tr>
<th>继承方式</th>
<th>基本思路</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>原型链继承</td>
<td>new一个SuperType对象，<br>赋值给SubType的prototype属性</td>
<td></td>
<td>1.原型链中包含的引用值会被所有示例共享<br>2.子类实例化时不能给父类型的构造函数传参</td>
</tr>
<tr>
<td>盗用构造函数</td>
<td>在子类构造函数中通过call/apply<br>调用父类构造函数</td>
<td>1.解决了原型包含引用值导致的继承问题<br>2.可以在子类构造函数中向父类构造函数传参</td>
<td>1.必须在构造函数中定义方法，函数不能在实例间重用<br>2.子类不能访问父类原型上定义的方法</td>
</tr>
<tr>
<td>组合继承</td>
<td>综合了原型链和盗用构造函数：<br>用原型链继承原型上的属性和方法<br>用盗用构造函数继承实例属性</td>
<td>集中两者优点：<br>1.子类可以访问父类原型的属性和方法<br>2.每个实例都有自己的属性，且继承了父类实例属性</td>
<td>存在效率问题：父类构造函数会被调用两次</td>
</tr>
<tr>
<td>原型式继承</td>
<td>创建一个对象，<br>它由一个临时的构造函数创建，且_proto_属性指向某个对象</td>
<td>适合不需要单独创建构造函数，<br>但仍需要在对象间共享信息的场合</td>
<td>被“挂靠”的对象的引用值属性依旧会被“挂着”的对象共享</td>
</tr>
<tr>
<td>寄生式继承</td>
<td>类似于寄生构造函数/原型式继承和工厂模式：<br>创建一个函数，它用原型式继承创建一个实例，<br>然后再增强这个实例（添加属性、方法），最后返回它</td>
<td>适合关注对象，不在乎类型和构造函数的场景</td>
<td>对象的函数是独有的，不能重用</td>
</tr>
<tr>
<td>寄生式组合继承</td>
<td>用盗用构造函数继承属性，用混合式原型链继承方法：<br>也就是用寄生式继承获取一个增强的父类原型的“副本”，然后将它当作子类原型</td>
<td>改进了组合继承，效率更高</td>
<td></td>
</tr>
</tbody></table>
<div align="center">
    <img src="https://s2.loli.net/2022/02/25/IYh5r12yGN8vUgB.jpg" width="70%">
</div>

<h2 id="前端知识之浏览器原理篇"><a href="#前端知识之浏览器原理篇" class="headerlink" title="前端知识之浏览器原理篇"></a>前端知识之浏览器原理篇</h2><p>2022.1.8-2022.1.13</p>
<ul>
<li>重要补充资料——<strong>牢记</strong>：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1x54y1B7RE?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click">【干货】浏览器是如何运作的？</a></li>
</ul>
<table>
<thead>
<tr>
<th>题号</th>
<th>补充内容</th>
</tr>
</thead>
<tbody><tr>
<td>一.1/2</td>
<td>补充：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903781704925191">XSS攻击与CSRF攻击</a><br>补充：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6912030758404259854">XSS攻击-攻击流程图</a><br>补充：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1s5411s7qd?from=search&seid=3968350037173219363&spm_id_from=333.337.0.0">B站 XSS原理和攻防 （讲的比较清晰）</a><br>补充：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mysticbinary/p/12542695.html">DOM-XSS攻击原理与防御</a> <br><strong>答题总结</strong>：<br>是什么、有什么危害、分类及其攻击流程-构造/用户访问/执行恶意代码/实现攻击效果<br>为什么、如何防范<br><br>DOM XSS：不经过服务器（使用本地已有/缓存的html、js等），且需要前端代码中本身存在一定的问题，然后攻击者根据这些问题针对性地构造出某种的恶意的输入（url、input等），让浏览器用有问题的参数运行js代码实现XSS攻击。</td>
</tr>
<tr>
<td>一.3/4</td>
<td>补充：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000024490213">CSRF攻击原理和防范措施</a></td>
</tr>
<tr>
<td>二.2</td>
<td>整理——什么是进程线程？：<br>从概念上来说，进程是某个程序的一次运行活动，线程是某个程序中的某个代码片段的一次运行活动。<br>详细的解释是，启动一个程序时，操作系统会为该程序创建一个独立的虚拟内存空间，在逻辑上这个虚拟的内存空间仅为这个程序所用，它用来存放程序代码、运行中的数据、打开的文件等等，然后CPU就会执行内存空间中的代码（每条代码/指令必有CPU活动，可能有I/O活动），我们将这一整个程序的运行过程称为进程。不同进程可以时分复用CPU，以实现并发的效果。<br>单个程序中不同的代码片段也可以时分复用地在cpu中并发执行，程序中的某个代码片段的运行活动，我们称之为线程，整个程序本身也可以看作是一个大的代码片段，它的运行活动我们称之为主线程。<br>总结来说，进程是资源分配的最小单位，线程是CPU调度的最小单位。通常将进程当作是某个程序运行时的资源容器（相互独立），线程则是该程序的各个代码片段的执行流（并发进行）。<br>ps：要从 底层真实情况+抽象后逻辑上的使用 两个角度来理解进程线程。在大多数情况下（特别是前端），我们以抽象逻辑视角来看待进程线程：每个进程都有自己的内存空间、多个CPU，占有了某些文件和打印机等I/O资源（一个沙盒环境，相互独立，并发进行，互不影响）；每个线程都有自己的CPU，按自己的执行流走就好。</td>
</tr>
<tr>
<td>五.2.4</td>
<td>区分：减少DOM操作，减少回流重绘（想想渲染流程，比如我可以在操作DOM时阻断后续的布局和绘制）</td>
</tr>
<tr>
<td>五.2.4</td>
<td>问题：documentFragment和渲染队列，做的事情很像，有何区别？它们最后将一波DOM操作一次性更新到DOM的操作，只触发一次重新渲染，但是本质上是否仍多次操作DOM？</td>
</tr>
<tr>
<td>七.1</td>
<td>补充：<a target="_blank" rel="noopener" href="https://catcat.cc/post/2020-06-23/">循序渐进理解：跨源跨域，再到 XSS 和 CSRF</a></td>
</tr>
<tr>
<td>八.9</td>
<td>补充：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/54882306">浏览器与Node的事件循环(Event Loop)有何区别?</a></td>
</tr>
<tr>
<td>九.1</td>
<td>补充：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904016325902344">一文搞懂V8引擎的垃圾回收</a></td>
</tr>
</tbody></table>
<h3 id="五-1-替换"><a href="#五-1-替换" class="headerlink" title="五.1 替换"></a>五.1 替换</h3><div align="center">
    <img src="https://s2.loli.net/2022/03/12/idsMCI8Vrnq5Lzl.png" width="80%">
</div>

<ul>
<li>浏览器通过请求得到一个HTML文本</li>
<li>渲染进程解析HTML文本，构建DOM树</li>
<li>解析HTML的同时，如果遇到内联样式或者样式脚本，则下载并构建样式规则（stytle rules），若遇到JavaScript脚本，则会下载执行脚本。</li>
<li>DOM树和样式规则构建完成之后，渲染进程将两者合并成渲染树（render tree）</li>
<li>渲染进程开始对渲染树进行布局，生成布局树（layout tree）</li>
<li>渲染进程对布局树进行绘制，生成绘制记录</li>
<li>渲染进程的对布局树进行分层，分别栅格化每一层，并得到合成帧</li>
<li>渲染进程将合成帧信息发送给GPU进程显示到页面中</li>
</ul>
<h3 id="七-3"><a href="#七-3" class="headerlink" title="七.3"></a>七.3</h3><div align="center">
    <img src="https://s2.loli.net/2022/03/12/R6GyIPpe8VT25t9.png" width="80%">
</div>

<div align="center">
    <img src="https://s2.loli.net/2022/03/12/WjqXBYicKUbJT2v.png" width="80%">
</div>

<p>虽然正向代理服务器和反向代理服务器所处的位置都是客户端和真实服务器之间，所做的事情也都是把客户端的请求转发给服务器，再把服务器的响应转发给客户端，但是二者之间还是有一定的差异的。</p>
<ul>
<li><p>正向代理其实是客户端的代理，帮助客户端访问其无法访问的服务器资源。反向代理则是服务器的代理，帮助服务器做负载均衡，安全防护等。</p>
</li>
<li><p>正向代理一般是客户端架设的，比如在自己的机器上安装一个代理软件。而反向代理一般是服务器架设的，比如在自己的机器集群中部署一个反向代理服务器。</p>
</li>
<li><p>正向代理中，服务器不知道真正的客户端到底是谁，以为访问自己的就是真实的客户端。而在反向代理中，客户端不知道真正的服务器是谁，以为自己访问的就是真实的服务器。</p>
</li>
<li><p>正向代理和反向代理的作用和目的不同。正向代理主要是用来解决访问限制问题。而反向代理则是提供负载均衡、安全防护等作用。二者均能提高访问速度。</p>
</li>
</ul>
<h3 id="补充：Cookie-和-Session-关系和区别"><a href="#补充：Cookie-和-Session-关系和区别" class="headerlink" title="补充：Cookie 和 Session 关系和区别"></a>补充：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903575684907016">Cookie 和 Session 关系和区别</a></h3><blockquote>
<p>链接：<a target="_blank" rel="noopener" href="https://www.nowcoder.com/questionTerminal/5a2d287965824d3ca93921bf89f8654c">https://www.nowcoder.com/questionTerminal/5a2d287965824d3ca93921bf89f8654c</a></p>
</blockquote>
<p>cookie实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户的状态，就使用response向客户端浏览器颁发一个cookie。客户端浏览器会把cookie保存起来。当浏览器再次请求该网站时，浏览器就会把请求地址和cookie一同给服务器。服务器检查该cookie，从而判断用户的身份和状态。服务器还可以根据需要修改cookie的内容。<br>session是另一种记录客户状态的机制。不同的是cookie保存在客户端浏览器中，而session保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上，这就是session。客户端浏览器再次访问时只需要从该session中查找该客户的状态就可以了。<br>如果说cookie机制是通过检查客户身上的“通行证”，那么session机制就是通过检查服务器上的“客户明细表”来确认客户身份。</p>
<h2 id="前端知识之性能优化篇"><a href="#前端知识之性能优化篇" class="headerlink" title="前端知识之性能优化篇"></a>前端知识之性能优化篇</h2><p>2022.1.21 - 2022. </p>
<table>
<thead>
<tr>
<th>题号</th>
<th>补充内容</th>
</tr>
</thead>
<tbody><tr>
<td>一</td>
<td><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12T4y1P7Fh/?spm_id_from=333.788.recommend_more_video.0">用动画告诉你 CDN是什么</a></td>
</tr>
<tr>
<td>二.4</td>
<td>补充：要理解何为预和懒，首先要知道本来是如何加载。<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010032501">Web图片资源的加载与渲染时机</a> <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903545016156174">浏览器页面资源加载过程与优化</a></td>
</tr>
</tbody></table>
<h2 id="前端知识之前端工程化篇"><a href="#前端知识之前端工程化篇" class="headerlink" title="前端知识之前端工程化篇"></a>前端知识之前端工程化篇</h2><h3 id="一-1-git-和-svn-的区别（替换）"><a href="#一-1-git-和-svn-的区别（替换）" class="headerlink" title="一.1 git 和 svn 的区别（替换）"></a>一.1 git 和 svn 的区别（替换）</h3><p>完整对比：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/WindrunnerMax/p/14171924.html">Git与SVN对比</a></p>
<ul>
<li>git 和 svn 最大的区别在于 git 是分布式的而 svn 是集中式的<br>核心区别：版本库存储位置、个人版本管理方式、协作同步方式。<a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600/896202780297248">集中式vs分布式</a>。</li>
<li>git 把内容按元数据方式存储，而SVN是按文件。<br>所有的资源控 制系统都是把文件的元信息隐藏在一个类似.svn,.cvs等的文件夹里。如果你把.git目录的体积大小跟.svn比较，你会发现它们差距很大。因 为,.git目录是处于你的机器上的一个克隆版的版本库，它拥有中心版本库上所有的东西，例如标签，分支，版本记录等。</li>
<li>GIT分支和SVN的分支不同<br>svn 中的分支是复制了整个版本库的完整目录，而 git 的分支是将指针指向某次提交。因此 git 的分支创建更快，且开销更小。而且 svn 分支被所有成员共用，git 分支可以在本地创建被个人私用。<br>svn 会发生分支遗漏的情况。而 git 可以在同一个工作目录下的几个分支间快速切换，很容易发现并合并未被合并的分支。</li>
<li>git 没有一个全局的版本号，而 svn 有</li>
<li>GIT的内容完整性要优于SVN<br>GIT的内容存储使用的是SHA-1哈希算法。这能确保代码内容的完整性，确保在遇到磁盘故障和网络问题时降低对版本库的破坏。</li>
</ul>
<h3 id="二-1-webpack与grunt、gulp的不同（替换）"><a href="#二-1-webpack与grunt、gulp的不同（替换）" class="headerlink" title="二.1 webpack与grunt、gulp的不同（替换）"></a>二.1 webpack与grunt、gulp的不同（替换）</h3><p>参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000019650765">Webpack与Grunt、Gulp的区别？</a>、<a target="_blank" rel="noopener" href="http://www.noobyard.com/article/p-dsfelhmn-er.html">Webpack与Gulp、Grunt区别</a></p>
<ul>
<li>Grunt、Gulp是<strong>任务执行程序</strong>：它们在配置文件中，指明对某些文件进行相似 压缩、sass编译、单元测试、代码检查等反复重复的任务的具体步骤，以后能够自动替你完成这些任务。就像流⽔线，把资源放上去然后通过不同插件进⾏加⼯。</li>
<li>Webpack是<strong>模块打包程序</strong>：webpack 把项目当成一个总体，把⼀切当成模块。它从入口文件开始，递归地构建⼀个依赖关系图 ，其中包含应⽤程序需要的每个模块，然后将所有这些模块打包成⼀个或多个能直接被浏览器运行的 bundle。</li>
</ul>
<p>这两类程序的目标不一样。前者主要是解决重复任务的问题，后者则更像一套前端工程化解决方案，解决前端静态资源依赖管理的问题。严格来说，NPM 脚本才是 Grunt 和 Gulp 的替代品，但 webpack 确实客观上简化了此前“过度使用”Grunt和Gulp和NPM脚本的Web开发任务流程。</p>
<h3 id="二-13-怎么配置单页面应用？怎么配置多页面应用？"><a href="#二-13-怎么配置单页面应用？怎么配置多页面应用？" class="headerlink" title="二.13 怎么配置单页面应用？怎么配置多页面应用？"></a>二.13 怎么配置单页面应用？怎么配置多页面应用？</h3><p>待补充总结性内容</p>
<h2 id="前端知识之计算机网络篇"><a href="#前端知识之计算机网络篇" class="headerlink" title="前端知识之计算机网络篇"></a>前端知识之计算机网络篇</h2><h3 id="一-1-GET和POST的请求的区别"><a href="#一-1-GET和POST的请求的区别" class="headerlink" title="一.1 GET和POST的请求的区别"></a>一.1 GET和POST的请求的区别</h3><ul>
<li><strong>作用</strong>：GET 方法请求一个指定资源的表示形式，使用GET的请求应该只被用于获取数据；POST 方法用于将实体提交到指定的资源，通常导致在服务器上的状态变化或副作用</li>
<li><strong>请求编码</strong>：GET 请求只能进行url编码，而 POST 支持多种编码方式</li>
<li><strong>缓存</strong>：GET 请求会被浏览器主动缓存，而 POST 不会</li>
<li><strong>历史记录</strong>：GET 请求参数会被完整保留在浏览器历史记录里，而 POST 不会</li>
<li><strong>参数</strong>：<ul>
<li>传递方式：GET 请求参数是通过 URL 传递的，多个参数以&amp;连接，POST 请求放在 request body 中</li>
<li>编码：GET 只接受 ASCII 字符，而 POST 没有限制</li>
</ul>
</li>
</ul>
<h3 id="一-4-补充"><a href="#一-4-补充" class="headerlink" title="一.4 补充"></a>一.4 补充</h3><p>HTTP的常用方法</p>
<ul>
<li><p>GET方法<br>GET方法用于使用给定的URI从给定服务器中检索信息，即从指定资源中请求数据。使用GET方法的请求应该只是检索数据，并且不应对数据产生其他影响。</p>
</li>
<li><p>POST方法<br>POST方法用于将数据发送到服务器以创建或更新资源，它要求服务器确认请求中包含的内容作为由URI区分的Web资源的另一个下属。<br>POST请求永远不会被缓存，且对数据长度没有限制；我们无法从浏览器历史记录中查找到POST请求。</p>
</li>
<li><p>HEAD方法<br>HEAD方法与GET方法相同，但没有响应体，仅传输状态行和标题部分。这对于恢复相应头部编写的元数据非常有用，而无需传输整个内容。</p>
</li>
<li><p>PUT方法<br>PUT方法用于将数据发送到服务器以创建或更新资源，它可以用上传的内容替换目标资源中的所有当前内容。</p>
</li>
<li><p>DELETE方法<br>DELETE方法用来删除指定的资源，它会删除URI给出的目标资源的所有当前内容。</p>
</li>
<li><p>CONNECT方法<br>CONNECT方法用来建立到给定URI标识的服务器的隧道；它通过简单的TCP / IP隧道更改请求连接，通常实使用解码的HTTP代理来进行SSL编码的通信（HTTPS）。</p>
</li>
<li><p>OPTIONS方法<br>OPTIONS方法用来描述了目标资源的通信选项，会返回服务器支持预定义URL的HTTP策略。</p>
</li>
<li><p>TRACE方法<br>TRACE方法用于沿着目标资源的路径执行消息环回测试；它回应收到的请求，以便客户可以看到中间服务器进行了哪些（假设任何）进度或增量。</p>
</li>
</ul>
<h3 id="一-9-替换"><a href="#一-9-替换" class="headerlink" title="一.9 替换"></a>一.9 替换</h3><ul>
<li>HTTP 明文传输，数据都是未加密的，安全性较差，HTTPS（SSL+HTTP） 数据传输过程是加密的，安全性较好。</li>
<li>使用 HTTPS 协议需要到 CA（Certificate Authority，数字证书认证机构） 申请证书，一般免费证书较少，因而需要一定费用。证书颁发机构如：Symantec、Comodo、GoDaddy 和 GlobalSign 等。</li>
<li>HTTP 页面响应速度比 HTTPS 快，主要是因为 HTTP 使用 TCP 三次握手建立连接，客户端和服务器需要交换 3 个包，而 HTTPS除了 TCP 的三个包，还要加上 ssl 握手需要的 9 个包，所以一共是 12 个包。</li>
<li>HTTP 和 HTTPS 使用的是完全不同的连接方式，用的端口也不一样，前者是 80，后者是 443。</li>
<li>HTTPS 其实就是建构在 SSL/TLS 之上的 HTTP 协议，所以，要比较 HTTPS 比 HTTP 要更耗费服务器资源。</li>
</ul>
<h3 id="一-18-补充"><a href="#一-18-补充" class="headerlink" title="一.18 补充"></a>一.18 补充</h3><p>HTTP1 —&gt; HTTP2 —&gt; HTTP3 发展脉络</p>
<p>HTTP1.0：一次HTTP请求应答，就是要建立一次TCP连接<br>HTTP1.1：多次HTTP请求应答，可以共用一次TCP连接，但是每对请求应答得排队一个个来——HTTP的队头阻塞<br>HTTP2.0：多次HTTP请求应答，可以共用一次TCP连接，以多路复用的形式实现多对请求应答同时进行，但传输层仍是TCP——TCP的队头阻塞<br>HTTP3.0：传输层改用UDP协议，配合QUIC协议簇实现了可靠传输，且没有TCP队头阻塞的问题</p>
<p>PS：注意区分 HTTP 和 TCP 的队头阻塞（head-of-line blocking）：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/330300133">关于队头阻塞（Head-of-Line blocking），看这一篇就足够了</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=GriONb4EfPY">HTTP/2 Critical Limitation that led to HTTP/3 &amp; QUIC</a></p>
<h3 id="二-3-补充"><a href="#二-3-补充" class="headerlink" title="二.3 补充"></a>二.3 补充</h3><p>假设A生成了一对公钥私钥：</p>
<p>非对称加密：A将公钥发送给B，B用A的公钥加密数据再发送给A，A用私钥解密——用来确保B发给A的内容不泄露<br>数字签名：A将公钥发送给B，A用私钥加密数据再将数据发送给B，B用A的公钥解密——用来确保数据是A发送的且未被篡改</p>
<p>核心都是：A的私钥不会通过网络传输，确保仅被A持有；A的公钥通过网络发送，谁都可能获取。</p>
<p>关键概念：服务器的公钥 –hash–&gt; 信息摘要 –CA私钥签名–&gt; 数字证书</p>
<p>数字证书的目标就是确保客户端收到的公钥是服务器的公钥。客户端根据数字证书（有CA签名确保其来源和正确性），可以获得服务器公钥的hash值，此为真；客户端还会收到“服务器”发过来的公钥（可能已被恶意置换），此为不确定，因此需要将其同样hash，与数字证书的hash来比较验伪。</p>
<p>本质就是要确定收到的“服务器”公钥是正确的，当然可以直接对服务器公钥做数字签名。但是HASH可以减少需要加密和传输的数据，且同样能证明公钥的正确性，就是多了一些步骤而已。</p>
<h3 id="二-4-补充"><a href="#二-4-补充" class="headerlink" title="二.4 补充"></a>二.4 补充</h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021494676">HTTPS 详解一：附带最精美详尽的 HTTPS 原理图</a></p>
<p>HTTPS-TSL 四次握手</p>
<div align="center">
    <img src="https://segmentfault.com/img/bVbClUl" width=80%>
</div>

<h3 id="三-HTTP-状态码"><a href="#三-HTTP-状态码" class="headerlink" title="三 HTTP 状态码"></a>三 HTTP 状态码</h3><p><a target="_blank" rel="noopener" href="https://github.com/febobo/web-interview/issues/144">面试官：说说HTTP 常见的状态码有哪些，适用场景？</a></p>
<p>一些状态码的适用场景：</p>
<ul>
<li><p>100：客户端在发送POST数据给服务器前，征询服务器情况，看服务器是否处理POST的数据，如果不处理，客户端则不上传POST数据，如果处理，则POST上传数据。常用于POST大数据传输</p>
</li>
<li><p>206：一般用来做断点续传，或者是视频文件等大文件的加载</p>
</li>
<li><p>301：永久重定向会缓存。新域名替换旧域名，旧的域名不再使用时，用户访问旧域名时用301就重定向到新的域名</p>
</li>
<li><p>302：临时重定向不会缓存，常用 于未登陆的用户访问用户中心重定向到登录页面</p>
</li>
<li><p>304：协商缓存，告诉客户端有缓存，直接使用缓存中的数据，返回页面的只有头部信息，是没有内容部分</p>
</li>
<li><p>400：参数有误，请求无法被服务器识别</p>
</li>
<li><p>403：告诉客户端禁止访问该站点或者资源，如在外网环境下，然后访问只有内网IP才能访问的时候则返回</p>
</li>
<li><p>404：服务器找不到资源时，或者服务器拒绝请求又不想说明理由时</p>
</li>
<li><p>503：服务器停机维护时，主动用503响应请求或 nginx 设置限速，超过限速，会返回503</p>
</li>
<li><p>504：网关超时</p>
</li>
</ul>
<h3 id="四-补充"><a href="#四-补充" class="headerlink" title="四.补充"></a>四.补充</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Rp4y1a7xQ?spm_id_from=333.1007.top_right_bar_window_history.content.click">详解DNS服务，DNS解析，DNS劫持和污染</a></p>
<p>DNS劫持：<strong>是</strong>指通过某些手段取得某域名的解析记录控制权，进而<strong>修改此域名的解析结果</strong>，导致对该域名的访问由原IP地址转入到修改后的指定IP。<strong>其结果</strong>就是对特定的网址不能访问或访问的是假网址，从而实现窃取资料或者破坏原有正常服务的目的。</p>
<h3 id="五-替换"><a href="#五-替换" class="headerlink" title="五.替换"></a>五.替换</h3><p><strong>理解</strong>计算机网络层次模型：</p>
<ul>
<li>每个层次的作用和联系：本为上层提供服务+使用下层服务/管理和优化下层+本身设计</li>
<li>同层次协议对等通信：可以单独讨论某个层次的协议</li>
<li>具体的实现：传输介质、硬件+软件、传输数据流&amp;各层次协议数据的包裹和解包</li>
</ul>
<p>在实际应用的时候，我们可以自上而下+一次仅看一层的来看。反正在某一层，我就能享受这一层的服务效果，且这个服务效果是基于下面层次的服务效果。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/69554474">【计算机网络】你真的理解数据链路层吗？</a></p>
<p><strong>网络模型</strong></p>
<p>（1）应用层：直接为应用进程提供网络通信服务。应用层协议定义的是应用进程间通讯和交互的规则，不同的应用有着不同的应用层协议，如 HTTP协议（万维网服务）、FTP协议（文件传输）、SMTP协议（电子邮件）、DNS（域名查询）等。<br>（2）表示层：提供数据编码和转换功能，为不同终端的应用层提供数据和信息正确的语法表示变换方法。数据压缩和加密也是表示层可提供的转换功能之一。<br>（3）会话层：就是负责建立、管理和终止表示层实体之间的通信会话，实现两个会话用户之间实现有组织的，同步的数据传输。<br>（4）传输层：它负责为两台主机中的进程提供基础的通信服务。该层主要有以下两种协议：</p>
<ul>
<li>传输控制协议 (Transmission Control Protocol，TCP)：提供面向连接的、可靠的数据传输服务。具体而言是建立主机端口之间连接实现可靠的数据传输。数据传输的基本单位是报文段（segment）。</li>
<li>用户数据报协议 (User Datagram Protocol，UDP)：提供无连接的、尽最大努力的数据传输服务，但不保证数据传输的可靠性，数据传输的基本单位是用户数据报。</li>
</ul>
<p>（5）网络层：它负责为两台主机提供通信服务。网络层把从传输层接收到的数据报文拆分成分组，通过路由选择算法选择合适的网络路径将数据分组传递到目标主机。<br>（6）数据链路层：负责提供网络相邻节点之间的无差错的逻辑链路（数据链路层是对物理层传输原始比特流的功能的加强，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一无差错的线路。）。将网络层交下来的 IP 数据报封装成帧，并在链路的两个相邻节点间传送帧，每一帧都包含数据和必要的控制信息（如同步信息、地址信息、差错控制等）。数据链路层提供了相邻节点间的线路，网络层则是规划了数据的传输路径。<br>（7）物理层：确保比特流数据在物理媒介上进行传输，定义了与传输媒介相关的接口特性，尽可能屏蔽传输介质和物理设备的差异。</p>
<h3 id="六-补充"><a href="#六-补充" class="headerlink" title="六.补充"></a>六.补充</h3><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/NCXN2iW_DpEHEiePDP7Yhg">计算机网络经典20问！</a> 更精简</p>
<ul>
<li>TCP 设计动机</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1kV411j7hA?spm_id_from=333.1007.top_right_bar_window_history.content.click">快速了解 TCP</a></p>
<p>总结来说：<strong>IP协议</strong> 只负责将零散的数据包从一个主机发送到另一个主机，不知道送给哪个应用程序，不知道哪些数据包属于哪些请求，不负责组装它们也不保证它们到达的先后顺序，非常的不可靠。<strong>TCP协议</strong> 则以“连接”的方式建立可靠的通信，实现了前面提到的IP协议做不到的事情，方便我们的应用程序间的请求和应答。但TCP协议也只是搭好了应用程序间通信的“管子”，其中的数据并无特殊的意义，只是实现了数据流的可靠流通而已，若想让这些数据带某些特定的意义，以及拆建“管子”的时机，就再上一层看 <strong>应用层协议</strong>。</p>
<ul>
<li>面经内容补充</li>
</ul>
<p>TCP协议 将应用层报文切割成报文段，再交给IP层，IP层进行包装即可（也就是分段的好的话就不需要IP层另外进行分片）；UDP协议 传输完整报文，不进行分段，交给IP层后由IP层来进行分片。</p>
<p>TCP协议内容：建立连接（三次握手）、传输过程（确认机制、超时重传/可靠传输、流量控制/ARQ协议和滑动窗口、拥塞控制）、断开连接（四次挥手）</p>
<p>替换：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000039165592">TCP 三次握手和四次挥手</a></p>
<p>补充：快速重传、滑动窗口 的图文解释——<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/108822858">一文搞定 UDP 和 TCP 高频面试题！</a>、<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000022144695">面试准备 TCP 知识，看这一篇就够了</a></p>
<h3 id="七-补充"><a href="#七-补充" class="headerlink" title="七.补充"></a>七.补充</h3><p>注意区分：TCP是全双工（发送端连续发送数据的同时，接收端可以同时返回确认；也即可以连续多次发出数据，不必一一等待确认）、HTTP1.1是半双工（完成一对请求响应后，才能进行下一对）、HTTP2.0是全双工（可以同时发送多对请求响应，不必一一等待响应）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/welongfor/article/details/86622790">http 协议 是否 全双工 说明</a></p>
<p>但 WebSocket 和 HTTP 的区别，重点应该不在通信上的双工（即两边是否可以同时发送数据），而是<strong>行为逻辑</strong>。HTTP 必须先由客户端发起请求，然后由服务端响应。WebSocket 则可以由服务器主动向客户端推送信息。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1rt411P7G5?from=search&seid=379406896436056311&spm_id_from=333.337.0.0">保证前端实时性的技术：websocket</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=fG4dkrlaZAA">REST API (HTTP) vs Websockets - Concept Overview With Example</a></p>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><h3 id="一、11-哪些方法会触发-React-重新渲染？重新渲染-render-会做些什么？"><a href="#一、11-哪些方法会触发-React-重新渲染？重新渲染-render-会做些什么？" class="headerlink" title="一、11 哪些方法会触发 React 重新渲染？重新渲染 render 会做些什么？"></a>一、11 哪些方法会触发 React 重新渲染？重新渲染 render 会做些什么？</h3><p>关于 父组件重新渲染-子组件重新渲染</p>
<blockquote>
<p>“只要父组件重新渲染了，即使传入子组件的 props 未发生变化，那么子组件也会重新渲染，进而触发 render”</p>
</blockquote>
<p><strong>问题一</strong>：这生命周期中说的 “props 改变时重新渲染” 是否冲突？</p>
<p><strong>答</strong>：首先要定义“重新渲染”：是否调用 render（构建 VDOM）、是否进行 Diffing 比较、是否更新其对应的真实 DOM</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000040771487/a-1020000040779350">React父组件刷新导致子组件重新渲染问题</a> 下面的回答简要介绍了<code>reconsile</code>的过程</p>
<blockquote>
<p>一个节点更新前后props相等，且该节点没有更新，并且其子树中也没有更新，这种情况下以该节点为根的fiber子树的reconciliation过程就会到此为止停止diff</p>
</blockquote>
<p>所以不确定：子组件到底有没有调用 render？还是说不论 props 如何都要调用 render，但是不一定 diffing 比较？</p>
<p>暂且先按 <strong>生命周期</strong> 中的说法回答</p>
<p><strong>问题二</strong>：组件的生命周期 和 Diffing 算法的关系？</p>
<p>生命周期中的 render 是指返回组件的 VDOM 吗？还是指它会不会被添加到 patch 中并最终被更新？</p>
<p>后者似乎更合理？先不管三七二十一的到某个完整的VDOM子树，然后根据各种规则（diffing三原则、props有没有变、shouldUpdate等）来判断是否 进行 diffing、patch</p>
<p>但实际可能并非如此，生命周期中的 render 就是 <code>render()</code> 方法，参考：<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/optimizing-performance.html#avoid-reconciliation">避免调停</a></p>
<blockquote>
<p>如果你知道在什么情况下你的组件不需要更新，你可以在 shouldComponentUpdate 中返回 false 来跳过整个渲染过程，其包括该组件的 render 调用以及之后的操作。</p>
</blockquote>
<p>以上问题，归根结底，就是不清楚</p>
<ul>
<li>组件的生命周期在父子组件的嵌套情况下的表现</li>
<li><code>render()</code> 如何层层调用，构建 VDOM 树。构建出来的 VDOM 树包括哪些节点？</li>
</ul>
<p>个人推测：</p>
<ul>
<li><code>setState()</code> 调用后，以被更新的节点为根节点，递归调用 <code>render()</code> 构造 VDOM 子树。递归过程中，判断子节点 <code>props</code> 和 <code>shouldComponentUpdate</code> 情况，决定是否调用其 <code>render()</code> （也即是否将其添加到 VDOM）。最后，以被更新节点为根节点的，经过剪枝后构造的 VDOM，就是我们拿来 Diffing 的 VDOM</li>
<li>在构造新的 VDOM 树中，被剪枝的部分不会被拿来和旧 VDOM 进行 Diffing（我就是因为它们不要更新才不render出来的，拿去比较的话，岂不是认为我们新的 VDOM 相比旧 VDOM 缺少了这一块，反而要对真 DOM 进行删除操作？）</li>
<li>博客、面经 中说的 “父组件重新渲染时，不管传入的 props 有没有变化，都会引起子组件的重新渲染” 不一定正确</li>
</ul>
<h3 id="六、1-对-Redux-的理解"><a href="#六、1-对-Redux-的理解" class="headerlink" title="六、1 对 Redux 的理解"></a>六、1 对 Redux 的理解</h3><p>Redux 是一个使用叫做“action”的事件来管理和更新应用状态的模式和工具库 它以集中式Store（centralized store）的方式对整个应用中使用的状态进行集中管理，其规则确保状态只能以可预测的方式更新。</p>
<p>React 状态管理的问题：</p>
<ul>
<li>项目越来越庞大复杂时，管理数据的事件和回调函数越来越多，并且改变状态可能会导致多个组件的view更新（也即不清楚什么操作会改变什么状态，这个状态改变又会导致什么view变化）</li>
<li>兄弟组件、跨级组件都依赖某个状态时，实现起来比较繁琐（状态提升、state 通过 props 层层传递）</li>
</ul>
<p>redux 的作用：</p>
<ul>
<li><p>Redux 帮你管理<strong>全局状态</strong>。哪些组件依赖哪些状态进行更新，这种关系表达的很清楚，并且实现起来比较方便</p>
</li>
<li><p>Redux 让我们更容易理解应用程序中的状态何时、何地、为什么以及如何更新，以及当这些更改发生时您的应用程序逻辑将如何表现. Redux 有助于编写<strong>可预测和可测试</strong>的代码</p>
</li>
</ul>
<p>这比组件之间互相传递数据清晰明朗的多</p>
<h3 id="六、2-Redux-的工作流程"><a href="#六、2-Redux-的工作流程" class="headerlink" title="六、2 Redux 的工作流程"></a>六、2 Redux 的工作流程</h3><p>基本库使用简述</p>
<ul>
<li><code>const store= createStore(fn)</code>生成 store 和 初始化状态</li>
<li>action: <code>&#123;type: Symble(&#39;action01), payload:&#39;payload&#39; &#125;</code> 定义行为</li>
<li>dispatch action：<code>store.dispatch(doSomething(&#39;action001&#39;))</code></li>
<li>reducer：处理 action，返回新的 state</li>
<li>UI Binding Library 帮助组件发起 dispatch 和 订阅 store 状态更新</li>
</ul>
<p>借助 redux-toolkit 来构建 redux 应用</p>
<p>详见：<a target="_blank" rel="noopener" href="https://wuchaojie.top/2022/03/03/React%E6%A1%86%E6%9E%B6%E8%AE%AD%E7%BB%83/#%E5%BA%94%E7%94%A8%E7%BB%93%E6%9E%84">Redux 应用结构 笔记</a></p>
<h3 id="八、1-对虚拟DOM的理解"><a href="#八、1-对虚拟DOM的理解" class="headerlink" title="八、1 对虚拟DOM的理解"></a>八、1 对虚拟DOM的理解</h3><p>VDOM 本质是什么</p>
<p>VDOM 做了什么</p>
<ul>
<li>将要渲染的元素转换成对象（VDOM），它描述了真实DOM的结构</li>
<li>数据发生变化时，缓存一份虚拟DOM，变化时候得到新的VDOM，React 内置的 Diffing 算法就会对这两个 VDOM 进行对比，得到其差异的部分</li>
<li>将有差别的部分更新到真实的DOM</li>
</ul>
<p>这样做的好处</p>
<ul>
<li>保证性能下限。一是减少了DOM操作次数（本身费时），二是将多次DOM操作一次性处理减少了回流和重绘</li>
<li>提高开发效率。直接通过JS修改视图，而不用繁琐的DOM接口</li>
<li>跨平台</li>
</ul>
<h3 id="八、2"><a href="#八、2" class="headerlink" title="八、2"></a>八、2</h3><p><a target="_blank" rel="noopener" href="https://vue3js.cn/interview/React/diff.html">Diff 算法原理</a></p>
<h2 id="手写代码"><a href="#手写代码" class="headerlink" title="手写代码"></a>手写代码</h2><p>关于<code>Promise.all()</code>的实现，在期约初始化程序中写的<code>p.then()</code>，也可以理解成一种“异步操作”（类似于setTimeout）</p>
<h3 id="一、8-9-防抖节流"><a href="#一、8-9-防抖节流" class="headerlink" title="一、8/9 防抖节流"></a>一、8/9 防抖节流</h3><ul>
<li><p>防抖<br>原理：原方法延迟一段时间再执行，延时过程中再次调用包装方法的话则让原方法重新计时再延时执行；timer 有值就代表目前有一个定时器，对应一个待运行的操作<br>效果：两次操作间隔小于延时的话，只有最后一次操作生效</p>
</li>
<li><p>节流：<br>原理：原方法延迟一段时间再执行，延时过程中调用包装方法无效，等原方法延时执行完后再恢复包装方法的有效性；timer 有值就代表目前有一个定时器，对应一个待运行的操作<br>效果：多次快速的操作，实际生效两次操作之间的间隔大于或等于延时</p>
</li>
</ul>
<h3 id="二、5-扁平化"><a href="#二、5-扁平化" class="headerlink" title="二、5 扁平化"></a>二、5 扁平化</h3><p>数组扁平化、对象的深拷贝，递归思路很类似</p>
<p>关于递归：</p>
<p>懂得代码运行顺序是其一，编写代码时能直接在递归产生的效果上思考是其二</p>
<p>在<strong>适合递归的任务</strong>中（使用递归，首先我们要将任务建模为适合递归的任务，以下的做法才能有效）</p>
<ul>
<li><p>在当前层次，思考我们要在这一层做什么：单独的操作、调用下一层递归 &amp; 利用下一层递归的结果</p>
</li>
<li><p>每层的递归操作意义都是相同的，或者说幂等的。比如扁平数组，我们可以直接认为调用<code>flatten()</code>就能得到一个扁平的数组，然后将其拼接到总的结果上就好</p>
</li>
<li><p>然后则是思考递归种终止的条件，即递归到最底层的情况</p>
</li>
</ul>
<h3 id="二、13-千分位逗号"><a href="#二、13-千分位逗号" class="headerlink" title="二、13 千分位逗号"></a>二、13 千分位逗号</h3><p>补充：</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions">正则表达式 MDN</a></p>
<p>代码中 <code>\d&#123;3&#125;</code> 表示连着的三个数字、<code>/g</code>表示字符串全局范围</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miao.gif">
      <meta itemprop="name" content="Wu Chaojie">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98/" class="post-title-link" itemprop="url">数据结构与算法刷题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-20 15:44:34" itemprop="dateCreated datePublished" datetime="2021-12-20T15:44:34+08:00">2021-12-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-11 21:32:00" itemprop="dateModified" datetime="2022-03-11T21:32:00+08:00">2022-03-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="JavaScript-数据结构与算法-刷题计划"><a href="#JavaScript-数据结构与算法-刷题计划" class="headerlink" title="JavaScript 数据结构与算法 刷题计划"></a>JavaScript 数据结构与算法 刷题计划</h2><ul>
<li>（理论/实践）数据结构和算法（C++描述） + 学习JavaScript数据结构与算法</li>
<li>（实践 - 后台/C++实现）<a target="_blank" rel="noopener" href="https://interviewguide.cn/#/Doc/Knowledge/%E7%AE%97%E6%B3%95/%E5%B8%A6%E4%BD%A0%E5%BF%AB%E9%80%9F%E5%88%B7%E5%AE%8C67%E9%81%93%E5%89%91%E6%8C%87offer/README?id=%e5%b8%a6%e4%bd%a0%e5%bf%ab%e9%80%9f%e5%88%b7%e5%ae%8c67%e9%81%93%e5%89%91%e6%8c%87offer">带你快速刷完67道剑指offer</a>、<a target="_blank" rel="noopener" href="https://codetop.cc/home">CodeTop 企业题库</a>、<a target="_blank" rel="noopener" href="https://github.com/MisterBooo/LeetCodeAnimation">LeetCode Animation</a>、<a target="_blank" rel="noopener" href="https://github.com/youngyangyang04/leetcode-master">LeetCode 刷题攻略</a></li>
<li>（实践 - 前端/JS实现）<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903919722692621">前端该如何准备数据结构和算法？</a> + <a target="_blank" rel="noopener" href="https://github.com/ConardLi/awesome-coding-js">awesome-coding-js 2.5k 🌟</a>、<a target="_blank" rel="noopener" href="https://juejin.cn/post/6847009772500156429#heading-15">写给前端的算法进阶指南</a>+<a target="_blank" rel="noopener" href="https://github.com/sl1673495/leetcode-javascript/issues?page=1&q=is:issue+is:open">对应100道前端精选算法题 1.2k 🌟</a>、<a target="_blank" rel="noopener" href="https://www.nowcoder.com/discuss/101711?type=5">JS版剑指offer</a>、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lilicat/p/15491755.html">【75题】剑指 Offer 题解 （JavaScript版本）</a>、<a target="_blank" rel="noopener" href="https://github.com/sisterAn/JavaScript-Algorithms">适用于前端的数据结构与算法系列 3.3k 🌟</a>、<a target="_blank" rel="noopener" href="https://github.com/trekhleb/javascript-algorithms">JavaScript Algorithms and Data Structures</a>;</li>
</ul>
<p>刷题策略：分门别类、快速多遍、总结回顾</p>
<p>刷题顺序：剑指经典、前端企业题库 Top100、LeetCode hot100</p>
<h2 id="沐神的刷题教程"><a href="#沐神的刷题教程" class="headerlink" title="沐神的刷题教程"></a>沐神的刷题教程</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1GZ4y1A7Lv">LeetCode入门教学视频</a> </p>
<h2 id="剑指-Offer-70-题"><a href="#剑指-Offer-70-题" class="headerlink" title="剑指 Offer 70+题"></a>剑指 Offer 70+题</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b39568569fd8">剑指 Offer 题目分类</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lilicat/p/15491755.html">【75题】剑指 Offer 题解 （JavaScript版本）</a></p>
<h2 id="适用于前端的数据结构与算法系列-80-题"><a href="#适用于前端的数据结构与算法系列-80-题" class="headerlink" title="适用于前端的数据结构与算法系列 80+题"></a>适用于前端的数据结构与算法系列 80+题</h2><p><a target="_blank" rel="noopener" href="https://github.com/sisterAn/JavaScript-Algorithms">适用于前端的数据结构与算法系列 3.3k 🌟</a></p>
<h2 id="CodeTop-企业题库-前端100题"><a href="#CodeTop-企业题库-前端100题" class="headerlink" title="CodeTop 企业题库 前端100题"></a>CodeTop 企业题库 前端100题</h2><p><a target="_blank" rel="noopener" href="https://codetop.cc/home">CodeTop 企业题库</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wu Chaojie</span>
</div>
  <div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客量:<span id="busuanzi_value_site_pv"></span>
  </span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
